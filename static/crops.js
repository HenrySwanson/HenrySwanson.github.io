(()=>{"use strict";const e=JSON.parse('[{"name":"Blue Jazz","season":"Spring","seed_cost":30,"sell_price":50,"days_to_grow":7},{"name":"Carrot","season":"Spring","seed_cost":0,"sell_price":35,"days_to_grow":3},{"name":"Cauliflower","season":"Spring","seed_cost":80,"sell_price":175,"days_to_grow":12},{"name":"Coffee Bean","season":"Spring","multiseason":2,"seed_cost":15,"sell_price":15,"days_to_grow":10,"regrowth_period":2,"yield":4,"percent_chance_extra":2},{"name":"Garlic","season":"Spring","seed_cost":40,"sell_price":60,"days_to_grow":4},{"name":"Green Bean","season":"Spring","seed_cost":60,"sell_price":40,"days_to_grow":10,"regrowth_period":3},{"name":"Kale","season":"Spring","seed_cost":70,"sell_price":110,"days_to_grow":6},{"name":"Parsnip","season":"Spring","seed_cost":20,"sell_price":35,"days_to_grow":4},{"name":"Potato","season":"Spring","seed_cost":50,"sell_price":80,"days_to_grow":6,"percent_chance_extra":25},{"name":"Rhubarb","season":"Spring","seed_cost":100,"sell_price":220,"days_to_grow":13},{"name":"Rice","season":"Spring","seed_cost":40,"sell_price":30,"days_to_grow":6},{"name":"Strawberry","season":"Spring","seed_cost":100,"sell_price":120,"days_to_grow":8,"regrowth_period":4,"percent_chance_extra":2},{"name":"Tulip","season":"Spring","seed_cost":20,"sell_price":30,"days_to_grow":6},{"name":"Blueberry","season":"Summer","seed_cost":80,"sell_price":50,"days_to_grow":13,"regrowth_period":4,"yield":3,"percent_chance_extra":2},{"name":"Corn","season":"Summer","multiseason":2,"seed_cost":150,"sell_price":50,"days_to_grow":14,"regrowth_period":4},{"name":"Hops","season":"Summer","seed_cost":60,"sell_price":25,"days_to_grow":11,"regrowth_period":1},{"name":"Hot Pepper","season":"Summer","seed_cost":40,"sell_price":40,"days_to_grow":5,"regrowth_period":3,"percent_chance_extra":3},{"name":"Melon","season":"Summer","seed_cost":80,"sell_price":250,"days_to_grow":12},{"name":"Poppy","season":"Summer","seed_cost":100,"sell_price":140,"days_to_grow":7},{"name":"Radish","season":"Summer","seed_cost":40,"sell_price":90,"days_to_grow":6},{"name":"Red Cabbage","season":"Summer","seed_cost":100,"sell_price":260,"days_to_grow":9},{"name":"Starfruit","season":"Summer","seed_cost":400,"sell_price":750,"days_to_grow":13},{"name":"Summer Spangle","season":"Summer","seed_cost":50,"sell_price":90,"days_to_grow":8},{"name":"Summer Squash","season":"Summer","seed_cost":0,"sell_price":45,"days_to_grow":6},{"name":"Sunflower","season":"Summer","multiseason":2,"seed_cost":200,"sell_price":80,"days_to_grow":8},{"name":"Tomato","season":"Summer","seed_cost":50,"sell_price":60,"days_to_grow":11,"regrowth_period":4,"percent_chance_extra":5},{"name":"Wheat","season":"Summer","multiseason":2,"seed_cost":10,"sell_price":25,"days_to_grow":4},{"name":"Amaranth","season":"Fall","seed_cost":70,"sell_price":150,"days_to_grow":7},{"name":"Artichoke","season":"Fall","seed_cost":30,"sell_price":160,"days_to_grow":8},{"name":"Beet","season":"Fall","seed_cost":20,"sell_price":100,"days_to_grow":6},{"name":"Bok Choy","season":"Fall","seed_cost":50,"sell_price":80,"days_to_grow":4},{"name":"Broccoli","season":"Fall","seed_cost":0,"sell_price":70,"days_to_grow":8},{"name":"Cranberries","season":"Fall","seed_cost":240,"sell_price":75,"days_to_grow":7,"regrowth_period":5,"yield":2,"percent_chance_extra":10},{"name":"Eggplant","season":"Fall","seed_cost":20,"sell_price":60,"days_to_grow":5,"regrowth_period":5,"percent_chance_extra":0.2},{"name":"Fairy Rose","season":"Fall","seed_cost":200,"sell_price":290,"days_to_grow":12},{"name":"Grape","season":"Fall","seed_cost":60,"sell_price":80,"days_to_grow":10,"regrowth_period":3},{"name":"Pumpkin","season":"Fall","seed_cost":100,"sell_price":320,"days_to_grow":13},{"name":"Yam","season":"Fall","seed_cost":60,"sell_price":160,"days_to_grow":10},{"name":"Powdermelon","season":"Winter","seed_cost":0,"sell_price":60,"days_to_grow":7}]');var t;!function(e){e[e.SPRING=0]="SPRING",e[e.SUMMER=1]="SUMMER",e[e.FALL=2]="FALL",e[e.WINTER=3]="WINTER"}(t||(t={})),function(e){e.fromString=function(t){switch(t.toUpperCase()){case"SPRING":return e.SPRING;case"SUMMER":return e.SUMMER;case"FALL":return e.FALL;case"WINTER":return e.WINTER;default:throw new Error(`Unknown season ${t}`)}}}(t||(t={}));const o=1.25,s=1.5,r=2;function n(e,n){var a,i,l;const c=[],d=null!==(a=e.multiseason)&&void 0!==a?a:1;for(let o=0;o<d;o++)c.push(t.fromString(e.season).valueOf()+o);if(!c.includes(n.season))return"out-of-season";const _=28*(n.multiseason_enabled?c.length-c.indexOf(n.season):1)-n.start_day;let m=0,u=0;if(_>=e.days_to_grow&&(m+=1,u+=e.days_to_grow,e.regrowth_period)){const t=Math.floor((_-e.days_to_grow)/e.regrowth_period);m+=t,u+=t*e.regrowth_period}const p=e.sell_price;let g;if(n.quality_probabilities){const e=n.quality_probabilities;g=[[1,e.normal],[o,e.silver],[s,e.gold],[r,e.iridium]].map((([e,t])=>Math.trunc(e*p)*t)).reduce(((e,t)=>e+t))}else g=p;const y=(null!==(i=e.yield)&&void 0!==i?i:1)+(null!==(l=e.percent_chance_extra)&&void 0!==l?l:0)/100;let h=g+(y-1)*p;n.tiller_enabled&&(h*=1.1);const w=h*m-e.seed_cost;return{definition:e,useful_days:u,num_harvests:m,num_crops:y*m,profit:w,daily_profit:w/u}}const a=[{name:"Name",cellText:e=>e.definition.name,compare:(e,t)=>e.definition.name.localeCompare(t.definition.name)},{name:"Seed Cost",cellText:e=>e.definition.seed_cost.toString(),compare:(e,t)=>e.definition.seed_cost-t.definition.seed_cost},{name:"Sell Price",cellText:e=>e.definition.sell_price.toString(),compare:(e,t)=>e.definition.sell_price-t.definition.sell_price},{name:"Days to Grow",cellText:e=>e.definition.days_to_grow.toString(),compare:(e,t)=>e.definition.days_to_grow-t.definition.days_to_grow},{name:"Regrowth Period",cellText:e=>{var t,o;return null!==(o=null===(t=e.definition.regrowth_period)||void 0===t?void 0:t.toString())&&void 0!==o?o:"-"},compare:(e,t)=>void 0===t.definition.regrowth_period?-1:void 0===e.definition.regrowth_period?1:e.definition.regrowth_period-t.definition.regrowth_period},{name:"Yield",cellText:e=>{var t;const o=null!==(t=e.definition.yield)&&void 0!==t?t:1;return e.definition.percent_chance_extra?`${o} + ${e.definition.percent_chance_extra}%`:o.toString()},compare:(e,t)=>{var o,s,r,n;return(null!==(o=e.definition.yield)&&void 0!==o?o:1)+(null!==(s=e.definition.percent_chance_extra)&&void 0!==s?s:0)/100-((null!==(r=t.definition.yield)&&void 0!==r?r:1)+(null!==(n=t.definition.percent_chance_extra)&&void 0!==n?n:0)/100)}},{name:"Useful Days",cellText:e=>e.useful_days.toString(),compare:(e,t)=>e.useful_days-t.useful_days},{name:"Num Harvests",cellText:e=>e.num_harvests.toString(),compare:(e,t)=>e.num_crops-t.num_crops},{name:"Num Crops",cellText:e=>{const t=e.num_crops;return Number.isInteger(t)?t.toString():e.num_crops.toFixed(2)},compare:(e,t)=>e.num_crops-t.num_crops},{name:"Profit",cellText:e=>e.profit.toFixed(2),compare:(e,t)=>e.profit-t.profit},{name:"Daily Profit",cellText:e=>Number.isFinite(e.daily_profit)?e.daily_profit.toFixed(2):"-",compare:(e,t)=>e.daily_profit-t.daily_profit}];class i{constructor(e,t){this.data=t,this.row=e;for(const e of a){const t=e.cellText(this.data);this.row.insertCell().appendChild(document.createTextNode(t))}}}function l(e){switch(e){case"ascending":return"descending";case"descending":return"ascending"}}class c{constructor(e){this.table=e,this.rows=[],this.current_sort=null,this.thead=this.table.createTHead(),this.tbody=this.table.createTBody();const t=this.thead.insertRow();for(const[e,o]of a.entries()){const s=t.insertCell();s.appendChild(document.createTextNode(o.name)),s.addEventListener("click",(()=>{let t;t=null!==this.current_sort&&this.current_sort[0]===e?l(this.current_sort[1]):"ascending",this.current_sort=[e,t];const o=this.thead.querySelectorAll("td");for(const e of o)e.removeAttribute("aria-sort");o[e].setAttribute("aria-sort",t),this.sortRows()}))}}repopulateTable(t){this.tbody.replaceChildren(),this.rows=[];for(const o of e){const e=n(o,t);if("out-of-season"==e)continue;const s=this.tbody.insertRow();this.rows.push(new i(s,e))}this.sortRows()}sortRows(){let e,t;null===this.current_sort?(e=0,t="ascending"):[e,t]=this.current_sort;const o=a[e];this.rows.sort(((e,s)=>{const r=o.compare(e.data,s.data);return"ascending"===t?r:-r}));for(const e of this.rows)this.tbody.appendChild(e.row)}}function d(e,t){for(let o of e.querySelectorAll("td"))t?o.classList.remove("disabled"):o.classList.add("disabled")}function _(){console.log("Initializing!");const e=document.getElementById("crop-table");if(!(e instanceof HTMLTableElement))throw new Error("crop-table should be a <table>");const o=document.getElementById("input-panel"),s=document.querySelector("#season"),r=document.querySelector("#day"),n=document.querySelector("#enable-multiseason"),a=document.querySelector("#enable-quality"),i=document.querySelector("#farmer-level"),l=document.querySelector("#enable-tiller");let _={normal:document.getElementById("percent-normal"),silver:document.getElementById("percent-silver"),gold:document.getElementById("percent-gold"),iridium:document.getElementById("percent-iridium")},m=document.getElementById("average-quality");const u=new c(e);function p(){const e={season:t.fromString(s.value),start_day:r.valueAsNumber,multiseason_checked:n.checked,quality_checked:a.checked,farming_level:i.valueAsNumber,tiller_checked:l.checked},o=function(e){const t=e/10*.2+(e+2)/12*0+.01;let o=t/2;o=0;const s=1*t,r=(1-s)*Math.min(2*t,.75);return{normal:1-s-r,silver:r,gold:s,iridium:0}}(e.farming_level);let c,p={season:e.season,start_day:e.start_day,multiseason_enabled:e.multiseason_checked,quality_probabilities:a.checked?o:null,tiller_enabled:l.checked};for(c in _){const e=100*o[c];_[c].textContent=`${e.toFixed(0)}%`}const g=o.normal+1.25*o.silver+1.5*o.gold+2*o.iridium;for(c in m.textContent=g.toFixed(2),d(l.parentElement.parentElement,e.farming_level>=5),e.farming_level<5&&(p.tiller_enabled=!1),_)d(_[c].parentElement,e.quality_checked);d(m.parentElement,e.quality_checked),u.repopulateTable(p),document.documentElement.className=s.value.toLowerCase()}p(),o.addEventListener("change",(e=>{p()}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",_):_()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QnhCLGdCQUFnQjVGLEdBQ2hDb0UsU0FBU2tFLGdCQUFnQkMsVUFBWTVCLEVBQWExQyxNQUFNdUUsYUFDNUQsQ0FHQW5CLElBR0FYLEVBQVl0QixpQkFBaUIsVUFBV3FELElBQ3BDcEIsR0FBc0IsR0FFOUIsQ0FLNEIsWUFBeEJqRCxTQUFTc0UsV0FFVHRFLFNBQVNnQixpQkFBaUIsbUJBQW9CaUIsR0FHOUNBLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY3JvcHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4vLyBzaG91bGQgaSBwdWxsIHRoaXMgZnJvbSBhIEpTT04gbGlrZSBpJ20gZG9pbmcgbm93PyBvciBzaG91bGQgaSBqdXN0XHJcbi8vIGhhcmQtY29kZSBpdCBpbmxpbmUgKG1pZ2h0IGJlIG1vcmUgcmVhZGFibGUpXHJcbmltcG9ydCBDUk9QX0RFRklOSVRJT05TIGZyb20gXCIuL2Nyb3BzLmpzb25cIjtcclxuXHJcbi8qID09PT09PT09IENBTENVTEFUSU9OID09PT09PT09ICovXHJcblxyXG50eXBlIENyb3BEZWZpbml0aW9uID0gdHlwZW9mIENST1BfREVGSU5JVElPTlNbbnVtYmVyXTtcclxuXHJcbmVudW0gU2Vhc29uIHtcclxuICAgIFNQUklORywgU1VNTUVSLCBGQUxMLCBXSU5URVJcclxufVxyXG5cclxubmFtZXNwYWNlIFNlYXNvbiB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gZnJvbVN0cmluZyhzOiBzdHJpbmcpOiBTZWFzb24ge1xyXG4gICAgICAgIHN3aXRjaCAocy50b1VwcGVyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJTUFJJTkdcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uU1BSSU5HO1xyXG4gICAgICAgICAgICBjYXNlIFwiU1VNTUVSXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU2Vhc29uLlNVTU1FUjtcclxuICAgICAgICAgICAgY2FzZSBcIkZBTExcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uRkFMTDtcclxuICAgICAgICAgICAgY2FzZSBcIldJTlRFUlwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5XSU5URVI7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gc2Vhc29uICR7c31gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbnR5cGUgQ3JvcERhdGEgPSB7XHJcbiAgICBkZWZpbml0aW9uOiBDcm9wRGVmaW5pdGlvbixcclxuICAgIHVzZWZ1bF9kYXlzOiBudW1iZXIsXHJcbiAgICBudW1faGFydmVzdHM6IG51bWJlcixcclxuICAgIG51bV9jcm9wczogbnVtYmVyLFxyXG4gICAgcHJvZml0OiBudW1iZXIsXHJcbiAgICBkYWlseV9wcm9maXQ6IG51bWJlcixcclxufTtcclxuXHJcbnR5cGUgUXVhbGl0eVByb2JhYmlsaXRpZXMgPSB7XHJcbiAgICBub3JtYWw6IG51bWJlcixcclxuICAgIHNpbHZlcjogbnVtYmVyLFxyXG4gICAgZ29sZDogbnVtYmVyLFxyXG4gICAgaXJpZGl1bTogbnVtYmVyLFxyXG59O1xyXG50eXBlIFF1YWxpdHlUeXBlcyA9IGtleW9mIFF1YWxpdHlQcm9iYWJpbGl0aWVzO1xyXG5cclxuY29uc3QgU0lMVkVSX01VTFRJUExJRVIgPSAxLjI1O1xyXG5jb25zdCBHT0xEX01VTFRJUExJRVIgPSAxLjU7XHJcbmNvbnN0IElSSURJVU1fTVVMVElQTElFUiA9IDIuMDtcclxuXHJcbmZ1bmN0aW9uIGNvbXB1dGVRdWFsaXR5KGZhcm1pbmdfbGV2ZWw6IG51bWJlcik6IFF1YWxpdHlQcm9iYWJpbGl0aWVzIHtcclxuICAgIC8vIGh0dHBzOi8vc3RhcmRld3ZhbGxleXdpa2kuY29tL0Zhcm1pbmcjQ29tcGxldGVfRm9ybXVsYV8yXHJcbiAgICBjb25zdCBmZXJ0aWxpemVyX2xldmVsID0gMDtcclxuXHJcbiAgICAvLyBRdWFsaXR5IGZvciBhIGNyb3AgaXMgZGV0ZXJtaW5lZCBieSBhIHNlcmllcyBvZiB3ZWlnaHRlZCBjb2luIGZsaXBzLlxyXG4gICAgLy8gVGhlIHByb2JhYmlsaXRpZXMgZm9yIHRoZSBjb2lucyBhcmUgY29tcHV0ZWQgaGVyZS5cclxuICAgIGNvbnN0IHBfZ29sZF9jb2luID0gMC4yICogKGZhcm1pbmdfbGV2ZWwgLyAxMC4wKSArIDAuMiAqIGZlcnRpbGl6ZXJfbGV2ZWwgKiAoKGZhcm1pbmdfbGV2ZWwgKyAyLjApIC8gMTIuMCkgKyAwLjAxO1xyXG4gICAgY29uc3QgcF9zaWx2ZXJfY29pbiA9IE1hdGgubWluKDIgKiBwX2dvbGRfY29pbiwgMC43NSk7XHJcbiAgICBsZXQgcF9pcmlkaXVtX2NvaW4gPSBwX2dvbGRfY29pbiAvIDI7XHJcblxyXG4gICAgLy8gVE9ETzogdGhpcyBpcyBvbmx5IGVuYWJsZWQgYXQgY2VydGFpbiBmZXJ0aWxpemVyIGxldmVsc1xyXG4gICAgcF9pcmlkaXVtX2NvaW4gPSAwO1xyXG5cclxuICAgIC8vIEhvd2V2ZXIsIHRoZXNlIGNvaW5zIGFyZSBmbGlwcGVkIG9uZSBhdCBhIHRpbWUsIHNvIHdlIGhhdmUgc2xpZ2h0bHkgbW9yZVxyXG4gICAgLy8gd29yayB0byBkbyB0byBmaW5kIG91dCB0aGUgZmluYWwgcHJvYmFiaWxpdGllcy5cclxuXHJcbiAgICAvLyBDaGFuY2Ugb2YgaXJpZGl1bSBpcyBqdXN0IHRoZSBsb2NhbCBjaGFuY2Ugb2YgaXJpZGl1bS5cclxuICAgIGNvbnN0IGlyaWRpdW0gPSBwX2lyaWRpdW1fY29pbjtcclxuICAgIC8vIFRvIGdldCBnb2xkLCBkb24ndCBiZSBpcmlkaXVtLCBhbmQgcGFzcyB0aGUgZ29sZCBjb2luIGZsaXAuXHJcbiAgICBjb25zdCBnb2xkID0gKDEgLSBpcmlkaXVtKSAqIHBfZ29sZF9jb2luO1xyXG4gICAgLy8gU2ltaWxhcmx5LCBmb3Igc2lsdmVyLCBkb24ndCBiZSBpcmlkdW0gb3IgZ29sZCwgYW5kIHBhc3MgdGhlXHJcbiAgICAvLyBzaWx2ZXIgY29pbiBmbGlwLlxyXG4gICAgY29uc3Qgc2lsdmVyID0gKDEgLSBpcmlkaXVtIC0gZ29sZCkgKiBwX3NpbHZlcl9jb2luO1xyXG4gICAgLy8gQmFzZSBxdWFsaXR5IGlzIGV2ZXJ5dGhpbmcgZWxzZS5cclxuICAgIGNvbnN0IG5vcm1hbCA9IDEgLSBpcmlkaXVtIC0gZ29sZCAtIHNpbHZlcjtcclxuXHJcbiAgICByZXR1cm4geyBub3JtYWwsIHNpbHZlciwgZ29sZCwgaXJpZGl1bSB9O1xyXG59XHJcblxyXG50eXBlIFNldHRpbmdzID0ge1xyXG4gICAgc2Vhc29uOiBTZWFzb24sXHJcbiAgICBzdGFydF9kYXk6IG51bWJlcixcclxuICAgIG11bHRpc2Vhc29uX2VuYWJsZWQ6IGJvb2xlYW4sXHJcbiAgICBxdWFsaXR5X3Byb2JhYmlsaXRpZXM6IFF1YWxpdHlQcm9iYWJpbGl0aWVzIHwgbnVsbCxcclxuICAgIHRpbGxlcl9lbmFibGVkOiBib29sZWFuLFxyXG59O1xyXG5cclxuZnVuY3Rpb24gY2FsY3VsYXRlKGNyb3A6IENyb3BEZWZpbml0aW9uLCBzZXR0aW5nczogU2V0dGluZ3MpOiBDcm9wRGF0YSB8IFwib3V0LW9mLXNlYXNvblwiIHtcclxuICAgIC8vIFdoZW4gaXMgdGhpcyBjcm9wIGluLXNlYXNvbj9cclxuICAgIGNvbnN0IHNlYXNvbnM6IFNlYXNvbltdID0gW107XHJcbiAgICBjb25zdCBudW1fc2Vhc29ucyA9IGNyb3AubXVsdGlzZWFzb24gPz8gMTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtX3NlYXNvbnM7IGkrKykge1xyXG4gICAgICAgIHNlYXNvbnMucHVzaChTZWFzb24uZnJvbVN0cmluZyhjcm9wLnNlYXNvbikudmFsdWVPZigpICsgaSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQmFpbCBvdXQgaWYgd2UncmUgb3V0IG9mIHNlYXNvblxyXG4gICAgaWYgKCFzZWFzb25zLmluY2x1ZGVzKHNldHRpbmdzLnNlYXNvbikpIHtcclxuICAgICAgICByZXR1cm4gXCJvdXQtb2Ytc2Vhc29uXCI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSG93IG1hbnkgZGF5cyBkbyB3ZSBoYXZlIGxlZnQ/XHJcbiAgICBjb25zdCBzZWFzb25zX2xlZnQgPSBzZXR0aW5ncy5tdWx0aXNlYXNvbl9lbmFibGVkXHJcbiAgICAgICAgPyBzZWFzb25zLmxlbmd0aCAtIHNlYXNvbnMuaW5kZXhPZihzZXR0aW5ncy5zZWFzb24pXHJcbiAgICAgICAgOiAxO1xyXG4gICAgY29uc3QgZGF5c19sZWZ0ID0gMjggKiBzZWFzb25zX2xlZnQgLSBzZXR0aW5ncy5zdGFydF9kYXk7XHJcblxyXG4gICAgLy8gSW4gdGhlIG51bWJlciBvZiBkYXlzIHJlbWFpbmluZywgaG93IG1hbnkgaGFydmVzdHMgZG8gd2UgZ2V0P1xyXG4gICAgbGV0IG51bV9oYXJ2ZXN0cyA9IDA7XHJcbiAgICBsZXQgdXNlZnVsX2RheXMgPSAwO1xyXG4gICAgaWYgKGRheXNfbGVmdCA+PSBjcm9wLmRheXNfdG9fZ3Jvdykge1xyXG4gICAgICAgIG51bV9oYXJ2ZXN0cyArPSAxO1xyXG4gICAgICAgIHVzZWZ1bF9kYXlzICs9IGNyb3AuZGF5c190b19ncm93O1xyXG4gICAgICAgIGlmIChjcm9wLnJlZ3Jvd3RoX3BlcmlvZCkge1xyXG4gICAgICAgICAgICBjb25zdCBleHRyYV9oYXJ2ZXN0cyA9IE1hdGguZmxvb3IoKGRheXNfbGVmdCAtIGNyb3AuZGF5c190b19ncm93KSAvIGNyb3AucmVncm93dGhfcGVyaW9kKTtcclxuICAgICAgICAgICAgbnVtX2hhcnZlc3RzICs9IGV4dHJhX2hhcnZlc3RzO1xyXG4gICAgICAgICAgICB1c2VmdWxfZGF5cyArPSBleHRyYV9oYXJ2ZXN0cyAqIGNyb3AucmVncm93dGhfcGVyaW9kO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBIb3cgbXVjaCBpcyBhIGNyb3Agd29ydGgsIG9uIGF2ZXJhZ2U/XHJcbiAgICBjb25zdCBiYXNlX3ByaWNlID0gY3JvcC5zZWxsX3ByaWNlO1xyXG4gICAgbGV0IHF1YWxpdHlfcHJpY2U7XHJcbiAgICBpZiAoc2V0dGluZ3MucXVhbGl0eV9wcm9iYWJpbGl0aWVzKSB7XHJcbiAgICAgICAgY29uc3QgcSA9IHNldHRpbmdzLnF1YWxpdHlfcHJvYmFiaWxpdGllcztcclxuICAgICAgICAvLyB6aXAgdG9nZXRoZXIgcHJpY2VzIGFuZCBwcm9iYWJpbGl0aWVzXHJcbiAgICAgICAgcXVhbGl0eV9wcmljZSA9IFtcclxuICAgICAgICAgICAgWzEuMCwgcS5ub3JtYWxdLFxyXG4gICAgICAgICAgICBbU0lMVkVSX01VTFRJUExJRVIsIHEuc2lsdmVyXSxcclxuICAgICAgICAgICAgW0dPTERfTVVMVElQTElFUiwgcS5nb2xkXSxcclxuICAgICAgICAgICAgW0lSSURJVU1fTVVMVElQTElFUiwgcS5pcmlkaXVtXSxcclxuICAgICAgICBdXHJcbiAgICAgICAgICAgIC8vIHByaWNlcyBhcmUgcm91bmRlZCBkb3duIVxyXG4gICAgICAgICAgICAubWFwKChbbXVsdGlwbGllciwgcF0pID0+IE1hdGgudHJ1bmMobXVsdGlwbGllciAqIGJhc2VfcHJpY2UpICogcClcclxuICAgICAgICAgICAgLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBxdWFsaXR5X3ByaWNlID0gYmFzZV9wcmljZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBXZSBjYW4gc29tZXRpbWVzIGdldCBtdWx0aXBsZSBjcm9wcyBwZXIgaGFydmVzdCwgYnV0IGFsbCB0aGUgZXh0cmEgY3JvcHNcclxuICAgIC8vIHdpbGwgYmUgcmVndWxhciBxdWFsaXR5LlxyXG4gICAgLy8gVE9ETzogaXMgdGhpcyB0cnVlPyBpIHNlZSBjb25mbGljdGluZyBzb3VyY2VzIG9ubGluZVxyXG4gICAgY29uc3QgbnVtX2Nyb3BzX3Blcl9oYXJ2ZXN0ID0gKGNyb3AueWllbGQgPz8gMSkgKyAoY3JvcC5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyAwKSAvIDEwMC4wO1xyXG4gICAgbGV0IHJldmVudWVfcGVyX2hhcnZlc3QgPSBxdWFsaXR5X3ByaWNlICsgKG51bV9jcm9wc19wZXJfaGFydmVzdCAtIDEpICogYmFzZV9wcmljZTtcclxuXHJcbiAgICBpZiAoc2V0dGluZ3MudGlsbGVyX2VuYWJsZWQpIHtcclxuICAgICAgICByZXZlbnVlX3Blcl9oYXJ2ZXN0ICo9IDEuMTsgLy8gY291bGQgbWF5YmUgZG8gdGhpcyBiZWZvcmUgdG8gZ2V0IGludGVnZXIgcHJpY2VzXHJcbiAgICB9XHJcblxyXG4gICAgLy8gT2theSwgbGV0J3MgY2FsY3VsYXRlIGV2ZXJ5dGhpbmchXHJcbiAgICBjb25zdCBwcm9maXQgPSByZXZlbnVlX3Blcl9oYXJ2ZXN0ICogbnVtX2hhcnZlc3RzIC0gY3JvcC5zZWVkX2Nvc3Q7XHJcbiAgICBjb25zdCBkYWlseV9wcm9maXQgPSBwcm9maXQgLyB1c2VmdWxfZGF5cztcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGRlZmluaXRpb246IGNyb3AsXHJcbiAgICAgICAgdXNlZnVsX2RheXMsXHJcbiAgICAgICAgbnVtX2hhcnZlc3RzLFxyXG4gICAgICAgIG51bV9jcm9wczogbnVtX2Nyb3BzX3Blcl9oYXJ2ZXN0ICogbnVtX2hhcnZlc3RzLFxyXG4gICAgICAgIHByb2ZpdCxcclxuICAgICAgICBkYWlseV9wcm9maXQsXHJcbiAgICB9O1xyXG59XHJcblxyXG4vKiA9PT09PT09PSBHVUkgPT09PT09PT0gKi9cclxuXHJcbi8vIERlZmluZXMgdGhlIHNldCBvZiBjb2x1bW5zIGZvciB0aGUgd2hvbGUgdGFibGUuXHJcbnR5cGUgQ29sdW1uID0ge1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gc3RyaW5nO1xyXG4gICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gbnVtYmVyO1xyXG59O1xyXG5cclxuY29uc3QgQ09MVU1OUzogQ29sdW1uW10gPSBbXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJOYW1lXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5kZWZpbml0aW9uLm5hbWUsXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5kZWZpbml0aW9uLm5hbWUubG9jYWxlQ29tcGFyZShiLmRlZmluaXRpb24ubmFtZSksXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiU2VlZCBDb3N0XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5kZWZpbml0aW9uLnNlZWRfY29zdC50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGVmaW5pdGlvbi5zZWVkX2Nvc3QgLSBiLmRlZmluaXRpb24uc2VlZF9jb3N0LFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlNlbGwgUHJpY2VcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLmRlZmluaXRpb24uc2VsbF9wcmljZS50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGVmaW5pdGlvbi5zZWxsX3ByaWNlIC0gYi5kZWZpbml0aW9uLnNlbGxfcHJpY2UsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiRGF5cyB0byBHcm93XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5kZWZpbml0aW9uLmRheXNfdG9fZ3Jvdy50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGVmaW5pdGlvbi5kYXlzX3RvX2dyb3cgLSBiLmRlZmluaXRpb24uZGF5c190b19ncm93LFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlJlZ3Jvd3RoIFBlcmlvZFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AuZGVmaW5pdGlvbi5yZWdyb3d0aF9wZXJpb2Q/LnRvU3RyaW5nKCkgPz8gXCItXCIsXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYi5kZWZpbml0aW9uLnJlZ3Jvd3RoX3BlcmlvZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5kZWZpbml0aW9uLnJlZ3Jvd3RoX3BlcmlvZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYS5kZWZpbml0aW9uLnJlZ3Jvd3RoX3BlcmlvZCAtIGIuZGVmaW5pdGlvbi5yZWdyb3d0aF9wZXJpb2Q7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIllpZWxkXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB5aWVsZF9udW0gPSBjcm9wLmRlZmluaXRpb24ueWllbGQgPz8gMTtcclxuICAgICAgICAgICAgaWYgKGNyb3AuZGVmaW5pdGlvbi5wZXJjZW50X2NoYW5jZV9leHRyYSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3lpZWxkX251bX0gKyAke2Nyb3AuZGVmaW5pdGlvbi5wZXJjZW50X2NoYW5jZV9leHRyYX0lYDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZF9udW0udG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBzbGlnaHQgaGFjayAtLSByZXByZXNlbnQgYXMgYSArIGIvMTAwXHJcbiAgICAgICAgICAgIGNvbnN0IGFfbnVtID0gKGEuZGVmaW5pdGlvbi55aWVsZCA/PyAxKSArIChhLmRlZmluaXRpb24ucGVyY2VudF9jaGFuY2VfZXh0cmEgPz8gMCkgLyAxMDA7XHJcbiAgICAgICAgICAgIGNvbnN0IGJfbnVtID0gKGIuZGVmaW5pdGlvbi55aWVsZCA/PyAxKSArIChiLmRlZmluaXRpb24ucGVyY2VudF9jaGFuY2VfZXh0cmEgPz8gMCkgLyAxMDA7XHJcbiAgICAgICAgICAgIHJldHVybiBhX251bSAtIGJfbnVtO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJVc2VmdWwgRGF5c1wiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AudXNlZnVsX2RheXMudG9TdHJpbmcoKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLnVzZWZ1bF9kYXlzIC0gYi51c2VmdWxfZGF5cyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJOdW0gSGFydmVzdHNcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLm51bV9oYXJ2ZXN0cy50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEubnVtX2Nyb3BzIC0gYi5udW1fY3JvcHMsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiTnVtIENyb3BzXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBudW1fY3JvcHMgPSBjcm9wLm51bV9jcm9wcztcclxuICAgICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIobnVtX2Nyb3BzKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bV9jcm9wcy50b1N0cmluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjcm9wLm51bV9jcm9wcy50b0ZpeGVkKDIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5udW1fY3JvcHMgLSBiLm51bV9jcm9wcyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJQcm9maXRcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLnByb2ZpdC50b0ZpeGVkKDIpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEucHJvZml0IC0gYi5wcm9maXQsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiRGFpbHkgUHJvZml0XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKGNyb3AuZGFpbHlfcHJvZml0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNyb3AuZGFpbHlfcHJvZml0LnRvRml4ZWQoMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFwiLVwiO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5kYWlseV9wcm9maXQgLSBiLmRhaWx5X3Byb2ZpdCxcclxuICAgIH1cclxuXTtcclxuXHJcbmNsYXNzIENyb3BSb3cge1xyXG4gICAgZGF0YTogQ3JvcERhdGE7XHJcbiAgICByb3c6IEhUTUxUYWJsZVJvd0VsZW1lbnQ7XHJcblxyXG4gICAgY29uc3RydWN0b3Iocm93OiBIVE1MVGFibGVSb3dFbGVtZW50LCBkYXRhOiBDcm9wRGF0YSkge1xyXG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgdGhpcy5yb3cgPSByb3c7XHJcblxyXG4gICAgICAgIC8vIG5vdyBwb3B1bGF0ZSB0aGUgcm93XHJcbiAgICAgICAgZm9yIChjb25zdCBjb2wgb2YgQ09MVU1OUykge1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbC5jZWxsVGV4dCh0aGlzLmRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnJvdy5pbnNlcnRDZWxsKCkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodmFsdWUpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbnR5cGUgU29ydERpcmVjdGlvbiA9IFwiYXNjZW5kaW5nXCIgfCBcImRlc2NlbmRpbmdcIjtcclxuZnVuY3Rpb24gZmxpcERpcmVjdGlvbih4OiBTb3J0RGlyZWN0aW9uKTogU29ydERpcmVjdGlvbiB7XHJcbiAgICBzd2l0Y2ggKHgpIHtcclxuICAgICAgICBjYXNlIFwiYXNjZW5kaW5nXCI6XHJcbiAgICAgICAgICAgIHJldHVybiBcImRlc2NlbmRpbmdcIjtcclxuICAgICAgICBjYXNlIFwiZGVzY2VuZGluZ1wiOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJhc2NlbmRpbmdcIjtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgQ3JvcFRhYmxlIHtcclxuICAgIHRhYmxlOiBIVE1MVGFibGVFbGVtZW50O1xyXG4gICAgdGhlYWQ6IEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50O1xyXG4gICAgdGJvZHk6IEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50O1xyXG4gICAgcm93czogQ3JvcFJvd1tdO1xyXG4gICAgY3VycmVudF9zb3J0OiBbbnVtYmVyLCBTb3J0RGlyZWN0aW9uXSB8IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IodGFibGU6IEhUTUxUYWJsZUVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLnRhYmxlID0gdGFibGU7XHJcbiAgICAgICAgdGhpcy5yb3dzID0gW107XHJcbiAgICAgICAgdGhpcy5jdXJyZW50X3NvcnQgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBDcmVhdGUgdGFibGUgaGVhZGVyIGFuZCBib2R5XHJcbiAgICAgICAgdGhpcy50aGVhZCA9IHRoaXMudGFibGUuY3JlYXRlVEhlYWQoKTtcclxuICAgICAgICB0aGlzLnRib2R5ID0gdGhpcy50YWJsZS5jcmVhdGVUQm9keSgpO1xyXG5cclxuICAgICAgICAvLyBQb3B1bGF0ZSBoZWFkIG9uY2UsIGhlcmVcclxuICAgICAgICBjb25zdCByb3cgPSB0aGlzLnRoZWFkLmluc2VydFJvdygpO1xyXG4gICAgICAgIGZvciAoY29uc3QgW2lkeCwgY29sXSBvZiBDT0xVTU5TLmVudHJpZXMoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBjZWxsID0gcm93Lmluc2VydENlbGwoKTtcclxuICAgICAgICAgICAgY2VsbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjb2wubmFtZSkpO1xyXG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBXaGljaCB3YXkgZG8gd2Ugc29ydD9cclxuICAgICAgICAgICAgICAgIGxldCBkaXI6IFNvcnREaXJlY3Rpb247XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50X3NvcnQgIT09IG51bGwgJiYgdGhpcy5jdXJyZW50X3NvcnRbMF0gPT09IGlkeCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpciA9IGZsaXBEaXJlY3Rpb24odGhpcy5jdXJyZW50X3NvcnRbMV0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXIgPSBcImFzY2VuZGluZ1wiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3NvcnQgPSBbaWR4LCBkaXJdO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENsZWFyIGFsbCB0aGUgaGVhZGVyIGJ1dHRvbnMsIGV4Y2VwdCBvdXJzZWx2ZXNcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSB0aGlzLnRoZWFkLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkJyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGhlYWRlciBvZiBoZWFkZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnJlbW92ZUF0dHJpYnV0ZShcImFyaWEtc29ydFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGhlYWRlcnNbaWR4XS5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIiwgZGlyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBOb3cgc29ydCB0aGUgcm93c1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0Um93cygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFdlJ2xsIGxlYXZlIHRoZSBib2R5IGVtcHR5IGJlY2F1c2UgaXQnbGwgYmUgcmVjb21wdXRlZCBmcm9tXHJcbiAgICAgICAgLy8gcmVwb3B1bGF0ZVRhYmxlKCksIGFuZCB3ZSBuZWVkIHRoZSBzZXR0aW5ncyB0byBiZSBhYmxlIHRvXHJcbiAgICAgICAgLy8gY3JlYXRlIHRoZSByb3dzIGFueXdheXMuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gVE9ETzogZG9uJ3QgcmVjcmVhdGUgcm93czsgY2hhbmdlIHRoZSB0ZXh0IGluc3RlYWRcclxuICAgIHB1YmxpYyByZXBvcHVsYXRlVGFibGUoc2V0dGluZ3M6IFNldHRpbmdzKSB7XHJcbiAgICAgICAgLy8gRGlzY2FyZCB0aGUgb2xkIHJvd3MgYW5kIGNyZWF0ZSBuZXcgb25lc1xyXG4gICAgICAgIHRoaXMudGJvZHkucmVwbGFjZUNoaWxkcmVuKCk7XHJcbiAgICAgICAgdGhpcy5yb3dzID0gW107XHJcbiAgICAgICAgZm9yIChjb25zdCBkZWYgb2YgQ1JPUF9ERUZJTklUSU9OUykge1xyXG4gICAgICAgICAgICAvLyBGaWx0ZXIgdG8gY3JvcHMgdGhhdCBhcmUgaW4tc2Vhc29uXHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBjYWxjdWxhdGUoZGVmLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgIGlmIChkYXRhID09IFwib3V0LW9mLXNlYXNvblwiKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLnRib2R5Lmluc2VydFJvdygpO1xyXG4gICAgICAgICAgICB0aGlzLnJvd3MucHVzaChuZXcgQ3JvcFJvdyhyb3csIGRhdGEpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFdlIGFsc28gbmVlZCB0byByZS1zb3J0IHRoZW0uIFxyXG4gICAgICAgIHRoaXMuc29ydFJvd3MoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNvcnRSb3dzKCkge1xyXG4gICAgICAgIC8vIElmIG5vIHNvcnQgc2VsZWN0ZWQsIGRlZmF1bHQgaXMgdG8gc29ydCBieSBuYW1lXHJcbiAgICAgICAgbGV0IGlkeDogbnVtYmVyO1xyXG4gICAgICAgIGxldCBkaXI6IFNvcnREaXJlY3Rpb247XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudF9zb3J0ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlkeCA9IDA7XHJcbiAgICAgICAgICAgIGRpciA9IFwiYXNjZW5kaW5nXCI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgW2lkeCwgZGlyXSA9IHRoaXMuY3VycmVudF9zb3J0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gV2UgZmlyc3Qgc29ydCBvdXIgb3duIGNvbGxlY3Rpb24sIHRoZW4gdXNlIHRoYXQgdG8gcmUtaW5zZXJ0XHJcbiAgICAgICAgLy8gb3VyIHJvdyBlbGVtZW50cy5cclxuICAgICAgICBjb25zdCBjb2wgPSBDT0xVTU5TW2lkeF07XHJcbiAgICAgICAgdGhpcy5yb3dzLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29tcGFyZSA9IGNvbC5jb21wYXJlKGEuZGF0YSwgYi5kYXRhKTtcclxuICAgICAgICAgICAgcmV0dXJuIGRpciA9PT0gXCJhc2NlbmRpbmdcIiA/IGNvbXBhcmUgOiAtY29tcGFyZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gVGhlbiB1c2UgdGhhdCB0byByZWFycmFuZ2UgdGhlIG5vZGVzIGluIHRoZSBib2R5XHJcbiAgICAgICAgZm9yIChjb25zdCByb3cgb2YgdGhpcy5yb3dzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGJvZHkuYXBwZW5kQ2hpbGQocm93LnJvdyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG50eXBlIElucHV0cyA9IHtcclxuICAgIHNlYXNvbjogU2Vhc29uLFxyXG4gICAgc3RhcnRfZGF5OiBudW1iZXIsXHJcbiAgICBtdWx0aXNlYXNvbl9jaGVja2VkOiBib29sZWFuLFxyXG4gICAgcXVhbGl0eV9jaGVja2VkOiBib29sZWFuLFxyXG4gICAgZmFybWluZ19sZXZlbDogbnVtYmVyLFxyXG4gICAgdGlsbGVyX2NoZWNrZWQ6IGJvb2xlYW4sXHJcbn07XHJcblxyXG5mdW5jdGlvbiB2aXN1YWxseUVuYWJsZVJvdyhyb3c6IEhUTUxFbGVtZW50LCBlbmFibGU6IGJvb2xlYW4pIHtcclxuICAgIGZvciAobGV0IGNlbGwgb2Ygcm93LnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0ZFwiKSkge1xyXG4gICAgICAgIGlmIChlbmFibGUpIHtcclxuICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBpbml0aWFsaXplKCkge1xyXG4gICAgY29uc29sZS5sb2coXCJJbml0aWFsaXppbmchXCIpO1xyXG5cclxuICAgIC8vIEZpbmQgYWxsIHRoZSBlbGVtZW50cyBJIG5lZWRcclxuICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjcm9wLXRhYmxlXCIpO1xyXG4gICAgaWYgKCEodGFibGUgaW5zdGFuY2VvZiBIVE1MVGFibGVFbGVtZW50KSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNyb3AtdGFibGUgc2hvdWxkIGJlIGEgPHRhYmxlPlwiKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpbnB1dF9wYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW5wdXQtcGFuZWxcIikhO1xyXG4gICAgY29uc3Qgc2Vhc29uX2lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MSW5wdXRFbGVtZW50PihcIiNzZWFzb25cIikhO1xyXG4gICAgY29uc3QgY3VycmVudF9kYXlfaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI2RheVwiKSE7XHJcbiAgICBjb25zdCBlbmFibGVfbXVsdGlzZWFzb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI2VuYWJsZS1tdWx0aXNlYXNvblwiKSE7XHJcbiAgICBjb25zdCBlbmFibGVfcXVhbGl0eSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTElucHV0RWxlbWVudD4oXCIjZW5hYmxlLXF1YWxpdHlcIikhO1xyXG4gICAgY29uc3QgZmFybWluZ19sZXZlbF9pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTElucHV0RWxlbWVudD4oXCIjZmFybWVyLWxldmVsXCIpITtcclxuICAgIGNvbnN0IGVuYWJsZV90aWxsZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI2VuYWJsZS10aWxsZXJcIikhO1xyXG5cclxuICAgIGxldCBxdWFsaXR5X2NlbGxzID0ge1xyXG4gICAgICAgIG5vcm1hbDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHBlcmNlbnQtbm9ybWFsYCkhLFxyXG4gICAgICAgIHNpbHZlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHBlcmNlbnQtc2lsdmVyYCkhLFxyXG4gICAgICAgIGdvbGQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBwZXJjZW50LWdvbGRgKSEsXHJcbiAgICAgICAgaXJpZGl1bTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHBlcmNlbnQtaXJpZGl1bWApISxcclxuICAgIH07XHJcbiAgICBsZXQgYXZnX3F1YWxpdHlfY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXZlcmFnZS1xdWFsaXR5XCIpITtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGFibGUgY29tcG9uZW50XHJcbiAgICBjb25zdCB0YWJsZV9jb21wb25lbnQgPSBuZXcgQ3JvcFRhYmxlKHRhYmxlKTtcclxuXHJcbiAgICAvLyBSZWFkIGlucHV0c1xyXG4gICAgZnVuY3Rpb24gcmVhZElucHV0cygpOiBJbnB1dHMge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNlYXNvbjogU2Vhc29uLmZyb21TdHJpbmcoc2Vhc29uX2lucHV0LnZhbHVlKSxcclxuICAgICAgICAgICAgc3RhcnRfZGF5OiBjdXJyZW50X2RheV9pbnB1dC52YWx1ZUFzTnVtYmVyLFxyXG4gICAgICAgICAgICBtdWx0aXNlYXNvbl9jaGVja2VkOiBlbmFibGVfbXVsdGlzZWFzb24uY2hlY2tlZCxcclxuICAgICAgICAgICAgcXVhbGl0eV9jaGVja2VkOiBlbmFibGVfcXVhbGl0eS5jaGVja2VkLFxyXG4gICAgICAgICAgICBmYXJtaW5nX2xldmVsOiBmYXJtaW5nX2xldmVsX2lucHV0LnZhbHVlQXNOdW1iZXIsXHJcbiAgICAgICAgICAgIHRpbGxlcl9jaGVja2VkOiBlbmFibGVfdGlsbGVyLmNoZWNrZWQsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBcHBsaWVzIHRoZSBpbnB1dCBzZXR0aW5ncyB0byB0aGUgZG9jdW1lbnRcclxuICAgIGZ1bmN0aW9uIHJlYWRBbmRBcHBseVNldHRpbmdzKCkge1xyXG4gICAgICAgIC8vIFJlYWQgYWxsIHRoZSBpbnB1dHNcclxuICAgICAgICBjb25zdCBpbnB1dHMgPSByZWFkSW5wdXRzKCk7XHJcblxyXG4gICAgICAgIC8vIENvbnN0cnVjdCB0aGUgc2V0dGluZ3NcclxuICAgICAgICBjb25zdCBxdWFsaXR5ID0gY29tcHV0ZVF1YWxpdHkoaW5wdXRzLmZhcm1pbmdfbGV2ZWwpO1xyXG4gICAgICAgIGxldCBzZXR0aW5nczogU2V0dGluZ3MgPSB7XHJcbiAgICAgICAgICAgIHNlYXNvbjogaW5wdXRzLnNlYXNvbixcclxuICAgICAgICAgICAgc3RhcnRfZGF5OiBpbnB1dHMuc3RhcnRfZGF5LFxyXG4gICAgICAgICAgICBtdWx0aXNlYXNvbl9lbmFibGVkOiBpbnB1dHMubXVsdGlzZWFzb25fY2hlY2tlZCxcclxuICAgICAgICAgICAgcXVhbGl0eV9wcm9iYWJpbGl0aWVzOiBlbmFibGVfcXVhbGl0eS5jaGVja2VkID8gcXVhbGl0eSA6IG51bGwsXHJcbiAgICAgICAgICAgIHRpbGxlcl9lbmFibGVkOiBlbmFibGVfdGlsbGVyLmNoZWNrZWQsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gVG91Y2ggdGhlIGRpc3BsYXkgZWxlbWVudHNcclxuICAgICAgICBsZXQgcTogUXVhbGl0eVR5cGVzO1xyXG4gICAgICAgIGZvciAocSBpbiBxdWFsaXR5X2NlbGxzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBlcmNlbnQgPSAxMDAgKiBxdWFsaXR5W3FdO1xyXG4gICAgICAgICAgICBxdWFsaXR5X2NlbGxzW3FdLnRleHRDb250ZW50ID0gYCR7cGVyY2VudC50b0ZpeGVkKDApfSVgO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBxdWFsaXR5X2ZhY3RvciA9IHF1YWxpdHkubm9ybWFsICsgcXVhbGl0eS5zaWx2ZXIgKiAxLjI1ICsgcXVhbGl0eS5nb2xkICogMS41ICsgcXVhbGl0eS5pcmlkaXVtICogMi4wO1xyXG4gICAgICAgIGF2Z19xdWFsaXR5X2NlbGwudGV4dENvbnRlbnQgPSBxdWFsaXR5X2ZhY3Rvci50b0ZpeGVkKDIpO1xyXG5cclxuICAgICAgICAvLyBEaXNhYmxlIGNlcnRhaW4gZWxlbWVudHNcclxuICAgICAgICB2aXN1YWxseUVuYWJsZVJvdyhlbmFibGVfdGlsbGVyLnBhcmVudEVsZW1lbnQhLnBhcmVudEVsZW1lbnQhLCBpbnB1dHMuZmFybWluZ19sZXZlbCA+PSA1KTtcclxuICAgICAgICBpZiAoaW5wdXRzLmZhcm1pbmdfbGV2ZWwgPCA1KSB7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLnRpbGxlcl9lbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKHEgaW4gcXVhbGl0eV9jZWxscykge1xyXG4gICAgICAgICAgICB2aXN1YWxseUVuYWJsZVJvdyhxdWFsaXR5X2NlbGxzW3FdLnBhcmVudEVsZW1lbnQhLCBpbnB1dHMucXVhbGl0eV9jaGVja2VkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmlzdWFsbHlFbmFibGVSb3coYXZnX3F1YWxpdHlfY2VsbC5wYXJlbnRFbGVtZW50ISwgaW5wdXRzLnF1YWxpdHlfY2hlY2tlZCk7XHJcblxyXG4gICAgICAgIC8vIFJlcG9wdWxhdGUgdGFibGUgYW5kIGNoYW5nZSBzdHlsZVxyXG4gICAgICAgIHRhYmxlX2NvbXBvbmVudC5yZXBvcHVsYXRlVGFibGUoc2V0dGluZ3MpO1xyXG4gICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUgPSBzZWFzb25faW5wdXQudmFsdWUudG9Mb3dlckNhc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSdW4gaXQgb25jZSB0byBhcHBseSB0aGUgZGVmYXVsdCBzZXR0aW5ncy5cclxuICAgIHJlYWRBbmRBcHBseVNldHRpbmdzKCk7XHJcblxyXG4gICAgLy8gQXR0YWNoIGV2ZW50IGxpc3RlbmVyc1xyXG4gICAgaW5wdXRfcGFuZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICByZWFkQW5kQXBwbHlTZXR0aW5ncygpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcblxyXG4vLyBBbHJpZ2h0eSwgd2UncmUgcmVhZHkgdG8gZ28hIFdhaXQgZm9yIHRoZSBET00gdG8gZmluaXNoIGxvYWRpbmcgKG9yIHNlZSBpZiBpdFxyXG4vLyBhbHJlYWR5IGhhcy5cclxuaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09IFwibG9hZGluZ1wiKSB7XHJcbiAgICAvLyBMb2FkaW5nIGhhc24ndCBmaW5pc2hlZCB5ZXRcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGluaXRpYWxpemUpO1xyXG59IGVsc2Uge1xyXG4gICAgLy8gYERPTUNvbnRlbnRMb2FkZWRgIGhhcyBhbHJlYWR5IGZpcmVkXHJcbiAgICBpbml0aWFsaXplKCk7XHJcbn0iXSwibmFtZXMiOlsiU2Vhc29uIiwiZnJvbVN0cmluZyIsInMiLCJ0b1VwcGVyQ2FzZSIsIlNQUklORyIsIlNVTU1FUiIsIkZBTEwiLCJXSU5URVIiLCJFcnJvciIsIlNJTFZFUl9NVUxUSVBMSUVSIiwiR09MRF9NVUxUSVBMSUVSIiwiSVJJRElVTV9NVUxUSVBMSUVSIiwiY2FsY3VsYXRlIiwiY3JvcCIsInNldHRpbmdzIiwic2Vhc29ucyIsIm51bV9zZWFzb25zIiwibXVsdGlzZWFzb24iLCJpIiwicHVzaCIsInNlYXNvbiIsInZhbHVlT2YiLCJpbmNsdWRlcyIsImRheXNfbGVmdCIsIm11bHRpc2Vhc29uX2VuYWJsZWQiLCJsZW5ndGgiLCJpbmRleE9mIiwic3RhcnRfZGF5IiwibnVtX2hhcnZlc3RzIiwidXNlZnVsX2RheXMiLCJkYXlzX3RvX2dyb3ciLCJyZWdyb3d0aF9wZXJpb2QiLCJleHRyYV9oYXJ2ZXN0cyIsIk1hdGgiLCJmbG9vciIsImJhc2VfcHJpY2UiLCJzZWxsX3ByaWNlIiwicXVhbGl0eV9wcmljZSIsInF1YWxpdHlfcHJvYmFiaWxpdGllcyIsInEiLCJub3JtYWwiLCJzaWx2ZXIiLCJnb2xkIiwiaXJpZGl1bSIsIm1hcCIsIm11bHRpcGxpZXIiLCJwIiwidHJ1bmMiLCJyZWR1Y2UiLCJhIiwiYiIsIm51bV9jcm9wc19wZXJfaGFydmVzdCIsInlpZWxkIiwicGVyY2VudF9jaGFuY2VfZXh0cmEiLCJyZXZlbnVlX3Blcl9oYXJ2ZXN0IiwidGlsbGVyX2VuYWJsZWQiLCJwcm9maXQiLCJzZWVkX2Nvc3QiLCJkZWZpbml0aW9uIiwibnVtX2Nyb3BzIiwiZGFpbHlfcHJvZml0IiwiQ09MVU1OUyIsIm5hbWUiLCJjZWxsVGV4dCIsImNvbXBhcmUiLCJsb2NhbGVDb21wYXJlIiwidG9TdHJpbmciLCJ1bmRlZmluZWQiLCJ5aWVsZF9udW0iLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJ0b0ZpeGVkIiwiaXNGaW5pdGUiLCJDcm9wUm93IiwiY29uc3RydWN0b3IiLCJyb3ciLCJkYXRhIiwidGhpcyIsImNvbCIsInZhbHVlIiwiaW5zZXJ0Q2VsbCIsImFwcGVuZENoaWxkIiwiZG9jdW1lbnQiLCJjcmVhdGVUZXh0Tm9kZSIsImZsaXBEaXJlY3Rpb24iLCJ4IiwiQ3JvcFRhYmxlIiwidGFibGUiLCJyb3dzIiwiY3VycmVudF9zb3J0IiwidGhlYWQiLCJjcmVhdGVUSGVhZCIsInRib2R5IiwiY3JlYXRlVEJvZHkiLCJpbnNlcnRSb3ciLCJpZHgiLCJlbnRyaWVzIiwiY2VsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkaXIiLCJoZWFkZXJzIiwicXVlcnlTZWxlY3RvckFsbCIsImhlYWRlciIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsInNvcnRSb3dzIiwicmVwb3B1bGF0ZVRhYmxlIiwicmVwbGFjZUNoaWxkcmVuIiwiZGVmIiwic29ydCIsInZpc3VhbGx5RW5hYmxlUm93IiwiZW5hYmxlIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiYWRkIiwiaW5pdGlhbGl6ZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRFbGVtZW50QnlJZCIsIkhUTUxUYWJsZUVsZW1lbnQiLCJpbnB1dF9wYW5lbCIsInNlYXNvbl9pbnB1dCIsInF1ZXJ5U2VsZWN0b3IiLCJjdXJyZW50X2RheV9pbnB1dCIsImVuYWJsZV9tdWx0aXNlYXNvbiIsImVuYWJsZV9xdWFsaXR5IiwiZmFybWluZ19sZXZlbF9pbnB1dCIsImVuYWJsZV90aWxsZXIiLCJxdWFsaXR5X2NlbGxzIiwiYXZnX3F1YWxpdHlfY2VsbCIsInRhYmxlX2NvbXBvbmVudCIsInJlYWRBbmRBcHBseVNldHRpbmdzIiwiaW5wdXRzIiwidmFsdWVBc051bWJlciIsIm11bHRpc2Vhc29uX2NoZWNrZWQiLCJjaGVja2VkIiwicXVhbGl0eV9jaGVja2VkIiwiZmFybWluZ19sZXZlbCIsInRpbGxlcl9jaGVja2VkIiwicXVhbGl0eSIsInBfZ29sZF9jb2luIiwicF9pcmlkaXVtX2NvaW4iLCJtaW4iLCJjb21wdXRlUXVhbGl0eSIsInBlcmNlbnQiLCJ0ZXh0Q29udGVudCIsInF1YWxpdHlfZmFjdG9yIiwicGFyZW50RWxlbWVudCIsImRvY3VtZW50RWxlbWVudCIsImNsYXNzTmFtZSIsInRvTG93ZXJDYXNlIiwiZXZlbnQiLCJyZWFkeVN0YXRlIl0sInNvdXJjZVJvb3QiOiIifQ==