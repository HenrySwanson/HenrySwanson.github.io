(()=>{"use strict";const e=JSON.parse('[{"name":"Blue Jazz","season":"Spring","seed_cost":30,"sell_price":50,"days_to_grow":7},{"name":"Carrot","season":"Spring","seed_cost":0,"sell_price":35,"days_to_grow":3},{"name":"Cauliflower","season":"Spring","seed_cost":80,"sell_price":175,"days_to_grow":12},{"name":"Coffee Bean","season":"Spring","multiseason":2,"seed_cost":15,"sell_price":15,"days_to_grow":10,"regrowth_period":2,"yield":4,"percent_chance_extra":2},{"name":"Garlic","season":"Spring","seed_cost":40,"sell_price":60,"days_to_grow":4},{"name":"Green Bean","season":"Spring","seed_cost":60,"sell_price":40,"days_to_grow":10,"regrowth_period":3},{"name":"Kale","season":"Spring","seed_cost":70,"sell_price":110,"days_to_grow":6},{"name":"Parsnip","season":"Spring","seed_cost":20,"sell_price":35,"days_to_grow":4},{"name":"Potato","season":"Spring","seed_cost":50,"sell_price":80,"days_to_grow":6,"percent_chance_extra":25},{"name":"Rhubarb","season":"Spring","seed_cost":100,"sell_price":220,"days_to_grow":13},{"name":"Rice","season":"Spring","seed_cost":40,"sell_price":30,"days_to_grow":6},{"name":"Strawberry","season":"Spring","seed_cost":100,"sell_price":120,"days_to_grow":8,"regrowth_period":4,"percent_chance_extra":2},{"name":"Tulip","season":"Spring","seed_cost":20,"sell_price":30,"days_to_grow":6},{"name":"Blueberry","season":"Summer","seed_cost":80,"sell_price":50,"days_to_grow":13,"regrowth_period":4,"yield":3,"percent_chance_extra":2},{"name":"Corn","season":"Summer","multiseason":2,"seed_cost":150,"sell_price":50,"days_to_grow":14,"regrowth_period":4},{"name":"Hops","season":"Summer","seed_cost":60,"sell_price":25,"days_to_grow":11,"regrowth_period":1},{"name":"Hot Pepper","season":"Summer","seed_cost":40,"sell_price":40,"days_to_grow":5,"regrowth_period":3,"percent_chance_extra":3},{"name":"Melon","season":"Summer","seed_cost":80,"sell_price":250,"days_to_grow":12},{"name":"Poppy","season":"Summer","seed_cost":100,"sell_price":140,"days_to_grow":7},{"name":"Radish","season":"Summer","seed_cost":40,"sell_price":90,"days_to_grow":6},{"name":"Red Cabbage","season":"Summer","seed_cost":100,"sell_price":260,"days_to_grow":9},{"name":"Starfruit","season":"Summer","seed_cost":400,"sell_price":750,"days_to_grow":13},{"name":"Summer Spangle","season":"Summer","seed_cost":50,"sell_price":90,"days_to_grow":8},{"name":"Summer Squash","season":"Summer","seed_cost":0,"sell_price":45,"days_to_grow":6},{"name":"Sunflower","season":"Summer","multiseason":2,"seed_cost":200,"sell_price":80,"days_to_grow":8},{"name":"Tomato","season":"Summer","seed_cost":50,"sell_price":60,"days_to_grow":11,"regrowth_period":4,"percent_chance_extra":5},{"name":"Wheat","season":"Summer","multiseason":2,"seed_cost":10,"sell_price":25,"days_to_grow":4},{"name":"Amaranth","season":"Fall","seed_cost":70,"sell_price":150,"days_to_grow":7},{"name":"Artichoke","season":"Fall","seed_cost":30,"sell_price":160,"days_to_grow":8},{"name":"Beet","season":"Fall","seed_cost":20,"sell_price":100,"days_to_grow":6},{"name":"Bok Choy","season":"Fall","seed_cost":50,"sell_price":80,"days_to_grow":4},{"name":"Broccoli","season":"Fall","seed_cost":0,"sell_price":70,"days_to_grow":8},{"name":"Cranberries","season":"Fall","seed_cost":240,"sell_price":75,"days_to_grow":7,"regrowth_period":5,"yield":2,"percent_chance_extra":10},{"name":"Eggplant","season":"Fall","seed_cost":20,"sell_price":60,"days_to_grow":5,"regrowth_period":5,"percent_chance_extra":0.2},{"name":"Fairy Rose","season":"Fall","seed_cost":200,"sell_price":290,"days_to_grow":12},{"name":"Grape","season":"Fall","seed_cost":60,"sell_price":80,"days_to_grow":10,"regrowth_period":3},{"name":"Pumpkin","season":"Fall","seed_cost":100,"sell_price":320,"days_to_grow":13},{"name":"Yam","season":"Fall","seed_cost":60,"sell_price":160,"days_to_grow":10},{"name":"Powdermelon","season":"Winter","seed_cost":0,"sell_price":60,"days_to_grow":7}]');var o;function s(e,s){var r,t,a,n,l,_;let c=[],i=null!==(r=e.multiseason)&&void 0!==r?r:1;for(let s=0;s<i;s++)c.push(o.fromString(e.season).valueOf()+s);if(!c.includes(s.season))return"out-of-season";let d=28*(s.multiseason_enabled?c.length-c.indexOf(s.season):1)-s.start_day,p=0,m=0;if(d>=e.days_to_grow&&(p+=1,m+=e.days_to_grow,e.regrowth_period)){let o=Math.floor((d-e.days_to_grow)/e.regrowth_period);p+=o,m+=o*e.regrowth_period}let u=p*((null!==(t=e.yield)&&void 0!==t?t:1)+(null!==(a=e.percent_chance_extra)&&void 0!==a?a:0)/100),g=u*e.sell_price-e.seed_cost,w=g/m;return{name:e.name,seed_cost:e.seed_cost,sell_price:e.sell_price,days_to_grow:e.days_to_grow,regrowth_period:null!==(n=e.regrowth_period)&&void 0!==n?n:null,yield:null!==(l=e.yield)&&void 0!==l?l:null,percent_chance_extra:null!==(_=e.percent_chance_extra)&&void 0!==_?_:null,useful_days:m,num_harvests:p,num_crops:u,profit:g,daily_profit:w}}!function(e){e[e.SPRING=0]="SPRING",e[e.SUMMER=1]="SUMMER",e[e.FALL=2]="FALL",e[e.WINTER=3]="WINTER"}(o||(o={})),function(e){e.fromString=function(o){switch(o.toUpperCase()){case"SPRING":return e.SPRING;case"SUMMER":return e.SUMMER;case"FALL":return e.FALL;case"WINTER":return e.WINTER;default:throw new Error(`Unknown season ${o}`)}}}(o||(o={}));const r=[{name:"Name",cellText:e=>e.name,compare:(e,o)=>e.name.localeCompare(o.name)},{name:"Seed Cost",cellText:e=>e.seed_cost.toString(),compare:(e,o)=>e.seed_cost-o.seed_cost},{name:"Sell Price",cellText:e=>e.sell_price.toString(),compare:(e,o)=>e.sell_price-o.sell_price},{name:"Days to Grow",cellText:e=>e.days_to_grow.toString(),compare:(e,o)=>e.days_to_grow-o.days_to_grow},{name:"Regrowth Period",cellText:e=>{var o,s;return null!==(s=null===(o=e.regrowth_period)||void 0===o?void 0:o.toString())&&void 0!==s?s:"-"},compare:(e,o)=>null===o.regrowth_period?-1:null===e.regrowth_period?1:e.regrowth_period-o.regrowth_period},{name:"Yield",cellText:e=>{var o;let s=null!==(o=e.yield)&&void 0!==o?o:1;return e.percent_chance_extra?`${s} + ${e.percent_chance_extra}%`:s.toString()},compare:(e,o)=>{var s,r,t,a;return(null!==(s=e.yield)&&void 0!==s?s:1)+(null!==(r=e.percent_chance_extra)&&void 0!==r?r:0)/100-((null!==(t=o.yield)&&void 0!==t?t:1)+(null!==(a=o.percent_chance_extra)&&void 0!==a?a:0)/100)}},{name:"Useful Days",cellText:e=>e.useful_days.toString(),compare:(e,o)=>e.useful_days-o.useful_days},{name:"Num Harvests",cellText:e=>e.num_harvests.toString(),compare:(e,o)=>e.num_crops-o.num_crops},{name:"Num Crops",cellText:e=>{let o=e.num_crops;return Number.isInteger(o)?o.toString():e.num_crops.toFixed(2)},compare:(e,o)=>e.num_crops-o.num_crops},{name:"Profit",cellText:e=>e.profit.toFixed(2),compare:(e,o)=>e.profit-o.profit},{name:"Daily Profit",cellText:e=>Number.isFinite(e.daily_profit)?e.daily_profit.toFixed(2):"-",compare:(e,o)=>e.daily_profit-o.daily_profit}];class t{constructor(e,o){this.data=o,this.row=e;for(let e of r){let o=e.cellText(this.data);this.row.insertCell().appendChild(document.createTextNode(o))}}}function a(e){switch(e){case"ascending":return"descending";case"descending":return"ascending"}}class n{constructor(e){this.table=e,this.rows=[],this.current_sort=null,this.thead=this.table.createTHead(),this.tbody=this.table.createTBody();let o=this.thead.insertRow();for(let[e,s]of r.entries()){let r=o.insertCell();r.appendChild(document.createTextNode(s.name)),r.addEventListener("click",(o=>{let s;s=null!==this.current_sort&&this.current_sort[0]===e?a(this.current_sort[1]):"ascending",this.current_sort=[e,s];let r=this.thead.querySelectorAll("td");for(let e of r)e.removeAttribute("aria-sort");r[e].setAttribute("aria-sort",s),this.sortRows()}))}}repopulateTable(o){this.tbody.replaceChildren(),this.rows=[];for(let r of e){let e=s(r,o);if("out-of-season"==e)continue;let a=this.tbody.insertRow();this.rows.push(new t(a,e))}this.sortRows()}sortRows(){let e,o;null===this.current_sort?(e=0,o="ascending"):[e,o]=this.current_sort;let s=r[e];this.rows.sort(((e,r)=>{let t=s.compare(e.data,r.data);return"ascending"===o?t:-t}));for(let e of this.rows)this.tbody.appendChild(e.row)}}function l(){console.log("Initializing!");let e=document.getElementById("crop-table");if(!(e instanceof HTMLTableElement))throw new Error("crop-table should be a <table>");let s=document.getElementById("input-panel"),r=document.querySelector("#season"),t=document.querySelector("#day"),a=document.querySelector("#enable-multiseason"),l=new n(e);function _(){let e={season:o.fromString(r.value),start_day:t.valueAsNumber,multiseason_enabled:a.checked};l.repopulateTable(e),document.documentElement.className=r.value.toLowerCase()}_(),s.addEventListener("change",(e=>{_()}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTb0MsY0FBZ0MsdUJBRzlERyxFQUFrQixJQUFJbkMsRUFBVUMsR0FHcEMsU0FBU21DLElBRUwsSUFBSWxHLEVBQXFCLENBQ3JCTyxPQUFRVixFQUFPUyxXQUFXdUYsRUFBYXRDLE9BQ3ZDekMsVUFBV2lGLEVBQWtCSSxjQUM3QnhGLG9CQUFxQnFGLEVBQW1CSSxTQUk1Q0gsRUFBZ0JkLGdCQUFnQm5GLEdBQ2hDMEQsU0FBUzJDLGdCQUFnQkMsVUFBWVQsRUFBYXRDLE1BQU1nRCxhQUM1RCxDQUdBTCxJQUdBTixFQUFZbEIsaUJBQWlCLFVBQVdDLElBQ3BDdUIsR0FBc0IsR0FFOUIsQ0FLNEIsWUFBeEJ4QyxTQUFTOEMsV0FFVDlDLFNBQVNnQixpQkFBaUIsbUJBQW9CYSxHQUc5Q0EsRyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9jcm9wcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuXHJcbi8vIHNob3VsZCBpIHB1bGwgdGhpcyBmcm9tIGEgSlNPTiBsaWtlIGknbSBkb2luZyBub3c/IG9yIHNob3VsZCBpIGp1c3RcclxuLy8gaGFyZC1jb2RlIGl0IGlubGluZSAobWlnaHQgYmUgbW9yZSByZWFkYWJsZSlcclxuaW1wb3J0IENST1BfREVGSU5JVElPTlMgZnJvbSBcIi4vY3JvcHMuanNvblwiO1xyXG5cclxuLyogPT09PT09PT0gQ0FMQ1VMQVRJT04gPT09PT09PT0gKi9cclxuXHJcbnR5cGUgQ3JvcERlZmluaXRpb24gPSB0eXBlb2YgQ1JPUF9ERUZJTklUSU9OU1tudW1iZXJdO1xyXG5cclxuZW51bSBTZWFzb24ge1xyXG4gICAgU1BSSU5HLCBTVU1NRVIsIEZBTEwsIFdJTlRFUlxyXG59XHJcblxyXG5uYW1lc3BhY2UgU2Vhc29uIHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBmcm9tU3RyaW5nKHM6IHN0cmluZyk6IFNlYXNvbiB7XHJcbiAgICAgICAgc3dpdGNoIChzLnRvVXBwZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgY2FzZSBcIlNQUklOR1wiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5TUFJJTkc7XHJcbiAgICAgICAgICAgIGNhc2UgXCJTVU1NRVJcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uU1VNTUVSO1xyXG4gICAgICAgICAgICBjYXNlIFwiRkFMTFwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5GQUxMO1xyXG4gICAgICAgICAgICBjYXNlIFwiV0lOVEVSXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU2Vhc29uLldJTlRFUjtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBzZWFzb24gJHtzfWApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxudHlwZSBDcm9wRGF0YSA9IHtcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHNlZWRfY29zdDogbnVtYmVyLFxyXG4gICAgc2VsbF9wcmljZTogbnVtYmVyLFxyXG4gICAgZGF5c190b19ncm93OiBudW1iZXIsXHJcbiAgICByZWdyb3d0aF9wZXJpb2Q6IG51bWJlciB8IG51bGwsXHJcbiAgICB5aWVsZDogbnVtYmVyIHwgbnVsbCxcclxuICAgIHBlcmNlbnRfY2hhbmNlX2V4dHJhOiBudW1iZXIgfCBudWxsLFxyXG4gICAgdXNlZnVsX2RheXM6IG51bWJlcixcclxuICAgIG51bV9oYXJ2ZXN0czogbnVtYmVyLFxyXG4gICAgbnVtX2Nyb3BzOiBudW1iZXIsXHJcbiAgICBwcm9maXQ6IG51bWJlcixcclxuICAgIGRhaWx5X3Byb2ZpdDogbnVtYmVyLFxyXG59O1xyXG5cclxudHlwZSBTZXR0aW5ncyA9IHtcclxuICAgIHNlYXNvbjogU2Vhc29uLFxyXG4gICAgc3RhcnRfZGF5OiBudW1iZXIsXHJcbiAgICBtdWx0aXNlYXNvbl9lbmFibGVkOiBib29sZWFuLFxyXG59O1xyXG5cclxuZnVuY3Rpb24gY2FsY3VsYXRlKGNyb3A6IENyb3BEZWZpbml0aW9uLCBzZXR0aW5nczogU2V0dGluZ3MpOiBDcm9wRGF0YSB8IFwib3V0LW9mLXNlYXNvblwiIHtcclxuICAgIC8vIFdoZW4gaXMgdGhpcyBjcm9wIGluLXNlYXNvbj9cclxuICAgIGxldCBzZWFzb25zOiBTZWFzb25bXSA9IFtdO1xyXG4gICAgbGV0IG51bV9zZWFzb25zID0gY3JvcC5tdWx0aXNlYXNvbiA/PyAxO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1fc2Vhc29uczsgaSsrKSB7XHJcbiAgICAgICAgc2Vhc29ucy5wdXNoKFNlYXNvbi5mcm9tU3RyaW5nKGNyb3Auc2Vhc29uKS52YWx1ZU9mKCkgKyBpKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBCYWlsIG91dCBpZiB3ZSdyZSBvdXQgb2Ygc2Vhc29uXHJcbiAgICBpZiAoIXNlYXNvbnMuaW5jbHVkZXMoc2V0dGluZ3Muc2Vhc29uKSkge1xyXG4gICAgICAgIHJldHVybiBcIm91dC1vZi1zZWFzb25cIjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBIb3cgbWFueSBkYXlzIGRvIHdlIGhhdmUgbGVmdD9cclxuICAgIGxldCBzZWFzb25zX2xlZnQgPSBzZXR0aW5ncy5tdWx0aXNlYXNvbl9lbmFibGVkXHJcbiAgICAgICAgPyBzZWFzb25zLmxlbmd0aCAtIHNlYXNvbnMuaW5kZXhPZihzZXR0aW5ncy5zZWFzb24pXHJcbiAgICAgICAgOiAxO1xyXG4gICAgbGV0IGRheXNfbGVmdCA9IDI4ICogc2Vhc29uc19sZWZ0IC0gc2V0dGluZ3Muc3RhcnRfZGF5O1xyXG5cclxuICAgIC8vIFdoYXQncyB0aGUgcHJvZml0PyBEZXBlbmRzIGhvdyBtYW55IGhhcnZlc3RzIHdlIGNhbiBnZXQgdGhpcyBzZWFzb24uXHJcbiAgICBsZXQgbnVtX2hhcnZlc3RzID0gMDtcclxuICAgIGxldCB1c2VmdWxfZGF5cyA9IDA7XHJcbiAgICBpZiAoZGF5c19sZWZ0ID49IGNyb3AuZGF5c190b19ncm93KSB7XHJcbiAgICAgICAgbnVtX2hhcnZlc3RzICs9IDE7XHJcbiAgICAgICAgdXNlZnVsX2RheXMgKz0gY3JvcC5kYXlzX3RvX2dyb3c7XHJcbiAgICAgICAgaWYgKGNyb3AucmVncm93dGhfcGVyaW9kKSB7XHJcbiAgICAgICAgICAgIGxldCBleHRyYV9oYXJ2ZXN0cyA9IE1hdGguZmxvb3IoKGRheXNfbGVmdCAtIGNyb3AuZGF5c190b19ncm93KSAvIGNyb3AucmVncm93dGhfcGVyaW9kKTtcclxuICAgICAgICAgICAgbnVtX2hhcnZlc3RzICs9IGV4dHJhX2hhcnZlc3RzO1xyXG4gICAgICAgICAgICB1c2VmdWxfZGF5cyArPSBleHRyYV9oYXJ2ZXN0cyAqIGNyb3AucmVncm93dGhfcGVyaW9kO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBXZSBjYW4gc29tZXRpbWVzIGdldCBtdWx0aXBsZSBjcm9wcyBwZXIgaGFydmVzdFxyXG4gICAgbGV0IG51bV9jcm9wcyA9IG51bV9oYXJ2ZXN0cyAqICgoY3JvcC55aWVsZCA/PyAxKSArIChjcm9wLnBlcmNlbnRfY2hhbmNlX2V4dHJhID8/IDApIC8gMTAwKTtcclxuXHJcbiAgICBsZXQgcHJvZml0ID0gbnVtX2Nyb3BzICogY3JvcC5zZWxsX3ByaWNlIC0gY3JvcC5zZWVkX2Nvc3Q7XHJcbiAgICBsZXQgZGFpbHlfcHJvZml0ID0gcHJvZml0IC8gdXNlZnVsX2RheXM7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBuYW1lOiBjcm9wLm5hbWUsXHJcbiAgICAgICAgc2VlZF9jb3N0OiBjcm9wLnNlZWRfY29zdCxcclxuICAgICAgICBzZWxsX3ByaWNlOiBjcm9wLnNlbGxfcHJpY2UsXHJcbiAgICAgICAgZGF5c190b19ncm93OiBjcm9wLmRheXNfdG9fZ3JvdyxcclxuICAgICAgICByZWdyb3d0aF9wZXJpb2Q6IGNyb3AucmVncm93dGhfcGVyaW9kID8/IG51bGwsXHJcbiAgICAgICAgeWllbGQ6IGNyb3AueWllbGQgPz8gbnVsbCxcclxuICAgICAgICBwZXJjZW50X2NoYW5jZV9leHRyYTogY3JvcC5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyBudWxsLFxyXG4gICAgICAgIHVzZWZ1bF9kYXlzLFxyXG4gICAgICAgIG51bV9oYXJ2ZXN0cyxcclxuICAgICAgICBudW1fY3JvcHMsXHJcbiAgICAgICAgcHJvZml0LFxyXG4gICAgICAgIGRhaWx5X3Byb2ZpdCxcclxuICAgIH07XHJcbn1cclxuXHJcbi8qID09PT09PT09IEdVSSA9PT09PT09PSAqL1xyXG5cclxuLy8gRGVmaW5lcyB0aGUgc2V0IG9mIGNvbHVtbnMgZm9yIHRoZSB3aG9sZSB0YWJsZS5cclxudHlwZSBDb2x1bW4gPSB7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBzdHJpbmc7XHJcbiAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBudW1iZXI7XHJcbn07XHJcblxyXG5jb25zdCBDT0xVTU5TOiBDb2x1bW5bXSA9IFtcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIk5hbWVcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLm5hbWUsXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJTZWVkIENvc3RcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLnNlZWRfY29zdC50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuc2VlZF9jb3N0IC0gYi5zZWVkX2Nvc3QsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiU2VsbCBQcmljZVwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3Auc2VsbF9wcmljZS50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuc2VsbF9wcmljZSAtIGIuc2VsbF9wcmljZSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJEYXlzIHRvIEdyb3dcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLmRheXNfdG9fZ3Jvdy50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGF5c190b19ncm93IC0gYi5kYXlzX3RvX2dyb3csXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiUmVncm93dGggUGVyaW9kXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5yZWdyb3d0aF9wZXJpb2Q/LnRvU3RyaW5nKCkgPz8gXCItXCIsXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYi5yZWdyb3d0aF9wZXJpb2QgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhLnJlZ3Jvd3RoX3BlcmlvZCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGEucmVncm93dGhfcGVyaW9kIC0gYi5yZWdyb3d0aF9wZXJpb2Q7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIllpZWxkXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgeWllbGRfbnVtID0gY3JvcC55aWVsZCA/PyAxO1xyXG4gICAgICAgICAgICBpZiAoY3JvcC5wZXJjZW50X2NoYW5jZV9leHRyYSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3lpZWxkX251bX0gKyAke2Nyb3AucGVyY2VudF9jaGFuY2VfZXh0cmF9JWA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGRfbnVtLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IHtcclxuICAgICAgICAgICAgLy8gc2xpZ2h0IGhhY2sgLS0gcmVwcmVzZW50IGFzIGEgKyBiLzEwMFxyXG4gICAgICAgICAgICBsZXQgYV9udW0gPSAoYS55aWVsZCA/PyAxKSArIChhLnBlcmNlbnRfY2hhbmNlX2V4dHJhID8/IDApIC8gMTAwO1xyXG4gICAgICAgICAgICBsZXQgYl9udW0gPSAoYi55aWVsZCA/PyAxKSArIChiLnBlcmNlbnRfY2hhbmNlX2V4dHJhID8/IDApIC8gMTAwO1xyXG4gICAgICAgICAgICByZXR1cm4gYV9udW0gLSBiX251bTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiVXNlZnVsIERheXNcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLnVzZWZ1bF9kYXlzLnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS51c2VmdWxfZGF5cyAtIGIudXNlZnVsX2RheXMsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiTnVtIEhhcnZlc3RzXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5udW1faGFydmVzdHMudG9TdHJpbmcoKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLm51bV9jcm9wcyAtIGIubnVtX2Nyb3BzLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIk51bSBDcm9wc1wiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IHtcclxuICAgICAgICAgICAgbGV0IG51bV9jcm9wcyA9IGNyb3AubnVtX2Nyb3BzO1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihudW1fY3JvcHMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtX2Nyb3BzLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNyb3AubnVtX2Nyb3BzLnRvRml4ZWQoMik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLm51bV9jcm9wcyAtIGIubnVtX2Nyb3BzLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlByb2ZpdFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AucHJvZml0LnRvRml4ZWQoMiksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5wcm9maXQgLSBiLnByb2ZpdCxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJEYWlseSBQcm9maXRcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUoY3JvcC5kYWlseV9wcm9maXQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY3JvcC5kYWlseV9wcm9maXQudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gXCItXCI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLmRhaWx5X3Byb2ZpdCAtIGIuZGFpbHlfcHJvZml0LFxyXG4gICAgfVxyXG5dO1xyXG5cclxuY2xhc3MgQ3JvcFJvdyB7XHJcbiAgICBkYXRhOiBDcm9wRGF0YTtcclxuICAgIHJvdzogSFRNTFRhYmxlUm93RWxlbWVudDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihyb3c6IEhUTUxUYWJsZVJvd0VsZW1lbnQsIGRhdGE6IENyb3BEYXRhKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcclxuICAgICAgICB0aGlzLnJvdyA9IHJvdztcclxuXHJcbiAgICAgICAgLy8gbm93IHBvcHVsYXRlIHRoZSByb3dcclxuICAgICAgICBmb3IgKGxldCBjb2wgb2YgQ09MVU1OUykge1xyXG4gICAgICAgICAgICBsZXQgdmFsdWUgPSBjb2wuY2VsbFRleHQodGhpcy5kYXRhKTtcclxuICAgICAgICAgICAgdGhpcy5yb3cuaW5zZXJ0Q2VsbCgpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHZhbHVlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG50eXBlIFNvcnREaXJlY3Rpb24gPSBcImFzY2VuZGluZ1wiIHwgXCJkZXNjZW5kaW5nXCI7XHJcbmZ1bmN0aW9uIGZsaXBEaXJlY3Rpb24oeDogU29ydERpcmVjdGlvbik6IFNvcnREaXJlY3Rpb24ge1xyXG4gICAgc3dpdGNoICh4KSB7XHJcbiAgICAgICAgY2FzZSBcImFzY2VuZGluZ1wiOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJkZXNjZW5kaW5nXCI7XHJcbiAgICAgICAgY2FzZSBcImRlc2NlbmRpbmdcIjpcclxuICAgICAgICAgICAgcmV0dXJuIFwiYXNjZW5kaW5nXCI7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIENyb3BUYWJsZSB7XHJcbiAgICB0YWJsZTogSFRNTFRhYmxlRWxlbWVudDtcclxuICAgIHRoZWFkOiBIVE1MVGFibGVTZWN0aW9uRWxlbWVudDtcclxuICAgIHRib2R5OiBIVE1MVGFibGVTZWN0aW9uRWxlbWVudDtcclxuICAgIHJvd3M6IENyb3BSb3dbXTtcclxuICAgIGN1cnJlbnRfc29ydDogW251bWJlciwgU29ydERpcmVjdGlvbl0gfCBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHRhYmxlOiBIVE1MVGFibGVFbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xyXG4gICAgICAgIHRoaXMucm93cyA9IFtdO1xyXG4gICAgICAgIHRoaXMuY3VycmVudF9zb3J0ID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIHRhYmxlIGhlYWRlciBhbmQgYm9keVxyXG4gICAgICAgIHRoaXMudGhlYWQgPSB0aGlzLnRhYmxlLmNyZWF0ZVRIZWFkKCk7XHJcbiAgICAgICAgdGhpcy50Ym9keSA9IHRoaXMudGFibGUuY3JlYXRlVEJvZHkoKTtcclxuXHJcbiAgICAgICAgLy8gUG9wdWxhdGUgaGVhZCBvbmNlLCBoZXJlXHJcbiAgICAgICAgbGV0IHJvdyA9IHRoaXMudGhlYWQuaW5zZXJ0Um93KCk7XHJcbiAgICAgICAgZm9yIChsZXQgW2lkeCwgY29sXSBvZiBDT0xVTU5TLmVudHJpZXMoKSkge1xyXG4gICAgICAgICAgICBsZXQgY2VsbCA9IHJvdy5pbnNlcnRDZWxsKCk7XHJcbiAgICAgICAgICAgIGNlbGwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY29sLm5hbWUpKTtcclxuICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBXaGljaCB3YXkgZG8gd2Ugc29ydD9cclxuICAgICAgICAgICAgICAgIGxldCBkaXI6IFNvcnREaXJlY3Rpb247XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50X3NvcnQgIT09IG51bGwgJiYgdGhpcy5jdXJyZW50X3NvcnRbMF0gPT09IGlkeCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpciA9IGZsaXBEaXJlY3Rpb24odGhpcy5jdXJyZW50X3NvcnRbMV0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXIgPSBcImFzY2VuZGluZ1wiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3NvcnQgPSBbaWR4LCBkaXJdO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENsZWFyIGFsbCB0aGUgaGVhZGVyIGJ1dHRvbnMsIGV4Y2VwdCBvdXJzZWx2ZXNcclxuICAgICAgICAgICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy50aGVhZC5xdWVyeVNlbGVjdG9yQWxsKCd0ZCcpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaGVhZGVyIG9mIGhlYWRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXIucmVtb3ZlQXR0cmlidXRlKFwiYXJpYS1zb3J0XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaGVhZGVyc1tpZHhdLnNldEF0dHJpYnV0ZShcImFyaWEtc29ydFwiLCBkaXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE5vdyBzb3J0IHRoZSByb3dzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNvcnRSb3dzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gV2UnbGwgbGVhdmUgdGhlIGJvZHkgZW1wdHkgYmVjYXVzZSBpdCdsbCBiZSByZWNvbXB1dGVkIGZyb21cclxuICAgICAgICAvLyByZXBvcHVsYXRlVGFibGUoKSwgYW5kIHdlIG5lZWQgdGhlIHNldHRpbmdzIHRvIGJlIGFibGUgdG9cclxuICAgICAgICAvLyBjcmVhdGUgdGhlIHJvd3MgYW55d2F5cy5cclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPOiBkb24ndCByZWNyZWF0ZSByb3dzOyBjaGFuZ2UgdGhlIHRleHQgaW5zdGVhZFxyXG4gICAgcHVibGljIHJlcG9wdWxhdGVUYWJsZShzZXR0aW5nczogU2V0dGluZ3MpIHtcclxuICAgICAgICAvLyBEaXNjYXJkIHRoZSBvbGQgcm93cyBhbmQgY3JlYXRlIG5ldyBvbmVzXHJcbiAgICAgICAgdGhpcy50Ym9keS5yZXBsYWNlQ2hpbGRyZW4oKTtcclxuICAgICAgICB0aGlzLnJvd3MgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBkZWYgb2YgQ1JPUF9ERUZJTklUSU9OUykge1xyXG4gICAgICAgICAgICAvLyBGaWx0ZXIgdG8gY3JvcHMgdGhhdCBhcmUgaW4tc2Vhc29uXHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gY2FsY3VsYXRlKGRlZiwgc2V0dGluZ3MpO1xyXG4gICAgICAgICAgICBpZiAoZGF0YSA9PSBcIm91dC1vZi1zZWFzb25cIikge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IHJvdyA9IHRoaXMudGJvZHkuaW5zZXJ0Um93KCk7XHJcbiAgICAgICAgICAgIHRoaXMucm93cy5wdXNoKG5ldyBDcm9wUm93KHJvdywgZGF0YSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gV2UgYWxzbyBuZWVkIHRvIHJlLXNvcnQgdGhlbS4gXHJcbiAgICAgICAgdGhpcy5zb3J0Um93cygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc29ydFJvd3MoKSB7XHJcbiAgICAgICAgLy8gSWYgbm8gc29ydCBzZWxlY3RlZCwgZGVmYXVsdCBpcyB0byBzb3J0IGJ5IG5hbWVcclxuICAgICAgICBsZXQgaWR4OiBudW1iZXI7XHJcbiAgICAgICAgbGV0IGRpcjogU29ydERpcmVjdGlvbjtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50X3NvcnQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgaWR4ID0gMDtcclxuICAgICAgICAgICAgZGlyID0gXCJhc2NlbmRpbmdcIjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBbaWR4LCBkaXJdID0gdGhpcy5jdXJyZW50X3NvcnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBXZSBmaXJzdCBzb3J0IG91ciBvd24gY29sbGVjdGlvbiwgdGhlbiB1c2UgdGhhdCB0byByZS1pbnNlcnRcclxuICAgICAgICAvLyBvdXIgcm93IGVsZW1lbnRzLlxyXG4gICAgICAgIGxldCBjb2wgPSBDT0xVTU5TW2lkeF07XHJcbiAgICAgICAgdGhpcy5yb3dzLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgbGV0IGNvbXBhcmUgPSBjb2wuY29tcGFyZShhLmRhdGEsIGIuZGF0YSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkaXIgPT09IFwiYXNjZW5kaW5nXCIgPyBjb21wYXJlIDogLWNvbXBhcmU7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFRoZW4gdXNlIHRoYXQgdG8gcmVhcnJhbmdlIHRoZSBub2RlcyBpbiB0aGUgYm9keVxyXG4gICAgICAgIGZvciAobGV0IHJvdyBvZiB0aGlzLnJvd3MpIHtcclxuICAgICAgICAgICAgdGhpcy50Ym9keS5hcHBlbmRDaGlsZChyb3cucm93KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkluaXRpYWxpemluZyFcIik7XHJcblxyXG4gICAgLy8gRmluZCBhbGwgdGhlIGVsZW1lbnRzIEkgbmVlZFxyXG4gICAgbGV0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjcm9wLXRhYmxlXCIpO1xyXG4gICAgaWYgKCEodGFibGUgaW5zdGFuY2VvZiBIVE1MVGFibGVFbGVtZW50KSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNyb3AtdGFibGUgc2hvdWxkIGJlIGEgPHRhYmxlPlwiKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgaW5wdXRfcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImlucHV0LXBhbmVsXCIpITtcclxuICAgIGxldCBzZWFzb25faW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI3NlYXNvblwiKSE7XHJcbiAgICBsZXQgY3VycmVudF9kYXlfaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI2RheVwiKSE7XHJcbiAgICBsZXQgZW5hYmxlX211bHRpc2Vhc29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MSW5wdXRFbGVtZW50PihcIiNlbmFibGUtbXVsdGlzZWFzb25cIikhO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0YWJsZSBjb21wb25lbnRcclxuICAgIGxldCB0YWJsZV9jb21wb25lbnQgPSBuZXcgQ3JvcFRhYmxlKHRhYmxlKTtcclxuXHJcbiAgICAvLyBBcHBsaWVzIHRoZSBpbnB1dCBzZXR0aW5ncyB0byB0aGUgZG9jdW1lbnRcclxuICAgIGZ1bmN0aW9uIHJlYWRBbmRBcHBseVNldHRpbmdzKCkge1xyXG4gICAgICAgIC8vIEdldCB0aGUgc2V0dGluZ3NcclxuICAgICAgICBsZXQgc2V0dGluZ3M6IFNldHRpbmdzID0ge1xyXG4gICAgICAgICAgICBzZWFzb246IFNlYXNvbi5mcm9tU3RyaW5nKHNlYXNvbl9pbnB1dC52YWx1ZSksXHJcbiAgICAgICAgICAgIHN0YXJ0X2RheTogY3VycmVudF9kYXlfaW5wdXQudmFsdWVBc051bWJlcixcclxuICAgICAgICAgICAgbXVsdGlzZWFzb25fZW5hYmxlZDogZW5hYmxlX211bHRpc2Vhc29uLmNoZWNrZWRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBSZXBvcHVsYXRlIHRhYmxlIGFuZCBjaGFuZ2Ugc3R5bGVcclxuICAgICAgICB0YWJsZV9jb21wb25lbnQucmVwb3B1bGF0ZVRhYmxlKHNldHRpbmdzKTtcclxuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NOYW1lID0gc2Vhc29uX2lucHV0LnZhbHVlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUnVuIGl0IG9uY2UgdG8gYXBwbHkgdGhlIGRlZmF1bHQgc2V0dGluZ3MuXHJcbiAgICByZWFkQW5kQXBwbHlTZXR0aW5ncygpO1xyXG5cclxuICAgIC8vIEF0dGFjaCBldmVudCBsaXN0ZW5lcnNcclxuICAgIGlucHV0X3BhbmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgcmVhZEFuZEFwcGx5U2V0dGluZ3MoKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5cclxuLy8gQWxyaWdodHksIHdlJ3JlIHJlYWR5IHRvIGdvISBXYWl0IGZvciB0aGUgRE9NIHRvIGZpbmlzaCBsb2FkaW5nIChvciBzZWUgaWYgaXRcclxuLy8gYWxyZWFkeSBoYXMuXHJcbmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSBcImxvYWRpbmdcIikge1xyXG4gICAgLy8gTG9hZGluZyBoYXNuJ3QgZmluaXNoZWQgeWV0XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBpbml0aWFsaXplKTtcclxufSBlbHNlIHtcclxuICAgIC8vIGBET01Db250ZW50TG9hZGVkYCBoYXMgYWxyZWFkeSBmaXJlZFxyXG4gICAgaW5pdGlhbGl6ZSgpO1xyXG59Il0sIm5hbWVzIjpbIlNlYXNvbiIsImNhbGN1bGF0ZSIsImNyb3AiLCJzZXR0aW5ncyIsInNlYXNvbnMiLCJudW1fc2Vhc29ucyIsIm11bHRpc2Vhc29uIiwiaSIsInB1c2giLCJmcm9tU3RyaW5nIiwic2Vhc29uIiwidmFsdWVPZiIsImluY2x1ZGVzIiwiZGF5c19sZWZ0IiwibXVsdGlzZWFzb25fZW5hYmxlZCIsImxlbmd0aCIsImluZGV4T2YiLCJzdGFydF9kYXkiLCJudW1faGFydmVzdHMiLCJ1c2VmdWxfZGF5cyIsImRheXNfdG9fZ3JvdyIsInJlZ3Jvd3RoX3BlcmlvZCIsImV4dHJhX2hhcnZlc3RzIiwiTWF0aCIsImZsb29yIiwibnVtX2Nyb3BzIiwieWllbGQiLCJwZXJjZW50X2NoYW5jZV9leHRyYSIsInByb2ZpdCIsInNlbGxfcHJpY2UiLCJzZWVkX2Nvc3QiLCJkYWlseV9wcm9maXQiLCJuYW1lIiwicyIsInRvVXBwZXJDYXNlIiwiU1BSSU5HIiwiU1VNTUVSIiwiRkFMTCIsIldJTlRFUiIsIkVycm9yIiwiQ09MVU1OUyIsImNlbGxUZXh0IiwiY29tcGFyZSIsImEiLCJiIiwibG9jYWxlQ29tcGFyZSIsInRvU3RyaW5nIiwieWllbGRfbnVtIiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwidG9GaXhlZCIsImlzRmluaXRlIiwiQ3JvcFJvdyIsImNvbnN0cnVjdG9yIiwicm93IiwiZGF0YSIsInRoaXMiLCJjb2wiLCJ2YWx1ZSIsImluc2VydENlbGwiLCJhcHBlbmRDaGlsZCIsImRvY3VtZW50IiwiY3JlYXRlVGV4dE5vZGUiLCJmbGlwRGlyZWN0aW9uIiwieCIsIkNyb3BUYWJsZSIsInRhYmxlIiwicm93cyIsImN1cnJlbnRfc29ydCIsInRoZWFkIiwiY3JlYXRlVEhlYWQiLCJ0Ym9keSIsImNyZWF0ZVRCb2R5IiwiaW5zZXJ0Um93IiwiaWR4IiwiZW50cmllcyIsImNlbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJkaXIiLCJoZWFkZXJzIiwicXVlcnlTZWxlY3RvckFsbCIsImhlYWRlciIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsInNvcnRSb3dzIiwicmVwb3B1bGF0ZVRhYmxlIiwicmVwbGFjZUNoaWxkcmVuIiwiZGVmIiwic29ydCIsImluaXRpYWxpemUiLCJjb25zb2xlIiwibG9nIiwiZ2V0RWxlbWVudEJ5SWQiLCJIVE1MVGFibGVFbGVtZW50IiwiaW5wdXRfcGFuZWwiLCJzZWFzb25faW5wdXQiLCJxdWVyeVNlbGVjdG9yIiwiY3VycmVudF9kYXlfaW5wdXQiLCJlbmFibGVfbXVsdGlzZWFzb24iLCJ0YWJsZV9jb21wb25lbnQiLCJyZWFkQW5kQXBwbHlTZXR0aW5ncyIsInZhbHVlQXNOdW1iZXIiLCJjaGVja2VkIiwiZG9jdW1lbnRFbGVtZW50IiwiY2xhc3NOYW1lIiwidG9Mb3dlckNhc2UiLCJyZWFkeVN0YXRlIl0sInNvdXJjZVJvb3QiOiIifQ==