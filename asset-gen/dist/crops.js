(()=>{"use strict";const e=JSON.parse('[{"name":"Blue Jazz","season":"Spring","seed_cost":30,"sell_price":50,"days_to_grow":7},{"name":"Carrot","season":"Spring","seed_cost":0,"sell_price":35,"days_to_grow":3},{"name":"Cauliflower","season":"Spring","seed_cost":80,"sell_price":175,"days_to_grow":12},{"name":"Coffee Bean","season":"Spring","multiseason":2,"seed_cost":15,"sell_price":15,"days_to_grow":10,"regrowth_period":2,"yield":4,"percent_chance_extra":2},{"name":"Garlic","season":"Spring","seed_cost":40,"sell_price":60,"days_to_grow":4},{"name":"Green Bean","season":"Spring","seed_cost":60,"sell_price":40,"days_to_grow":10,"regrowth_period":3},{"name":"Kale","season":"Spring","seed_cost":70,"sell_price":110,"days_to_grow":6},{"name":"Parsnip","season":"Spring","seed_cost":20,"sell_price":35,"days_to_grow":4},{"name":"Potato","season":"Spring","seed_cost":50,"sell_price":80,"days_to_grow":6,"percent_chance_extra":25},{"name":"Rhubarb","season":"Spring","seed_cost":100,"sell_price":220,"days_to_grow":13},{"name":"Rice","season":"Spring","seed_cost":40,"sell_price":30,"days_to_grow":6},{"name":"Strawberry","season":"Spring","seed_cost":100,"sell_price":120,"days_to_grow":8,"regrowth_period":4,"percent_chance_extra":2},{"name":"Tulip","season":"Spring","seed_cost":20,"sell_price":30,"days_to_grow":6},{"name":"Blueberry","season":"Summer","seed_cost":80,"sell_price":50,"days_to_grow":13,"regrowth_period":4,"yield":3,"percent_chance_extra":2},{"name":"Corn","season":"Summer","multiseason":2,"seed_cost":150,"sell_price":50,"days_to_grow":14,"regrowth_period":4},{"name":"Hops","season":"Summer","seed_cost":60,"sell_price":25,"days_to_grow":11,"regrowth_period":1},{"name":"Hot Pepper","season":"Summer","seed_cost":40,"sell_price":40,"days_to_grow":5,"regrowth_period":3,"percent_chance_extra":3},{"name":"Melon","season":"Summer","seed_cost":80,"sell_price":250,"days_to_grow":12},{"name":"Poppy","season":"Summer","seed_cost":100,"sell_price":140,"days_to_grow":7},{"name":"Radish","season":"Summer","seed_cost":40,"sell_price":90,"days_to_grow":6},{"name":"Red Cabbage","season":"Summer","seed_cost":100,"sell_price":260,"days_to_grow":9},{"name":"Starfruit","season":"Summer","seed_cost":400,"sell_price":750,"days_to_grow":13},{"name":"Summer Spangle","season":"Summer","seed_cost":50,"sell_price":90,"days_to_grow":8},{"name":"Summer Squash","season":"Summer","seed_cost":0,"sell_price":45,"days_to_grow":6},{"name":"Sunflower","season":"Summer","multiseason":2,"seed_cost":200,"sell_price":80,"days_to_grow":8},{"name":"Tomato","season":"Summer","seed_cost":50,"sell_price":60,"days_to_grow":11,"regrowth_period":4,"percent_chance_extra":5},{"name":"Wheat","season":"Summer","multiseason":2,"seed_cost":10,"sell_price":25,"days_to_grow":4},{"name":"Amaranth","season":"Fall","seed_cost":70,"sell_price":150,"days_to_grow":7},{"name":"Artichoke","season":"Fall","seed_cost":30,"sell_price":160,"days_to_grow":8},{"name":"Beet","season":"Fall","seed_cost":20,"sell_price":100,"days_to_grow":6},{"name":"Bok Choy","season":"Fall","seed_cost":50,"sell_price":80,"days_to_grow":4},{"name":"Broccoli","season":"Fall","seed_cost":0,"sell_price":70,"days_to_grow":8},{"name":"Cranberries","season":"Fall","seed_cost":240,"sell_price":75,"days_to_grow":7,"regrowth_period":5,"yield":2,"percent_chance_extra":10},{"name":"Eggplant","season":"Fall","seed_cost":20,"sell_price":60,"days_to_grow":5,"regrowth_period":5,"percent_chance_extra":0.2},{"name":"Fairy Rose","season":"Fall","seed_cost":200,"sell_price":290,"days_to_grow":12},{"name":"Grape","season":"Fall","seed_cost":60,"sell_price":80,"days_to_grow":10,"regrowth_period":3},{"name":"Pumpkin","season":"Fall","seed_cost":100,"sell_price":320,"days_to_grow":13},{"name":"Yam","season":"Fall","seed_cost":60,"sell_price":160,"days_to_grow":10},{"name":"Powdermelon","season":"Winter","seed_cost":0,"sell_price":60,"days_to_grow":7}]');var o;!function(e){e[e.SPRING=0]="SPRING",e[e.SUMMER=1]="SUMMER",e[e.FALL=2]="FALL",e[e.WINTER=3]="WINTER"}(o||(o={})),function(e){e.fromString=function(o){switch(o.toUpperCase()){case"SPRING":return e.SPRING;case"SUMMER":return e.SUMMER;case"FALL":return e.FALL;case"WINTER":return e.WINTER;default:throw new Error(`Unknown season ${o}`)}}}(o||(o={}));const t=1.25,s=1.5,r=2;function n(e,n){var a,i,l;const c=[],d=null!==(a=e.multiseason)&&void 0!==a?a:1;for(let t=0;t<d;t++)c.push(o.fromString(e.season).valueOf()+t);if(!c.includes(n.season))return"out-of-season";const _=28*(n.multiseason_enabled?c.length-c.indexOf(n.season):1)-n.start_day;let m=0,p=0;if(_>=e.days_to_grow&&(m+=1,p+=e.days_to_grow,e.regrowth_period)){const o=Math.floor((_-e.days_to_grow)/e.regrowth_period);m+=o,p+=o*e.regrowth_period}const u=e.sell_price;let g;if(n.quality_probabilities){const e=n.quality_probabilities;g=[[1,e.normal],[t,e.silver],[s,e.gold],[r,e.iridium]].map((([e,o])=>Math.trunc(e*u)*o)).reduce(((e,o)=>e+o))}else g=u;const y=(null!==(i=e.yield)&&void 0!==i?i:1)+(null!==(l=e.percent_chance_extra)&&void 0!==l?l:0)/100;let w=g+(y-1)*u;n.tiller_enabled&&(w*=1.1);const h=w*m-e.seed_cost;return{definition:e,useful_days:p,num_harvests:m,num_crops:y*m,profit:h,daily_profit:h/p}}const a=[{name:"Name",cellText:e=>e.definition.name,compare:(e,o)=>e.definition.name.localeCompare(o.definition.name)},{name:"Seed Cost",cellText:e=>e.definition.seed_cost.toString(),compare:(e,o)=>e.definition.seed_cost-o.definition.seed_cost},{name:"Sell Price",cellText:e=>e.definition.sell_price.toString(),compare:(e,o)=>e.definition.sell_price-o.definition.sell_price},{name:"Days to Grow",cellText:e=>e.definition.days_to_grow.toString(),compare:(e,o)=>e.definition.days_to_grow-o.definition.days_to_grow},{name:"Regrowth Period",cellText:e=>{var o,t;return null!==(t=null===(o=e.definition.regrowth_period)||void 0===o?void 0:o.toString())&&void 0!==t?t:"-"},compare:(e,o)=>void 0===o.definition.regrowth_period?-1:void 0===e.definition.regrowth_period?1:e.definition.regrowth_period-o.definition.regrowth_period},{name:"Yield",cellText:e=>{var o;const t=null!==(o=e.definition.yield)&&void 0!==o?o:1;return e.definition.percent_chance_extra?`${t} + ${e.definition.percent_chance_extra}%`:t.toString()},compare:(e,o)=>{var t,s,r,n;return(null!==(t=e.definition.yield)&&void 0!==t?t:1)+(null!==(s=e.definition.percent_chance_extra)&&void 0!==s?s:0)/100-((null!==(r=o.definition.yield)&&void 0!==r?r:1)+(null!==(n=o.definition.percent_chance_extra)&&void 0!==n?n:0)/100)}},{name:"Useful Days",cellText:e=>e.useful_days.toString(),compare:(e,o)=>e.useful_days-o.useful_days},{name:"Num Harvests",cellText:e=>e.num_harvests.toString(),compare:(e,o)=>e.num_crops-o.num_crops},{name:"Num Crops",cellText:e=>{const o=e.num_crops;return Number.isInteger(o)?o.toString():e.num_crops.toFixed(2)},compare:(e,o)=>e.num_crops-o.num_crops},{name:"Profit",cellText:e=>e.profit.toFixed(2),compare:(e,o)=>e.profit-o.profit},{name:"Daily Profit",cellText:e=>Number.isFinite(e.daily_profit)?e.daily_profit.toFixed(2):"-",compare:(e,o)=>e.daily_profit-o.daily_profit}];class i{constructor(e,o){this.data=o,this.row=e;for(const e of a){const o=e.cellText(this.data);this.row.insertCell().appendChild(document.createTextNode(o))}}}function l(e){switch(e){case"ascending":return"descending";case"descending":return"ascending"}}class c{constructor(e){this.table=e,this.rows=[],this.current_sort=null,this.thead=this.table.createTHead(),this.tbody=this.table.createTBody();const o=this.thead.insertRow();for(const[e,t]of a.entries()){const s=o.insertCell();s.appendChild(document.createTextNode(t.name)),s.addEventListener("click",(()=>{let o;o=null!==this.current_sort&&this.current_sort[0]===e?l(this.current_sort[1]):"ascending",this.current_sort=[e,o];const t=this.thead.querySelectorAll("td");for(const e of t)e.removeAttribute("aria-sort");t[e].setAttribute("aria-sort",o),this.sortRows()}))}}repopulateTable(o){this.tbody.replaceChildren(),this.rows=[];for(const t of e){const e=n(t,o);if("out-of-season"==e)continue;const s=this.tbody.insertRow();this.rows.push(new i(s,e))}this.sortRows()}sortRows(){let e,o;null===this.current_sort?(e=0,o="ascending"):[e,o]=this.current_sort;const t=a[e];this.rows.sort(((e,s)=>{const r=t.compare(e.data,s.data);return"ascending"===o?r:-r}));for(const e of this.rows)this.tbody.appendChild(e.row)}}function d(){console.log("Initializing!");const e=document.getElementById("crop-table");if(!(e instanceof HTMLTableElement))throw new Error("crop-table should be a <table>");const t=document.getElementById("input-panel"),s=document.querySelector("#season"),r=document.querySelector("#day"),n=document.querySelector("#enable-multiseason"),a=document.querySelector("#enable-quality"),i=document.querySelector("#farmer-level"),l=document.querySelector("#enable-tiller"),d=new c(e);function _(){const e=function(e){const o=e/10*.2+(e+2)/12*0+.01;let t=o/2;t=0;const s=1*o,r=(1-s)*Math.min(2*o,.75);return{normal:1-s-r,silver:r,gold:s,iridium:0}}(i.valueAsNumber),t=e.normal+1.25*e.silver+1.5*e.gold+2*e.iridium,c={season:o.fromString(s.value),start_day:r.valueAsNumber,multiseason_enabled:n.checked,quality_probabilities:a.checked?e:null,tiller_enabled:l.checked};let _;for(_ in d.repopulateTable(c),document.documentElement.className=s.value.toLowerCase(),e){const o=document.getElementById(`percent-${_}`),t=100*e[_];o.textContent=`${t.toFixed(0)}%`}document.getElementById("average-quality").textContent=t.toFixed(2)}_(),t.addEventListener("change",(e=>{_()}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0MsV0FBV21ILEVBQWFyQyxPQUN2Q3BELFVBQVcyRixFQUFrQmEsY0FDN0IzRyxvQkFBcUIrRixFQUFtQmMsUUFDeEMvRixzQkFBdUJrRixFQUFlYSxRQUFVUixFQUFVLEtBQzFEdEUsZUFBZ0JtRSxFQUFjVyxTQVNsQyxJQUFJQyxFQUNKLElBQUtBLEtBTkxYLEVBQWdCakIsZ0JBQWdCNUYsR0FDaENvRSxTQUFTcUQsZ0JBQWdCQyxVQUFZcEIsRUFBYXJDLE1BQU0wRCxjQUs1Q1osRUFBUyxDQUNqQixNQUFNNUIsRUFBT2YsU0FBUytCLGVBQWUsV0FBV3FCLEtBQzFDSSxFQUFVLElBQU1iLEVBQVFTLEdBQzlCckMsRUFBSzBDLFlBQWMsR0FBR0QsRUFBUW5FLFFBQVEsS0FDMUMsQ0FDQVcsU0FBUytCLGVBQWUsbUJBQW9CMEIsWUFBY1AsRUFBZTdELFFBQVEsRUFDckYsQ0FHQXFELElBR0FULEVBQVlqQixpQkFBaUIsVUFBVzBDLElBQ3BDaEIsR0FBc0IsR0FFOUIsQ0FLNEIsWUFBeEIxQyxTQUFTMkQsV0FFVDNELFNBQVNnQixpQkFBaUIsbUJBQW9CWSxHQUc5Q0EsRyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9jcm9wcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuXHJcbi8vIHNob3VsZCBpIHB1bGwgdGhpcyBmcm9tIGEgSlNPTiBsaWtlIGknbSBkb2luZyBub3c/IG9yIHNob3VsZCBpIGp1c3RcclxuLy8gaGFyZC1jb2RlIGl0IGlubGluZSAobWlnaHQgYmUgbW9yZSByZWFkYWJsZSlcclxuaW1wb3J0IENST1BfREVGSU5JVElPTlMgZnJvbSBcIi4vY3JvcHMuanNvblwiO1xyXG5cclxuLyogPT09PT09PT0gQ0FMQ1VMQVRJT04gPT09PT09PT0gKi9cclxuXHJcbnR5cGUgQ3JvcERlZmluaXRpb24gPSB0eXBlb2YgQ1JPUF9ERUZJTklUSU9OU1tudW1iZXJdO1xyXG5cclxuZW51bSBTZWFzb24ge1xyXG4gICAgU1BSSU5HLCBTVU1NRVIsIEZBTEwsIFdJTlRFUlxyXG59XHJcblxyXG5uYW1lc3BhY2UgU2Vhc29uIHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBmcm9tU3RyaW5nKHM6IHN0cmluZyk6IFNlYXNvbiB7XHJcbiAgICAgICAgc3dpdGNoIChzLnRvVXBwZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgY2FzZSBcIlNQUklOR1wiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5TUFJJTkc7XHJcbiAgICAgICAgICAgIGNhc2UgXCJTVU1NRVJcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uU1VNTUVSO1xyXG4gICAgICAgICAgICBjYXNlIFwiRkFMTFwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5GQUxMO1xyXG4gICAgICAgICAgICBjYXNlIFwiV0lOVEVSXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU2Vhc29uLldJTlRFUjtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBzZWFzb24gJHtzfWApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxudHlwZSBDcm9wRGF0YSA9IHtcclxuICAgIGRlZmluaXRpb246IENyb3BEZWZpbml0aW9uLFxyXG4gICAgdXNlZnVsX2RheXM6IG51bWJlcixcclxuICAgIG51bV9oYXJ2ZXN0czogbnVtYmVyLFxyXG4gICAgbnVtX2Nyb3BzOiBudW1iZXIsXHJcbiAgICBwcm9maXQ6IG51bWJlcixcclxuICAgIGRhaWx5X3Byb2ZpdDogbnVtYmVyLFxyXG59O1xyXG5cclxudHlwZSBRdWFsaXR5UHJvYmFiaWxpdGllcyA9IHtcclxuICAgIG5vcm1hbDogbnVtYmVyLFxyXG4gICAgc2lsdmVyOiBudW1iZXIsXHJcbiAgICBnb2xkOiBudW1iZXIsXHJcbiAgICBpcmlkaXVtOiBudW1iZXIsXHJcbn07XHJcblxyXG5jb25zdCBTSUxWRVJfTVVMVElQTElFUiA9IDEuMjU7XHJcbmNvbnN0IEdPTERfTVVMVElQTElFUiA9IDEuNTtcclxuY29uc3QgSVJJRElVTV9NVUxUSVBMSUVSID0gMi4wO1xyXG5cclxuZnVuY3Rpb24gY29tcHV0ZVF1YWxpdHkoZmFybWluZ19sZXZlbDogbnVtYmVyKTogUXVhbGl0eVByb2JhYmlsaXRpZXMge1xyXG4gICAgLy8gaHR0cHM6Ly9zdGFyZGV3dmFsbGV5d2lraS5jb20vRmFybWluZyNDb21wbGV0ZV9Gb3JtdWxhXzJcclxuICAgIGNvbnN0IGZlcnRpbGl6ZXJfbGV2ZWwgPSAwO1xyXG5cclxuICAgIC8vIFF1YWxpdHkgZm9yIGEgY3JvcCBpcyBkZXRlcm1pbmVkIGJ5IGEgc2VyaWVzIG9mIHdlaWdodGVkIGNvaW4gZmxpcHMuXHJcbiAgICAvLyBUaGUgcHJvYmFiaWxpdGllcyBmb3IgdGhlIGNvaW5zIGFyZSBjb21wdXRlZCBoZXJlLlxyXG4gICAgY29uc3QgcF9nb2xkX2NvaW4gPSAwLjIgKiAoZmFybWluZ19sZXZlbCAvIDEwLjApICsgMC4yICogZmVydGlsaXplcl9sZXZlbCAqICgoZmFybWluZ19sZXZlbCArIDIuMCkgLyAxMi4wKSArIDAuMDE7XHJcbiAgICBjb25zdCBwX3NpbHZlcl9jb2luID0gTWF0aC5taW4oMiAqIHBfZ29sZF9jb2luLCAwLjc1KTtcclxuICAgIGxldCBwX2lyaWRpdW1fY29pbiA9IHBfZ29sZF9jb2luIC8gMjtcclxuXHJcbiAgICAvLyBUT0RPOiB0aGlzIGlzIG9ubHkgZW5hYmxlZCBhdCBjZXJ0YWluIGZlcnRpbGl6ZXIgbGV2ZWxzXHJcbiAgICBwX2lyaWRpdW1fY29pbiA9IDA7XHJcblxyXG4gICAgLy8gSG93ZXZlciwgdGhlc2UgY29pbnMgYXJlIGZsaXBwZWQgb25lIGF0IGEgdGltZSwgc28gd2UgaGF2ZSBzbGlnaHRseSBtb3JlXHJcbiAgICAvLyB3b3JrIHRvIGRvIHRvIGZpbmQgb3V0IHRoZSBmaW5hbCBwcm9iYWJpbGl0aWVzLlxyXG5cclxuICAgIC8vIENoYW5jZSBvZiBpcmlkaXVtIGlzIGp1c3QgdGhlIGxvY2FsIGNoYW5jZSBvZiBpcmlkaXVtLlxyXG4gICAgY29uc3QgaXJpZGl1bSA9IHBfaXJpZGl1bV9jb2luO1xyXG4gICAgLy8gVG8gZ2V0IGdvbGQsIGRvbid0IGJlIGlyaWRpdW0sIGFuZCBwYXNzIHRoZSBnb2xkIGNvaW4gZmxpcC5cclxuICAgIGNvbnN0IGdvbGQgPSAoMSAtIGlyaWRpdW0pICogcF9nb2xkX2NvaW47XHJcbiAgICAvLyBTaW1pbGFybHksIGZvciBzaWx2ZXIsIGRvbid0IGJlIGlyaWR1bSBvciBnb2xkLCBhbmQgcGFzcyB0aGVcclxuICAgIC8vIHNpbHZlciBjb2luIGZsaXAuXHJcbiAgICBjb25zdCBzaWx2ZXIgPSAoMSAtIGlyaWRpdW0gLSBnb2xkKSAqIHBfc2lsdmVyX2NvaW47XHJcbiAgICAvLyBCYXNlIHF1YWxpdHkgaXMgZXZlcnl0aGluZyBlbHNlLlxyXG4gICAgY29uc3Qgbm9ybWFsID0gMSAtIGlyaWRpdW0gLSBnb2xkIC0gc2lsdmVyO1xyXG5cclxuICAgIHJldHVybiB7IG5vcm1hbCwgc2lsdmVyLCBnb2xkLCBpcmlkaXVtIH07XHJcbn1cclxuXHJcbnR5cGUgU2V0dGluZ3MgPSB7XHJcbiAgICBzZWFzb246IFNlYXNvbixcclxuICAgIHN0YXJ0X2RheTogbnVtYmVyLFxyXG4gICAgbXVsdGlzZWFzb25fZW5hYmxlZDogYm9vbGVhbixcclxuICAgIHF1YWxpdHlfcHJvYmFiaWxpdGllczogUXVhbGl0eVByb2JhYmlsaXRpZXMgfCBudWxsLFxyXG4gICAgdGlsbGVyX2VuYWJsZWQ6IGJvb2xlYW4sXHJcbn07XHJcblxyXG5mdW5jdGlvbiBjYWxjdWxhdGUoY3JvcDogQ3JvcERlZmluaXRpb24sIHNldHRpbmdzOiBTZXR0aW5ncyk6IENyb3BEYXRhIHwgXCJvdXQtb2Ytc2Vhc29uXCIge1xyXG4gICAgLy8gV2hlbiBpcyB0aGlzIGNyb3AgaW4tc2Vhc29uP1xyXG4gICAgY29uc3Qgc2Vhc29uczogU2Vhc29uW10gPSBbXTtcclxuICAgIGNvbnN0IG51bV9zZWFzb25zID0gY3JvcC5tdWx0aXNlYXNvbiA/PyAxO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1fc2Vhc29uczsgaSsrKSB7XHJcbiAgICAgICAgc2Vhc29ucy5wdXNoKFNlYXNvbi5mcm9tU3RyaW5nKGNyb3Auc2Vhc29uKS52YWx1ZU9mKCkgKyBpKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBCYWlsIG91dCBpZiB3ZSdyZSBvdXQgb2Ygc2Vhc29uXHJcbiAgICBpZiAoIXNlYXNvbnMuaW5jbHVkZXMoc2V0dGluZ3Muc2Vhc29uKSkge1xyXG4gICAgICAgIHJldHVybiBcIm91dC1vZi1zZWFzb25cIjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBIb3cgbWFueSBkYXlzIGRvIHdlIGhhdmUgbGVmdD9cclxuICAgIGNvbnN0IHNlYXNvbnNfbGVmdCA9IHNldHRpbmdzLm11bHRpc2Vhc29uX2VuYWJsZWRcclxuICAgICAgICA/IHNlYXNvbnMubGVuZ3RoIC0gc2Vhc29ucy5pbmRleE9mKHNldHRpbmdzLnNlYXNvbilcclxuICAgICAgICA6IDE7XHJcbiAgICBjb25zdCBkYXlzX2xlZnQgPSAyOCAqIHNlYXNvbnNfbGVmdCAtIHNldHRpbmdzLnN0YXJ0X2RheTtcclxuXHJcbiAgICAvLyBJbiB0aGUgbnVtYmVyIG9mIGRheXMgcmVtYWluaW5nLCBob3cgbWFueSBoYXJ2ZXN0cyBkbyB3ZSBnZXQ/XHJcbiAgICBsZXQgbnVtX2hhcnZlc3RzID0gMDtcclxuICAgIGxldCB1c2VmdWxfZGF5cyA9IDA7XHJcbiAgICBpZiAoZGF5c19sZWZ0ID49IGNyb3AuZGF5c190b19ncm93KSB7XHJcbiAgICAgICAgbnVtX2hhcnZlc3RzICs9IDE7XHJcbiAgICAgICAgdXNlZnVsX2RheXMgKz0gY3JvcC5kYXlzX3RvX2dyb3c7XHJcbiAgICAgICAgaWYgKGNyb3AucmVncm93dGhfcGVyaW9kKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4dHJhX2hhcnZlc3RzID0gTWF0aC5mbG9vcigoZGF5c19sZWZ0IC0gY3JvcC5kYXlzX3RvX2dyb3cpIC8gY3JvcC5yZWdyb3d0aF9wZXJpb2QpO1xyXG4gICAgICAgICAgICBudW1faGFydmVzdHMgKz0gZXh0cmFfaGFydmVzdHM7XHJcbiAgICAgICAgICAgIHVzZWZ1bF9kYXlzICs9IGV4dHJhX2hhcnZlc3RzICogY3JvcC5yZWdyb3d0aF9wZXJpb2Q7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEhvdyBtdWNoIGlzIGEgY3JvcCB3b3J0aCwgb24gYXZlcmFnZT9cclxuICAgIGNvbnN0IGJhc2VfcHJpY2UgPSBjcm9wLnNlbGxfcHJpY2U7XHJcbiAgICBsZXQgcXVhbGl0eV9wcmljZTtcclxuICAgIGlmIChzZXR0aW5ncy5xdWFsaXR5X3Byb2JhYmlsaXRpZXMpIHtcclxuICAgICAgICBjb25zdCBxID0gc2V0dGluZ3MucXVhbGl0eV9wcm9iYWJpbGl0aWVzO1xyXG4gICAgICAgIC8vIHppcCB0b2dldGhlciBwcmljZXMgYW5kIHByb2JhYmlsaXRpZXNcclxuICAgICAgICBxdWFsaXR5X3ByaWNlID0gW1xyXG4gICAgICAgICAgICBbMS4wLCBxLm5vcm1hbF0sXHJcbiAgICAgICAgICAgIFtTSUxWRVJfTVVMVElQTElFUiwgcS5zaWx2ZXJdLFxyXG4gICAgICAgICAgICBbR09MRF9NVUxUSVBMSUVSLCBxLmdvbGRdLFxyXG4gICAgICAgICAgICBbSVJJRElVTV9NVUxUSVBMSUVSLCBxLmlyaWRpdW1dLFxyXG4gICAgICAgIF1cclxuICAgICAgICAgICAgLy8gcHJpY2VzIGFyZSByb3VuZGVkIGRvd24hXHJcbiAgICAgICAgICAgIC5tYXAoKFttdWx0aXBsaWVyLCBwXSkgPT4gTWF0aC50cnVuYyhtdWx0aXBsaWVyICogYmFzZV9wcmljZSkgKiBwKVxyXG4gICAgICAgICAgICAucmVkdWNlKChhLCBiKSA9PiBhICsgYik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHF1YWxpdHlfcHJpY2UgPSBiYXNlX3ByaWNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFdlIGNhbiBzb21ldGltZXMgZ2V0IG11bHRpcGxlIGNyb3BzIHBlciBoYXJ2ZXN0LCBidXQgYWxsIHRoZSBleHRyYSBjcm9wc1xyXG4gICAgLy8gd2lsbCBiZSByZWd1bGFyIHF1YWxpdHkuXHJcbiAgICAvLyBUT0RPOiBpcyB0aGlzIHRydWU/IGkgc2VlIGNvbmZsaWN0aW5nIHNvdXJjZXMgb25saW5lXHJcbiAgICBjb25zdCBudW1fY3JvcHNfcGVyX2hhcnZlc3QgPSAoY3JvcC55aWVsZCA/PyAxKSArIChjcm9wLnBlcmNlbnRfY2hhbmNlX2V4dHJhID8/IDApIC8gMTAwLjA7XHJcbiAgICBsZXQgcmV2ZW51ZV9wZXJfaGFydmVzdCA9IHF1YWxpdHlfcHJpY2UgKyAobnVtX2Nyb3BzX3Blcl9oYXJ2ZXN0IC0gMSkgKiBiYXNlX3ByaWNlO1xyXG5cclxuICAgIGlmIChzZXR0aW5ncy50aWxsZXJfZW5hYmxlZCkge1xyXG4gICAgICAgIHJldmVudWVfcGVyX2hhcnZlc3QgKj0gMS4xOyAvLyBjb3VsZCBtYXliZSBkbyB0aGlzIGJlZm9yZSB0byBnZXQgaW50ZWdlciBwcmljZXNcclxuICAgIH1cclxuXHJcbiAgICAvLyBPa2F5LCBsZXQncyBjYWxjdWxhdGUgZXZlcnl0aGluZyFcclxuICAgIGNvbnN0IHByb2ZpdCA9IHJldmVudWVfcGVyX2hhcnZlc3QgKiBudW1faGFydmVzdHMgLSBjcm9wLnNlZWRfY29zdDtcclxuICAgIGNvbnN0IGRhaWx5X3Byb2ZpdCA9IHByb2ZpdCAvIHVzZWZ1bF9kYXlzO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZGVmaW5pdGlvbjogY3JvcCxcclxuICAgICAgICB1c2VmdWxfZGF5cyxcclxuICAgICAgICBudW1faGFydmVzdHMsXHJcbiAgICAgICAgbnVtX2Nyb3BzOiBudW1fY3JvcHNfcGVyX2hhcnZlc3QgKiBudW1faGFydmVzdHMsXHJcbiAgICAgICAgcHJvZml0LFxyXG4gICAgICAgIGRhaWx5X3Byb2ZpdCxcclxuICAgIH07XHJcbn1cclxuXHJcbi8qID09PT09PT09IEdVSSA9PT09PT09PSAqL1xyXG5cclxuLy8gRGVmaW5lcyB0aGUgc2V0IG9mIGNvbHVtbnMgZm9yIHRoZSB3aG9sZSB0YWJsZS5cclxudHlwZSBDb2x1bW4gPSB7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBzdHJpbmc7XHJcbiAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBudW1iZXI7XHJcbn07XHJcblxyXG5jb25zdCBDT0xVTU5TOiBDb2x1bW5bXSA9IFtcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIk5hbWVcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLmRlZmluaXRpb24ubmFtZSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLmRlZmluaXRpb24ubmFtZS5sb2NhbGVDb21wYXJlKGIuZGVmaW5pdGlvbi5uYW1lKSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJTZWVkIENvc3RcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLmRlZmluaXRpb24uc2VlZF9jb3N0LnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5kZWZpbml0aW9uLnNlZWRfY29zdCAtIGIuZGVmaW5pdGlvbi5zZWVkX2Nvc3QsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiU2VsbCBQcmljZVwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AuZGVmaW5pdGlvbi5zZWxsX3ByaWNlLnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5kZWZpbml0aW9uLnNlbGxfcHJpY2UgLSBiLmRlZmluaXRpb24uc2VsbF9wcmljZSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJEYXlzIHRvIEdyb3dcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLmRlZmluaXRpb24uZGF5c190b19ncm93LnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5kZWZpbml0aW9uLmRheXNfdG9fZ3JvdyAtIGIuZGVmaW5pdGlvbi5kYXlzX3RvX2dyb3csXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiUmVncm93dGggUGVyaW9kXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5kZWZpbml0aW9uLnJlZ3Jvd3RoX3BlcmlvZD8udG9TdHJpbmcoKSA/PyBcIi1cIixcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChiLmRlZmluaXRpb24ucmVncm93dGhfcGVyaW9kID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhLmRlZmluaXRpb24ucmVncm93dGhfcGVyaW9kID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhLmRlZmluaXRpb24ucmVncm93dGhfcGVyaW9kIC0gYi5kZWZpbml0aW9uLnJlZ3Jvd3RoX3BlcmlvZDtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiWWllbGRcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHlpZWxkX251bSA9IGNyb3AuZGVmaW5pdGlvbi55aWVsZCA/PyAxO1xyXG4gICAgICAgICAgICBpZiAoY3JvcC5kZWZpbml0aW9uLnBlcmNlbnRfY2hhbmNlX2V4dHJhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7eWllbGRfbnVtfSArICR7Y3JvcC5kZWZpbml0aW9uLnBlcmNlbnRfY2hhbmNlX2V4dHJhfSVgO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkX251bS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIHNsaWdodCBoYWNrIC0tIHJlcHJlc2VudCBhcyBhICsgYi8xMDBcclxuICAgICAgICAgICAgY29uc3QgYV9udW0gPSAoYS5kZWZpbml0aW9uLnlpZWxkID8/IDEpICsgKGEuZGVmaW5pdGlvbi5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyAwKSAvIDEwMDtcclxuICAgICAgICAgICAgY29uc3QgYl9udW0gPSAoYi5kZWZpbml0aW9uLnlpZWxkID8/IDEpICsgKGIuZGVmaW5pdGlvbi5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyAwKSAvIDEwMDtcclxuICAgICAgICAgICAgcmV0dXJuIGFfbnVtIC0gYl9udW07XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlVzZWZ1bCBEYXlzXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC51c2VmdWxfZGF5cy50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEudXNlZnVsX2RheXMgLSBiLnVzZWZ1bF9kYXlzLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIk51bSBIYXJ2ZXN0c1wiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AubnVtX2hhcnZlc3RzLnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5udW1fY3JvcHMgLSBiLm51bV9jcm9wcyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJOdW0gQ3JvcHNcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG51bV9jcm9wcyA9IGNyb3AubnVtX2Nyb3BzO1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihudW1fY3JvcHMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtX2Nyb3BzLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNyb3AubnVtX2Nyb3BzLnRvRml4ZWQoMik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLm51bV9jcm9wcyAtIGIubnVtX2Nyb3BzLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlByb2ZpdFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AucHJvZml0LnRvRml4ZWQoMiksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5wcm9maXQgLSBiLnByb2ZpdCxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJEYWlseSBQcm9maXRcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUoY3JvcC5kYWlseV9wcm9maXQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY3JvcC5kYWlseV9wcm9maXQudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gXCItXCI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLmRhaWx5X3Byb2ZpdCAtIGIuZGFpbHlfcHJvZml0LFxyXG4gICAgfVxyXG5dO1xyXG5cclxuY2xhc3MgQ3JvcFJvdyB7XHJcbiAgICBkYXRhOiBDcm9wRGF0YTtcclxuICAgIHJvdzogSFRNTFRhYmxlUm93RWxlbWVudDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihyb3c6IEhUTUxUYWJsZVJvd0VsZW1lbnQsIGRhdGE6IENyb3BEYXRhKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcclxuICAgICAgICB0aGlzLnJvdyA9IHJvdztcclxuXHJcbiAgICAgICAgLy8gbm93IHBvcHVsYXRlIHRoZSByb3dcclxuICAgICAgICBmb3IgKGNvbnN0IGNvbCBvZiBDT0xVTU5TKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29sLmNlbGxUZXh0KHRoaXMuZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMucm93Lmluc2VydENlbGwoKS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWx1ZSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxudHlwZSBTb3J0RGlyZWN0aW9uID0gXCJhc2NlbmRpbmdcIiB8IFwiZGVzY2VuZGluZ1wiO1xyXG5mdW5jdGlvbiBmbGlwRGlyZWN0aW9uKHg6IFNvcnREaXJlY3Rpb24pOiBTb3J0RGlyZWN0aW9uIHtcclxuICAgIHN3aXRjaCAoeCkge1xyXG4gICAgICAgIGNhc2UgXCJhc2NlbmRpbmdcIjpcclxuICAgICAgICAgICAgcmV0dXJuIFwiZGVzY2VuZGluZ1wiO1xyXG4gICAgICAgIGNhc2UgXCJkZXNjZW5kaW5nXCI6XHJcbiAgICAgICAgICAgIHJldHVybiBcImFzY2VuZGluZ1wiO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBDcm9wVGFibGUge1xyXG4gICAgdGFibGU6IEhUTUxUYWJsZUVsZW1lbnQ7XHJcbiAgICB0aGVhZDogSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQ7XHJcbiAgICB0Ym9keTogSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQ7XHJcbiAgICByb3dzOiBDcm9wUm93W107XHJcbiAgICBjdXJyZW50X3NvcnQ6IFtudW1iZXIsIFNvcnREaXJlY3Rpb25dIHwgbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZTogSFRNTFRhYmxlRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcclxuICAgICAgICB0aGlzLnJvd3MgPSBbXTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRfc29ydCA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSB0YWJsZSBoZWFkZXIgYW5kIGJvZHlcclxuICAgICAgICB0aGlzLnRoZWFkID0gdGhpcy50YWJsZS5jcmVhdGVUSGVhZCgpO1xyXG4gICAgICAgIHRoaXMudGJvZHkgPSB0aGlzLnRhYmxlLmNyZWF0ZVRCb2R5KCk7XHJcblxyXG4gICAgICAgIC8vIFBvcHVsYXRlIGhlYWQgb25jZSwgaGVyZVxyXG4gICAgICAgIGNvbnN0IHJvdyA9IHRoaXMudGhlYWQuaW5zZXJ0Um93KCk7XHJcbiAgICAgICAgZm9yIChjb25zdCBbaWR4LCBjb2xdIG9mIENPTFVNTlMuZW50cmllcygpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSByb3cuaW5zZXJ0Q2VsbCgpO1xyXG4gICAgICAgICAgICBjZWxsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNvbC5uYW1lKSk7XHJcbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIFdoaWNoIHdheSBkbyB3ZSBzb3J0P1xyXG4gICAgICAgICAgICAgICAgbGV0IGRpcjogU29ydERpcmVjdGlvbjtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRfc29ydCAhPT0gbnVsbCAmJiB0aGlzLmN1cnJlbnRfc29ydFswXSA9PT0gaWR4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlyID0gZmxpcERpcmVjdGlvbih0aGlzLmN1cnJlbnRfc29ydFsxXSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpciA9IFwiYXNjZW5kaW5nXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfc29ydCA9IFtpZHgsIGRpcl07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ2xlYXIgYWxsIHRoZSBoZWFkZXIgYnV0dG9ucywgZXhjZXB0IG91cnNlbHZlc1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHRoaXMudGhlYWQucXVlcnlTZWxlY3RvckFsbCgndGQnKTtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaGVhZGVyIG9mIGhlYWRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXIucmVtb3ZlQXR0cmlidXRlKFwiYXJpYS1zb3J0XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaGVhZGVyc1tpZHhdLnNldEF0dHJpYnV0ZShcImFyaWEtc29ydFwiLCBkaXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE5vdyBzb3J0IHRoZSByb3dzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNvcnRSb3dzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gV2UnbGwgbGVhdmUgdGhlIGJvZHkgZW1wdHkgYmVjYXVzZSBpdCdsbCBiZSByZWNvbXB1dGVkIGZyb21cclxuICAgICAgICAvLyByZXBvcHVsYXRlVGFibGUoKSwgYW5kIHdlIG5lZWQgdGhlIHNldHRpbmdzIHRvIGJlIGFibGUgdG9cclxuICAgICAgICAvLyBjcmVhdGUgdGhlIHJvd3MgYW55d2F5cy5cclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPOiBkb24ndCByZWNyZWF0ZSByb3dzOyBjaGFuZ2UgdGhlIHRleHQgaW5zdGVhZFxyXG4gICAgcHVibGljIHJlcG9wdWxhdGVUYWJsZShzZXR0aW5nczogU2V0dGluZ3MpIHtcclxuICAgICAgICAvLyBEaXNjYXJkIHRoZSBvbGQgcm93cyBhbmQgY3JlYXRlIG5ldyBvbmVzXHJcbiAgICAgICAgdGhpcy50Ym9keS5yZXBsYWNlQ2hpbGRyZW4oKTtcclxuICAgICAgICB0aGlzLnJvd3MgPSBbXTtcclxuICAgICAgICBmb3IgKGNvbnN0IGRlZiBvZiBDUk9QX0RFRklOSVRJT05TKSB7XHJcbiAgICAgICAgICAgIC8vIEZpbHRlciB0byBjcm9wcyB0aGF0IGFyZSBpbi1zZWFzb25cclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGNhbGN1bGF0ZShkZWYsIHNldHRpbmdzKTtcclxuICAgICAgICAgICAgaWYgKGRhdGEgPT0gXCJvdXQtb2Ytc2Vhc29uXCIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IHRoaXMudGJvZHkuaW5zZXJ0Um93KCk7XHJcbiAgICAgICAgICAgIHRoaXMucm93cy5wdXNoKG5ldyBDcm9wUm93KHJvdywgZGF0YSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gV2UgYWxzbyBuZWVkIHRvIHJlLXNvcnQgdGhlbS4gXHJcbiAgICAgICAgdGhpcy5zb3J0Um93cygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc29ydFJvd3MoKSB7XHJcbiAgICAgICAgLy8gSWYgbm8gc29ydCBzZWxlY3RlZCwgZGVmYXVsdCBpcyB0byBzb3J0IGJ5IG5hbWVcclxuICAgICAgICBsZXQgaWR4OiBudW1iZXI7XHJcbiAgICAgICAgbGV0IGRpcjogU29ydERpcmVjdGlvbjtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50X3NvcnQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgaWR4ID0gMDtcclxuICAgICAgICAgICAgZGlyID0gXCJhc2NlbmRpbmdcIjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBbaWR4LCBkaXJdID0gdGhpcy5jdXJyZW50X3NvcnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBXZSBmaXJzdCBzb3J0IG91ciBvd24gY29sbGVjdGlvbiwgdGhlbiB1c2UgdGhhdCB0byByZS1pbnNlcnRcclxuICAgICAgICAvLyBvdXIgcm93IGVsZW1lbnRzLlxyXG4gICAgICAgIGNvbnN0IGNvbCA9IENPTFVNTlNbaWR4XTtcclxuICAgICAgICB0aGlzLnJvd3Muc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb21wYXJlID0gY29sLmNvbXBhcmUoYS5kYXRhLCBiLmRhdGEpO1xyXG4gICAgICAgICAgICByZXR1cm4gZGlyID09PSBcImFzY2VuZGluZ1wiID8gY29tcGFyZSA6IC1jb21wYXJlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBUaGVuIHVzZSB0aGF0IHRvIHJlYXJyYW5nZSB0aGUgbm9kZXMgaW4gdGhlIGJvZHlcclxuICAgICAgICBmb3IgKGNvbnN0IHJvdyBvZiB0aGlzLnJvd3MpIHtcclxuICAgICAgICAgICAgdGhpcy50Ym9keS5hcHBlbmRDaGlsZChyb3cucm93KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkluaXRpYWxpemluZyFcIik7XHJcblxyXG4gICAgLy8gRmluZCBhbGwgdGhlIGVsZW1lbnRzIEkgbmVlZFxyXG4gICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNyb3AtdGFibGVcIik7XHJcbiAgICBpZiAoISh0YWJsZSBpbnN0YW5jZW9mIEhUTUxUYWJsZUVsZW1lbnQpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY3JvcC10YWJsZSBzaG91bGQgYmUgYSA8dGFibGU+XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGlucHV0X3BhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbnB1dC1wYW5lbFwiKSE7XHJcbiAgICBjb25zdCBzZWFzb25faW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI3NlYXNvblwiKSE7XHJcbiAgICBjb25zdCBjdXJyZW50X2RheV9pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTElucHV0RWxlbWVudD4oXCIjZGF5XCIpITtcclxuICAgIGNvbnN0IGVuYWJsZV9tdWx0aXNlYXNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTElucHV0RWxlbWVudD4oXCIjZW5hYmxlLW11bHRpc2Vhc29uXCIpITtcclxuICAgIGNvbnN0IGVuYWJsZV9xdWFsaXR5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MSW5wdXRFbGVtZW50PihcIiNlbmFibGUtcXVhbGl0eVwiKSE7XHJcbiAgICBjb25zdCBmYXJtaW5nX2xldmVsX2lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MSW5wdXRFbGVtZW50PihcIiNmYXJtZXItbGV2ZWxcIikhO1xyXG4gICAgY29uc3QgZW5hYmxlX3RpbGxlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTElucHV0RWxlbWVudD4oXCIjZW5hYmxlLXRpbGxlclwiKSE7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRhYmxlIGNvbXBvbmVudFxyXG4gICAgY29uc3QgdGFibGVfY29tcG9uZW50ID0gbmV3IENyb3BUYWJsZSh0YWJsZSk7XHJcblxyXG4gICAgLy8gQXBwbGllcyB0aGUgaW5wdXQgc2V0dGluZ3MgdG8gdGhlIGRvY3VtZW50XHJcbiAgICBmdW5jdGlvbiByZWFkQW5kQXBwbHlTZXR0aW5ncygpIHtcclxuICAgICAgICAvLyBDb21wdXRlIHF1YWxpdHkgcHJvYmFibGl0aWVzXHJcbiAgICAgICAgY29uc3QgcXVhbGl0eSA9IGNvbXB1dGVRdWFsaXR5KGZhcm1pbmdfbGV2ZWxfaW5wdXQudmFsdWVBc051bWJlcik7XHJcbiAgICAgICAgY29uc3QgcXVhbGl0eV9mYWN0b3IgPSBxdWFsaXR5Lm5vcm1hbCArIHF1YWxpdHkuc2lsdmVyICogMS4yNSArIHF1YWxpdHkuZ29sZCAqIDEuNSArIHF1YWxpdHkuaXJpZGl1bSAqIDIuMDtcclxuXHJcbiAgICAgICAgLy8gR2V0IHRoZSBzZXR0aW5nc1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzOiBTZXR0aW5ncyA9IHtcclxuICAgICAgICAgICAgc2Vhc29uOiBTZWFzb24uZnJvbVN0cmluZyhzZWFzb25faW5wdXQudmFsdWUpLFxyXG4gICAgICAgICAgICBzdGFydF9kYXk6IGN1cnJlbnRfZGF5X2lucHV0LnZhbHVlQXNOdW1iZXIsXHJcbiAgICAgICAgICAgIG11bHRpc2Vhc29uX2VuYWJsZWQ6IGVuYWJsZV9tdWx0aXNlYXNvbi5jaGVja2VkLFxyXG4gICAgICAgICAgICBxdWFsaXR5X3Byb2JhYmlsaXRpZXM6IGVuYWJsZV9xdWFsaXR5LmNoZWNrZWQgPyBxdWFsaXR5IDogbnVsbCxcclxuICAgICAgICAgICAgdGlsbGVyX2VuYWJsZWQ6IGVuYWJsZV90aWxsZXIuY2hlY2tlZCxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBSZXBvcHVsYXRlIHRhYmxlIGFuZCBjaGFuZ2Ugc3R5bGVcclxuICAgICAgICB0YWJsZV9jb21wb25lbnQucmVwb3B1bGF0ZVRhYmxlKHNldHRpbmdzKTtcclxuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NOYW1lID0gc2Vhc29uX2lucHV0LnZhbHVlLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgcXVhbGl0eSBzZXR0aW5nc1xyXG4gICAgICAgIC8vIFRPRE86IGdldCB0aGVzZSBlbGVtZW50cyBhaGVhZCBvZiB0aW1lLCBzdG9wIHF1ZXJ5aW5nIGV2ZXJ5IHRpbWVcclxuICAgICAgICBsZXQga2V5OiBrZXlvZiBRdWFsaXR5UHJvYmFiaWxpdGllcztcclxuICAgICAgICBmb3IgKGtleSBpbiBxdWFsaXR5KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcGVyY2VudC0ke2tleX1gKSE7XHJcbiAgICAgICAgICAgIGNvbnN0IHBlcmNlbnQgPSAxMDAgKiBxdWFsaXR5W2tleV07XHJcbiAgICAgICAgICAgIGNlbGwudGV4dENvbnRlbnQgPSBgJHtwZXJjZW50LnRvRml4ZWQoMCl9JWA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXZlcmFnZS1xdWFsaXR5XCIpIS50ZXh0Q29udGVudCA9IHF1YWxpdHlfZmFjdG9yLnRvRml4ZWQoMik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUnVuIGl0IG9uY2UgdG8gYXBwbHkgdGhlIGRlZmF1bHQgc2V0dGluZ3MuXHJcbiAgICByZWFkQW5kQXBwbHlTZXR0aW5ncygpO1xyXG5cclxuICAgIC8vIEF0dGFjaCBldmVudCBsaXN0ZW5lcnNcclxuICAgIGlucHV0X3BhbmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgcmVhZEFuZEFwcGx5U2V0dGluZ3MoKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5cclxuLy8gQWxyaWdodHksIHdlJ3JlIHJlYWR5IHRvIGdvISBXYWl0IGZvciB0aGUgRE9NIHRvIGZpbmlzaCBsb2FkaW5nIChvciBzZWUgaWYgaXRcclxuLy8gYWxyZWFkeSBoYXMuXHJcbmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSBcImxvYWRpbmdcIikge1xyXG4gICAgLy8gTG9hZGluZyBoYXNuJ3QgZmluaXNoZWQgeWV0XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBpbml0aWFsaXplKTtcclxufSBlbHNlIHtcclxuICAgIC8vIGBET01Db250ZW50TG9hZGVkYCBoYXMgYWxyZWFkeSBmaXJlZFxyXG4gICAgaW5pdGlhbGl6ZSgpO1xyXG59Il0sIm5hbWVzIjpbIlNlYXNvbiIsImZyb21TdHJpbmciLCJzIiwidG9VcHBlckNhc2UiLCJTUFJJTkciLCJTVU1NRVIiLCJGQUxMIiwiV0lOVEVSIiwiRXJyb3IiLCJTSUxWRVJfTVVMVElQTElFUiIsIkdPTERfTVVMVElQTElFUiIsIklSSURJVU1fTVVMVElQTElFUiIsImNhbGN1bGF0ZSIsImNyb3AiLCJzZXR0aW5ncyIsInNlYXNvbnMiLCJudW1fc2Vhc29ucyIsIm11bHRpc2Vhc29uIiwiaSIsInB1c2giLCJzZWFzb24iLCJ2YWx1ZU9mIiwiaW5jbHVkZXMiLCJkYXlzX2xlZnQiLCJtdWx0aXNlYXNvbl9lbmFibGVkIiwibGVuZ3RoIiwiaW5kZXhPZiIsInN0YXJ0X2RheSIsIm51bV9oYXJ2ZXN0cyIsInVzZWZ1bF9kYXlzIiwiZGF5c190b19ncm93IiwicmVncm93dGhfcGVyaW9kIiwiZXh0cmFfaGFydmVzdHMiLCJNYXRoIiwiZmxvb3IiLCJiYXNlX3ByaWNlIiwic2VsbF9wcmljZSIsInF1YWxpdHlfcHJpY2UiLCJxdWFsaXR5X3Byb2JhYmlsaXRpZXMiLCJxIiwibm9ybWFsIiwic2lsdmVyIiwiZ29sZCIsImlyaWRpdW0iLCJtYXAiLCJtdWx0aXBsaWVyIiwicCIsInRydW5jIiwicmVkdWNlIiwiYSIsImIiLCJudW1fY3JvcHNfcGVyX2hhcnZlc3QiLCJ5aWVsZCIsInBlcmNlbnRfY2hhbmNlX2V4dHJhIiwicmV2ZW51ZV9wZXJfaGFydmVzdCIsInRpbGxlcl9lbmFibGVkIiwicHJvZml0Iiwic2VlZF9jb3N0IiwiZGVmaW5pdGlvbiIsIm51bV9jcm9wcyIsImRhaWx5X3Byb2ZpdCIsIkNPTFVNTlMiLCJuYW1lIiwiY2VsbFRleHQiLCJjb21wYXJlIiwibG9jYWxlQ29tcGFyZSIsInRvU3RyaW5nIiwidW5kZWZpbmVkIiwieWllbGRfbnVtIiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwidG9GaXhlZCIsImlzRmluaXRlIiwiQ3JvcFJvdyIsImNvbnN0cnVjdG9yIiwicm93IiwiZGF0YSIsInRoaXMiLCJjb2wiLCJ2YWx1ZSIsImluc2VydENlbGwiLCJhcHBlbmRDaGlsZCIsImRvY3VtZW50IiwiY3JlYXRlVGV4dE5vZGUiLCJmbGlwRGlyZWN0aW9uIiwieCIsIkNyb3BUYWJsZSIsInRhYmxlIiwicm93cyIsImN1cnJlbnRfc29ydCIsInRoZWFkIiwiY3JlYXRlVEhlYWQiLCJ0Ym9keSIsImNyZWF0ZVRCb2R5IiwiaW5zZXJ0Um93IiwiaWR4IiwiZW50cmllcyIsImNlbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZGlyIiwiaGVhZGVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJoZWFkZXIiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJzb3J0Um93cyIsInJlcG9wdWxhdGVUYWJsZSIsInJlcGxhY2VDaGlsZHJlbiIsImRlZiIsInNvcnQiLCJpbml0aWFsaXplIiwiY29uc29sZSIsImxvZyIsImdldEVsZW1lbnRCeUlkIiwiSFRNTFRhYmxlRWxlbWVudCIsImlucHV0X3BhbmVsIiwic2Vhc29uX2lucHV0IiwicXVlcnlTZWxlY3RvciIsImN1cnJlbnRfZGF5X2lucHV0IiwiZW5hYmxlX211bHRpc2Vhc29uIiwiZW5hYmxlX3F1YWxpdHkiLCJmYXJtaW5nX2xldmVsX2lucHV0IiwiZW5hYmxlX3RpbGxlciIsInRhYmxlX2NvbXBvbmVudCIsInJlYWRBbmRBcHBseVNldHRpbmdzIiwicXVhbGl0eSIsImZhcm1pbmdfbGV2ZWwiLCJwX2dvbGRfY29pbiIsInBfaXJpZGl1bV9jb2luIiwibWluIiwiY29tcHV0ZVF1YWxpdHkiLCJ2YWx1ZUFzTnVtYmVyIiwicXVhbGl0eV9mYWN0b3IiLCJjaGVja2VkIiwia2V5IiwiZG9jdW1lbnRFbGVtZW50IiwiY2xhc3NOYW1lIiwidG9Mb3dlckNhc2UiLCJwZXJjZW50IiwidGV4dENvbnRlbnQiLCJldmVudCIsInJlYWR5U3RhdGUiXSwic291cmNlUm9vdCI6IiJ9