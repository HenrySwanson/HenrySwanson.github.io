(()=>{"use strict";const e=JSON.parse('[{"name":"Blue Jazz","season":"Spring","seed_cost":30,"sell_price":50,"days_to_grow":7},{"name":"Carrot","season":"Spring","seed_cost":0,"sell_price":35,"days_to_grow":3},{"name":"Cauliflower","season":"Spring","seed_cost":80,"sell_price":175,"days_to_grow":12},{"name":"Coffee Bean","season":"Spring","multiseason":2,"seed_cost":15,"sell_price":15,"days_to_grow":10,"regrowth_period":2,"yield":4,"percent_chance_extra":2},{"name":"Garlic","season":"Spring","seed_cost":40,"sell_price":60,"days_to_grow":4},{"name":"Green Bean","season":"Spring","seed_cost":60,"sell_price":40,"days_to_grow":10,"regrowth_period":3},{"name":"Kale","season":"Spring","seed_cost":70,"sell_price":110,"days_to_grow":6},{"name":"Parsnip","season":"Spring","seed_cost":20,"sell_price":35,"days_to_grow":4},{"name":"Potato","season":"Spring","seed_cost":50,"sell_price":80,"days_to_grow":6,"percent_chance_extra":25},{"name":"Rhubarb","season":"Spring","seed_cost":100,"sell_price":220,"days_to_grow":13},{"name":"Rice","season":"Spring","seed_cost":40,"sell_price":30,"days_to_grow":6},{"name":"Strawberry","season":"Spring","seed_cost":100,"sell_price":120,"days_to_grow":8,"regrowth_period":4,"percent_chance_extra":2},{"name":"Tulip","season":"Spring","seed_cost":20,"sell_price":30,"days_to_grow":6},{"name":"Blueberry","season":"Summer","seed_cost":80,"sell_price":50,"days_to_grow":13,"regrowth_period":4,"yield":3,"percent_chance_extra":2},{"name":"Corn","season":"Summer","multiseason":2,"seed_cost":150,"sell_price":50,"days_to_grow":14,"regrowth_period":4},{"name":"Hops","season":"Summer","seed_cost":60,"sell_price":25,"days_to_grow":11,"regrowth_period":1},{"name":"Hot Pepper","season":"Summer","seed_cost":40,"sell_price":40,"days_to_grow":5,"regrowth_period":3,"percent_chance_extra":3},{"name":"Melon","season":"Summer","seed_cost":80,"sell_price":250,"days_to_grow":12},{"name":"Poppy","season":"Summer","seed_cost":100,"sell_price":140,"days_to_grow":7},{"name":"Radish","season":"Summer","seed_cost":40,"sell_price":90,"days_to_grow":6},{"name":"Red Cabbage","season":"Summer","seed_cost":100,"sell_price":260,"days_to_grow":9},{"name":"Starfruit","season":"Summer","seed_cost":400,"sell_price":750,"days_to_grow":13},{"name":"Summer Spangle","season":"Summer","seed_cost":50,"sell_price":90,"days_to_grow":8},{"name":"Summer Squash","season":"Summer","seed_cost":0,"sell_price":45,"days_to_grow":6},{"name":"Sunflower","season":"Summer","multiseason":2,"seed_cost":200,"sell_price":80,"days_to_grow":8},{"name":"Tomato","season":"Summer","seed_cost":50,"sell_price":60,"days_to_grow":11,"regrowth_period":4,"percent_chance_extra":5},{"name":"Wheat","season":"Summer","multiseason":2,"seed_cost":10,"sell_price":25,"days_to_grow":4},{"name":"Amaranth","season":"Fall","seed_cost":70,"sell_price":150,"days_to_grow":7},{"name":"Artichoke","season":"Fall","seed_cost":30,"sell_price":160,"days_to_grow":8},{"name":"Beet","season":"Fall","seed_cost":20,"sell_price":100,"days_to_grow":6},{"name":"Bok Choy","season":"Fall","seed_cost":50,"sell_price":80,"days_to_grow":4},{"name":"Broccoli","season":"Fall","seed_cost":0,"sell_price":70,"days_to_grow":8},{"name":"Cranberries","season":"Fall","seed_cost":240,"sell_price":75,"days_to_grow":7,"regrowth_period":5,"yield":2,"percent_chance_extra":10},{"name":"Eggplant","season":"Fall","seed_cost":20,"sell_price":60,"days_to_grow":5,"regrowth_period":5,"percent_chance_extra":0.2},{"name":"Fairy Rose","season":"Fall","seed_cost":200,"sell_price":290,"days_to_grow":12},{"name":"Grape","season":"Fall","seed_cost":60,"sell_price":80,"days_to_grow":10,"regrowth_period":3},{"name":"Pumpkin","season":"Fall","seed_cost":100,"sell_price":320,"days_to_grow":13},{"name":"Yam","season":"Fall","seed_cost":60,"sell_price":160,"days_to_grow":10},{"name":"Powdermelon","season":"Winter","seed_cost":0,"sell_price":60,"days_to_grow":7}]');var r;function o(e,o){var s,t,a,n,l,_;let c=null!==(s=e.multiseason)&&void 0!==s?s:1,i=r.fromString(e.season),d=[];for(let e=0;e<c;e++)d.push(i.valueOf()+e);if(!d.includes(o.season))return"out-of-season";let p=28-o.start_day,m=0,u=0;if(p>=e.days_to_grow&&(m+=1,u+=e.days_to_grow,e.regrowth_period)){let r=Math.floor((p-e.days_to_grow)/e.regrowth_period);m+=r,u+=r*e.regrowth_period}let g=m*((null!==(t=e.yield)&&void 0!==t?t:1)+(null!==(a=e.percent_chance_extra)&&void 0!==a?a:0)/100),w=g*e.sell_price-e.seed_cost,h=w/u;return{name:e.name,seed_cost:e.seed_cost,sell_price:e.sell_price,days_to_grow:e.days_to_grow,regrowth_period:null!==(n=e.regrowth_period)&&void 0!==n?n:null,yield:null!==(l=e.yield)&&void 0!==l?l:null,percent_chance_extra:null!==(_=e.percent_chance_extra)&&void 0!==_?_:null,useful_days:u,num_harvests:m,num_crops:g,profit:w,daily_profit:h}}!function(e){e[e.SPRING=0]="SPRING",e[e.SUMMER=1]="SUMMER",e[e.FALL=2]="FALL",e[e.WINTER=3]="WINTER"}(r||(r={})),function(e){e.fromString=function(r){switch(r.toUpperCase()){case"SPRING":return e.SPRING;case"SUMMER":return e.SUMMER;case"FALL":return e.FALL;case"WINTER":return e.WINTER;default:throw new Error(`Unknown season ${r}`)}}}(r||(r={}));const s=[{name:"Name",cellText:e=>e.name,compare:(e,r)=>e.name.localeCompare(r.name)},{name:"Seed Cost",cellText:e=>e.seed_cost.toString(),compare:(e,r)=>e.seed_cost-r.seed_cost},{name:"Sell Price",cellText:e=>e.sell_price.toString(),compare:(e,r)=>e.sell_price-r.sell_price},{name:"Days to Grow",cellText:e=>e.days_to_grow.toString(),compare:(e,r)=>e.days_to_grow-r.days_to_grow},{name:"Regrowth Period",cellText:e=>{var r,o;return null!==(o=null===(r=e.regrowth_period)||void 0===r?void 0:r.toString())&&void 0!==o?o:"-"},compare:(e,r)=>null===r.regrowth_period?-1:null===e.regrowth_period?1:e.regrowth_period-r.regrowth_period},{name:"Yield",cellText:e=>{var r;let o=null!==(r=e.yield)&&void 0!==r?r:1;return e.percent_chance_extra?`${o} + ${e.percent_chance_extra}%`:o.toString()},compare:(e,r)=>{var o,s,t,a;return(null!==(o=e.yield)&&void 0!==o?o:1)+(null!==(s=e.percent_chance_extra)&&void 0!==s?s:0)/100-((null!==(t=r.yield)&&void 0!==t?t:1)+(null!==(a=r.percent_chance_extra)&&void 0!==a?a:0)/100)}},{name:"Useful Days",cellText:e=>e.useful_days.toString(),compare:(e,r)=>e.useful_days-r.useful_days},{name:"Num Harvests",cellText:e=>e.num_harvests.toString(),compare:(e,r)=>e.num_crops-r.num_crops},{name:"Num Crops",cellText:e=>{let r=e.num_crops;return Number.isInteger(r)?r.toString():e.num_crops.toFixed(2)},compare:(e,r)=>e.num_crops-r.num_crops},{name:"Profit",cellText:e=>e.profit.toFixed(2),compare:(e,r)=>e.profit-r.profit},{name:"Daily Profit",cellText:e=>Number.isFinite(e.daily_profit)?e.daily_profit.toFixed(2):"-",compare:(e,r)=>e.daily_profit-r.daily_profit}];class t{constructor(e,r){this.data=r,this.row=e;for(let e of s){let r=e.cellText(this.data);this.row.insertCell().appendChild(document.createTextNode(r))}}}function a(e){switch(e){case"ascending":return"descending";case"descending":return"ascending"}}class n{constructor(e){this.table=e,this.rows=[],this.current_sort=null,this.thead=this.table.createTHead(),this.tbody=this.table.createTBody();let r=this.thead.insertRow();for(let[e,o]of s.entries()){let s=r.insertCell();s.appendChild(document.createTextNode(o.name)),s.addEventListener("click",(r=>{let o;o=null!==this.current_sort&&this.current_sort[0]===e?a(this.current_sort[1]):"ascending",this.current_sort=[e,o];let s=this.thead.querySelectorAll("td");for(let e of s)e.removeAttribute("aria-sort");s[e].setAttribute("aria-sort",o),this.sortRows()}))}}repopulateTable(r){this.tbody.replaceChildren(),this.rows=[];for(let s of e){let e=o(s,r);if("out-of-season"==e)continue;let a=this.tbody.insertRow();this.rows.push(new t(a,e))}this.sortRows()}sortRows(){if(null===this.current_sort)return;let[e,r]=this.current_sort,o=s[e];this.rows.sort(((e,s)=>{let t=o.compare(e.data,s.data);return"ascending"===r?t:-t}));for(let e of this.rows)this.tbody.appendChild(e.row)}}function l(){console.log("Initializing!");let e=document.getElementById("crop-table");if(!(e instanceof HTMLTableElement))throw new Error("crop-table should be a <table>");let o=document.getElementById("input-panel"),s=document.querySelector("#season"),t=document.querySelector("#day");function a(){return{season:r.fromString(s.value),start_day:t.valueAsNumber}}let l=new n(e);l.repopulateTable(a()),o.addEventListener("change",(e=>{l.repopulateTable(a())}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQWtCLElBQUlwQyxFQUFVQyxHQUNwQ21DLEVBQWdCZixnQkFBZ0JhLEtBR2hDSixFQUFZbEIsaUJBQWlCLFVBQVdDLElBQ3BDdUIsRUFBZ0JmLGdCQUFnQmEsSUFBYyxHQUV0RCxDQUs0QixZQUF4QnRDLFNBQVN5QyxXQUVUekMsU0FBU2dCLGlCQUFpQixtQkFBb0JhLEdBRzlDQSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2Nyb3BzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG5cclxuLy8gc2hvdWxkIGkgcHVsbCB0aGlzIGZyb20gYSBKU09OIGxpa2UgaSdtIGRvaW5nIG5vdz8gb3Igc2hvdWxkIGkganVzdFxyXG4vLyBoYXJkLWNvZGUgaXQgaW5saW5lIChtaWdodCBiZSBtb3JlIHJlYWRhYmxlKVxyXG5pbXBvcnQgQ1JPUF9ERUZJTklUSU9OUyBmcm9tIFwiLi9jcm9wcy5qc29uXCI7XHJcblxyXG4vKiA9PT09PT09PSBDQUxDVUxBVElPTiA9PT09PT09PSAqL1xyXG5cclxudHlwZSBDcm9wRGVmaW5pdGlvbiA9IHR5cGVvZiBDUk9QX0RFRklOSVRJT05TW251bWJlcl07XHJcblxyXG5lbnVtIFNlYXNvbiB7XHJcbiAgICBTUFJJTkcsIFNVTU1FUiwgRkFMTCwgV0lOVEVSXHJcbn1cclxuXHJcbm5hbWVzcGFjZSBTZWFzb24ge1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGZyb21TdHJpbmcoczogc3RyaW5nKTogU2Vhc29uIHtcclxuICAgICAgICBzd2l0Y2ggKHMudG9VcHBlckNhc2UoKSkge1xyXG4gICAgICAgICAgICBjYXNlIFwiU1BSSU5HXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU2Vhc29uLlNQUklORztcclxuICAgICAgICAgICAgY2FzZSBcIlNVTU1FUlwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5TVU1NRVI7XHJcbiAgICAgICAgICAgIGNhc2UgXCJGQUxMXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU2Vhc29uLkZBTEw7XHJcbiAgICAgICAgICAgIGNhc2UgXCJXSU5URVJcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uV0lOVEVSO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHNlYXNvbiAke3N9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG50eXBlIENyb3BEYXRhID0ge1xyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgc2VlZF9jb3N0OiBudW1iZXIsXHJcbiAgICBzZWxsX3ByaWNlOiBudW1iZXIsXHJcbiAgICBkYXlzX3RvX2dyb3c6IG51bWJlcixcclxuICAgIHJlZ3Jvd3RoX3BlcmlvZDogbnVtYmVyIHwgbnVsbCxcclxuICAgIHlpZWxkOiBudW1iZXIgfCBudWxsLFxyXG4gICAgcGVyY2VudF9jaGFuY2VfZXh0cmE6IG51bWJlciB8IG51bGwsXHJcbiAgICB1c2VmdWxfZGF5czogbnVtYmVyLFxyXG4gICAgbnVtX2hhcnZlc3RzOiBudW1iZXIsXHJcbiAgICBudW1fY3JvcHM6IG51bWJlcixcclxuICAgIHByb2ZpdDogbnVtYmVyLFxyXG4gICAgZGFpbHlfcHJvZml0OiBudW1iZXIsXHJcbn07XHJcblxyXG50eXBlIFNldHRpbmdzID0ge1xyXG4gICAgc2Vhc29uOiBTZWFzb24sXHJcbiAgICBzdGFydF9kYXk6IG51bWJlcixcclxufTtcclxuXHJcbmZ1bmN0aW9uIGNhbGN1bGF0ZShjcm9wOiBDcm9wRGVmaW5pdGlvbiwgc2V0dGluZ3M6IFNldHRpbmdzKTogQ3JvcERhdGEgfCBcIm91dC1vZi1zZWFzb25cIiB7XHJcbiAgICAvLyBJcyB0aGlzIGNyb3AgaW4tc2Vhc29uP1xyXG4gICAgbGV0IG51bV9zZWFzb25zID0gY3JvcC5tdWx0aXNlYXNvbiA/PyAxO1xyXG4gICAgbGV0IGZpcnN0X3NlYXNvbiA9IFNlYXNvbi5mcm9tU3RyaW5nKGNyb3Auc2Vhc29uKTtcclxuICAgIGxldCBzZWFzb25zOiBTZWFzb25bXSA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1fc2Vhc29uczsgaSsrKSB7XHJcbiAgICAgICAgc2Vhc29ucy5wdXNoKGZpcnN0X3NlYXNvbi52YWx1ZU9mKCkgKyBpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXNlYXNvbnMuaW5jbHVkZXMoc2V0dGluZ3Muc2Vhc29uKSkge1xyXG4gICAgICAgIHJldHVybiBcIm91dC1vZi1zZWFzb25cIjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBwbGFudGluZyBvbiBkYXkgMjggaXMgemVybyBkYXlzIGxlZnRcclxuICAgIC8vIFRPRE86IG11bHRpc2Vhc29uIVxyXG4gICAgbGV0IGRheXNfbGVmdCA9IDI4IC0gc2V0dGluZ3Muc3RhcnRfZGF5O1xyXG5cclxuICAgIC8vIFdoYXQncyB0aGUgcHJvZml0PyBEZXBlbmRzIGhvdyBtYW55IGhhcnZlc3RzIHdlIGNhbiBnZXQgdGhpcyBzZWFzb24uXHJcbiAgICBsZXQgbnVtX2hhcnZlc3RzID0gMDtcclxuICAgIGxldCB1c2VmdWxfZGF5cyA9IDA7XHJcbiAgICBpZiAoZGF5c19sZWZ0ID49IGNyb3AuZGF5c190b19ncm93KSB7XHJcbiAgICAgICAgbnVtX2hhcnZlc3RzICs9IDE7XHJcbiAgICAgICAgdXNlZnVsX2RheXMgKz0gY3JvcC5kYXlzX3RvX2dyb3c7XHJcbiAgICAgICAgaWYgKGNyb3AucmVncm93dGhfcGVyaW9kKSB7XHJcbiAgICAgICAgICAgIGxldCBleHRyYV9oYXJ2ZXN0cyA9IE1hdGguZmxvb3IoKGRheXNfbGVmdCAtIGNyb3AuZGF5c190b19ncm93KSAvIGNyb3AucmVncm93dGhfcGVyaW9kKTtcclxuICAgICAgICAgICAgbnVtX2hhcnZlc3RzICs9IGV4dHJhX2hhcnZlc3RzO1xyXG4gICAgICAgICAgICB1c2VmdWxfZGF5cyArPSBleHRyYV9oYXJ2ZXN0cyAqIGNyb3AucmVncm93dGhfcGVyaW9kO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBXZSBjYW4gc29tZXRpbWVzIGdldCBtdWx0aXBsZSBjcm9wcyBwZXIgaGFydmVzdFxyXG4gICAgbGV0IG51bV9jcm9wcyA9IG51bV9oYXJ2ZXN0cyAqICgoY3JvcC55aWVsZCA/PyAxKSArIChjcm9wLnBlcmNlbnRfY2hhbmNlX2V4dHJhID8/IDApIC8gMTAwKTtcclxuXHJcbiAgICBsZXQgcHJvZml0ID0gbnVtX2Nyb3BzICogY3JvcC5zZWxsX3ByaWNlIC0gY3JvcC5zZWVkX2Nvc3Q7XHJcbiAgICBsZXQgZGFpbHlfcHJvZml0ID0gcHJvZml0IC8gdXNlZnVsX2RheXM7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBuYW1lOiBjcm9wLm5hbWUsXHJcbiAgICAgICAgc2VlZF9jb3N0OiBjcm9wLnNlZWRfY29zdCxcclxuICAgICAgICBzZWxsX3ByaWNlOiBjcm9wLnNlbGxfcHJpY2UsXHJcbiAgICAgICAgZGF5c190b19ncm93OiBjcm9wLmRheXNfdG9fZ3JvdyxcclxuICAgICAgICByZWdyb3d0aF9wZXJpb2Q6IGNyb3AucmVncm93dGhfcGVyaW9kID8/IG51bGwsXHJcbiAgICAgICAgeWllbGQ6IGNyb3AueWllbGQgPz8gbnVsbCxcclxuICAgICAgICBwZXJjZW50X2NoYW5jZV9leHRyYTogY3JvcC5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyBudWxsLFxyXG4gICAgICAgIHVzZWZ1bF9kYXlzLFxyXG4gICAgICAgIG51bV9oYXJ2ZXN0cyxcclxuICAgICAgICBudW1fY3JvcHMsXHJcbiAgICAgICAgcHJvZml0LFxyXG4gICAgICAgIGRhaWx5X3Byb2ZpdCxcclxuICAgIH07XHJcbn1cclxuXHJcbi8qID09PT09PT09IEdVSSA9PT09PT09PSAqL1xyXG5cclxuLy8gRGVmaW5lcyB0aGUgc2V0IG9mIGNvbHVtbnMgZm9yIHRoZSB3aG9sZSB0YWJsZS5cclxudHlwZSBDb2x1bW4gPSB7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBzdHJpbmc7XHJcbiAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBudW1iZXI7XHJcbn07XHJcblxyXG5jb25zdCBDT0xVTU5TOiBDb2x1bW5bXSA9IFtcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIk5hbWVcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLm5hbWUsXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJTZWVkIENvc3RcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLnNlZWRfY29zdC50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuc2VlZF9jb3N0IC0gYi5zZWVkX2Nvc3QsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiU2VsbCBQcmljZVwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3Auc2VsbF9wcmljZS50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuc2VsbF9wcmljZSAtIGIuc2VsbF9wcmljZSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJEYXlzIHRvIEdyb3dcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLmRheXNfdG9fZ3Jvdy50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGF5c190b19ncm93IC0gYi5kYXlzX3RvX2dyb3csXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiUmVncm93dGggUGVyaW9kXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5yZWdyb3d0aF9wZXJpb2Q/LnRvU3RyaW5nKCkgPz8gXCItXCIsXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYi5yZWdyb3d0aF9wZXJpb2QgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhLnJlZ3Jvd3RoX3BlcmlvZCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGEucmVncm93dGhfcGVyaW9kIC0gYi5yZWdyb3d0aF9wZXJpb2Q7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIllpZWxkXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgeWllbGRfbnVtID0gY3JvcC55aWVsZCA/PyAxO1xyXG4gICAgICAgICAgICBpZiAoY3JvcC5wZXJjZW50X2NoYW5jZV9leHRyYSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3lpZWxkX251bX0gKyAke2Nyb3AucGVyY2VudF9jaGFuY2VfZXh0cmF9JWA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGRfbnVtLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IHtcclxuICAgICAgICAgICAgLy8gc2xpZ2h0IGhhY2sgLS0gcmVwcmVzZW50IGFzIGEgKyBiLzEwMFxyXG4gICAgICAgICAgICBsZXQgYV9udW0gPSAoYS55aWVsZCA/PyAxKSArIChhLnBlcmNlbnRfY2hhbmNlX2V4dHJhID8/IDApIC8gMTAwO1xyXG4gICAgICAgICAgICBsZXQgYl9udW0gPSAoYi55aWVsZCA/PyAxKSArIChiLnBlcmNlbnRfY2hhbmNlX2V4dHJhID8/IDApIC8gMTAwO1xyXG4gICAgICAgICAgICByZXR1cm4gYV9udW0gLSBiX251bTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiVXNlZnVsIERheXNcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLnVzZWZ1bF9kYXlzLnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS51c2VmdWxfZGF5cyAtIGIudXNlZnVsX2RheXMsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiTnVtIEhhcnZlc3RzXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5udW1faGFydmVzdHMudG9TdHJpbmcoKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLm51bV9jcm9wcyAtIGIubnVtX2Nyb3BzLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIk51bSBDcm9wc1wiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IHtcclxuICAgICAgICAgICAgbGV0IG51bV9jcm9wcyA9IGNyb3AubnVtX2Nyb3BzO1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihudW1fY3JvcHMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtX2Nyb3BzLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNyb3AubnVtX2Nyb3BzLnRvRml4ZWQoMik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLm51bV9jcm9wcyAtIGIubnVtX2Nyb3BzLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlByb2ZpdFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AucHJvZml0LnRvRml4ZWQoMiksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5wcm9maXQgLSBiLnByb2ZpdCxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJEYWlseSBQcm9maXRcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUoY3JvcC5kYWlseV9wcm9maXQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY3JvcC5kYWlseV9wcm9maXQudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gXCItXCI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLmRhaWx5X3Byb2ZpdCAtIGIuZGFpbHlfcHJvZml0LFxyXG4gICAgfVxyXG5dO1xyXG5cclxuY2xhc3MgQ3JvcFJvdyB7XHJcbiAgICBkYXRhOiBDcm9wRGF0YTtcclxuICAgIHJvdzogSFRNTFRhYmxlUm93RWxlbWVudDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihyb3c6IEhUTUxUYWJsZVJvd0VsZW1lbnQsIGRhdGE6IENyb3BEYXRhKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcclxuICAgICAgICB0aGlzLnJvdyA9IHJvdztcclxuXHJcbiAgICAgICAgLy8gbm93IHBvcHVsYXRlIHRoZSByb3dcclxuICAgICAgICBmb3IgKGxldCBjb2wgb2YgQ09MVU1OUykge1xyXG4gICAgICAgICAgICBsZXQgdmFsdWUgPSBjb2wuY2VsbFRleHQodGhpcy5kYXRhKTtcclxuICAgICAgICAgICAgdGhpcy5yb3cuaW5zZXJ0Q2VsbCgpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHZhbHVlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG50eXBlIFNvcnREaXJlY3Rpb24gPSBcImFzY2VuZGluZ1wiIHwgXCJkZXNjZW5kaW5nXCI7XHJcbmZ1bmN0aW9uIGZsaXBEaXJlY3Rpb24oeDogU29ydERpcmVjdGlvbik6IFNvcnREaXJlY3Rpb24ge1xyXG4gICAgc3dpdGNoICh4KSB7XHJcbiAgICAgICAgY2FzZSBcImFzY2VuZGluZ1wiOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJkZXNjZW5kaW5nXCI7XHJcbiAgICAgICAgY2FzZSBcImRlc2NlbmRpbmdcIjpcclxuICAgICAgICAgICAgcmV0dXJuIFwiYXNjZW5kaW5nXCI7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIENyb3BUYWJsZSB7XHJcbiAgICB0YWJsZTogSFRNTFRhYmxlRWxlbWVudDtcclxuICAgIHRoZWFkOiBIVE1MVGFibGVTZWN0aW9uRWxlbWVudDtcclxuICAgIHRib2R5OiBIVE1MVGFibGVTZWN0aW9uRWxlbWVudDtcclxuICAgIHJvd3M6IENyb3BSb3dbXTtcclxuICAgIGN1cnJlbnRfc29ydDogW251bWJlciwgU29ydERpcmVjdGlvbl0gfCBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHRhYmxlOiBIVE1MVGFibGVFbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xyXG4gICAgICAgIHRoaXMucm93cyA9IFtdO1xyXG4gICAgICAgIHRoaXMuY3VycmVudF9zb3J0ID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIHRhYmxlIGhlYWRlciBhbmQgYm9keVxyXG4gICAgICAgIHRoaXMudGhlYWQgPSB0aGlzLnRhYmxlLmNyZWF0ZVRIZWFkKCk7XHJcbiAgICAgICAgdGhpcy50Ym9keSA9IHRoaXMudGFibGUuY3JlYXRlVEJvZHkoKTtcclxuXHJcbiAgICAgICAgLy8gUG9wdWxhdGUgaGVhZCBvbmNlLCBoZXJlXHJcbiAgICAgICAgbGV0IHJvdyA9IHRoaXMudGhlYWQuaW5zZXJ0Um93KCk7XHJcbiAgICAgICAgZm9yIChsZXQgW2lkeCwgY29sXSBvZiBDT0xVTU5TLmVudHJpZXMoKSkge1xyXG4gICAgICAgICAgICBsZXQgY2VsbCA9IHJvdy5pbnNlcnRDZWxsKCk7XHJcbiAgICAgICAgICAgIGNlbGwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY29sLm5hbWUpKTtcclxuICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBXaGljaCB3YXkgZG8gd2Ugc29ydD9cclxuICAgICAgICAgICAgICAgIGxldCBkaXI6IFNvcnREaXJlY3Rpb247XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50X3NvcnQgIT09IG51bGwgJiYgdGhpcy5jdXJyZW50X3NvcnRbMF0gPT09IGlkeCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpciA9IGZsaXBEaXJlY3Rpb24odGhpcy5jdXJyZW50X3NvcnRbMV0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXIgPSBcImFzY2VuZGluZ1wiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3NvcnQgPSBbaWR4LCBkaXJdO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENsZWFyIGFsbCB0aGUgaGVhZGVyIGJ1dHRvbnMsIGV4Y2VwdCBvdXJzZWx2ZXNcclxuICAgICAgICAgICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy50aGVhZC5xdWVyeVNlbGVjdG9yQWxsKCd0ZCcpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaGVhZGVyIG9mIGhlYWRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXIucmVtb3ZlQXR0cmlidXRlKFwiYXJpYS1zb3J0XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaGVhZGVyc1tpZHhdLnNldEF0dHJpYnV0ZShcImFyaWEtc29ydFwiLCBkaXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE5vdyBzb3J0IHRoZSByb3dzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNvcnRSb3dzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gV2UnbGwgbGVhdmUgdGhlIGJvZHkgZW1wdHkgYmVjYXVzZSBpdCdsbCBiZSByZWNvbXB1dGVkIGZyb21cclxuICAgICAgICAvLyByZXBvcHVsYXRlVGFibGUoKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFRPRE86IGRvbid0IHJlY3JlYXRlIHJvd3M7IGNoYW5nZSB0aGUgdGV4dCBpbnN0ZWFkXHJcbiAgICBwdWJsaWMgcmVwb3B1bGF0ZVRhYmxlKHNldHRpbmdzOiBTZXR0aW5ncykge1xyXG4gICAgICAgIC8vIERpc2NhcmQgdGhlIG9sZCByb3dzIGFuZCBjcmVhdGUgbmV3IG9uZXNcclxuICAgICAgICB0aGlzLnRib2R5LnJlcGxhY2VDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMucm93cyA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGRlZiBvZiBDUk9QX0RFRklOSVRJT05TKSB7XHJcbiAgICAgICAgICAgIC8vIEZpbHRlciB0byBjcm9wcyB0aGF0IGFyZSBpbi1zZWFzb25cclxuICAgICAgICAgICAgbGV0IGRhdGEgPSBjYWxjdWxhdGUoZGVmLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgIGlmIChkYXRhID09IFwib3V0LW9mLXNlYXNvblwiKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgcm93ID0gdGhpcy50Ym9keS5pbnNlcnRSb3coKTtcclxuICAgICAgICAgICAgdGhpcy5yb3dzLnB1c2gobmV3IENyb3BSb3cocm93LCBkYXRhKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBXZSBhbHNvIG5lZWQgdG8gcmUtc29ydCB0aGVtLiBcclxuICAgICAgICB0aGlzLnNvcnRSb3dzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzb3J0Um93cygpIHtcclxuICAgICAgICAvLyBJZiBubyBzb3J0IHNlbGVjdGVkLCBkb24ndCBzb3J0LiBFWi5cclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50X3NvcnQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gV2UgZmlyc3Qgc29ydCBvdXIgb3duIGNvbGxlY3Rpb24sIHRoZW4gdXNlIHRoYXQgdG8gcmUtaW5zZXJ0XHJcbiAgICAgICAgLy8gb3VyIHJvdyBlbGVtZW50cy5cclxuICAgICAgICBsZXQgW2lkeCwgZGlyXSA9IHRoaXMuY3VycmVudF9zb3J0O1xyXG4gICAgICAgIGxldCBjb2wgPSBDT0xVTU5TW2lkeF07XHJcbiAgICAgICAgdGhpcy5yb3dzLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgbGV0IGNvbXBhcmUgPSBjb2wuY29tcGFyZShhLmRhdGEsIGIuZGF0YSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkaXIgPT09IFwiYXNjZW5kaW5nXCIgPyBjb21wYXJlIDogLWNvbXBhcmU7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFRoZW4gdXNlIHRoYXQgdG8gcmVhcnJhbmdlIHRoZSBub2RlcyBpbiB0aGUgYm9keVxyXG4gICAgICAgIGZvciAobGV0IHJvdyBvZiB0aGlzLnJvd3MpIHtcclxuICAgICAgICAgICAgdGhpcy50Ym9keS5hcHBlbmRDaGlsZChyb3cucm93KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkluaXRpYWxpemluZyFcIik7XHJcblxyXG4gICAgLy8gRmluZCBhbGwgdGhlIGVsZW1lbnRzIEkgbmVlZFxyXG4gICAgbGV0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjcm9wLXRhYmxlXCIpO1xyXG4gICAgaWYgKCEodGFibGUgaW5zdGFuY2VvZiBIVE1MVGFibGVFbGVtZW50KSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNyb3AtdGFibGUgc2hvdWxkIGJlIGEgPHRhYmxlPlwiKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgaW5wdXRfcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImlucHV0LXBhbmVsXCIpITtcclxuICAgIGxldCBzZWFzb25faW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI3NlYXNvblwiKSE7XHJcbiAgICBsZXQgY3VycmVudF9kYXlfaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI2RheVwiKSE7XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0U2V0dGluZ3MoKTogU2V0dGluZ3Mge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNlYXNvbjogU2Vhc29uLmZyb21TdHJpbmcoc2Vhc29uX2lucHV0LnZhbHVlKSxcclxuICAgICAgICAgICAgc3RhcnRfZGF5OiBjdXJyZW50X2RheV9pbnB1dC52YWx1ZUFzTnVtYmVyXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgdGFibGUgYW5kIHBvcHVsYXRlIGl0IHdpdGggdGhlIChkZWZhdWx0KSBzZXR0aW5nc1xyXG4gICAgbGV0IHRhYmxlX2NvbXBvbmVudCA9IG5ldyBDcm9wVGFibGUodGFibGUpO1xyXG4gICAgdGFibGVfY29tcG9uZW50LnJlcG9wdWxhdGVUYWJsZShnZXRTZXR0aW5ncygpKTtcclxuXHJcbiAgICAvLyBBdHRhY2ggZXZlbnQgbGlzdGVuZXJzXHJcbiAgICBpbnB1dF9wYW5lbC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgIHRhYmxlX2NvbXBvbmVudC5yZXBvcHVsYXRlVGFibGUoZ2V0U2V0dGluZ3MoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcbi8vIEFscmlnaHR5LCB3ZSdyZSByZWFkeSB0byBnbyEgV2FpdCBmb3IgdGhlIERPTSB0byBmaW5pc2ggbG9hZGluZyAob3Igc2VlIGlmIGl0XHJcbi8vIGFscmVhZHkgaGFzLlxyXG5pZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gXCJsb2FkaW5nXCIpIHtcclxuICAgIC8vIExvYWRpbmcgaGFzbid0IGZpbmlzaGVkIHlldFxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgaW5pdGlhbGl6ZSk7XHJcbn0gZWxzZSB7XHJcbiAgICAvLyBgRE9NQ29udGVudExvYWRlZGAgaGFzIGFscmVhZHkgZmlyZWRcclxuICAgIGluaXRpYWxpemUoKTtcclxufSJdLCJuYW1lcyI6WyJTZWFzb24iLCJjYWxjdWxhdGUiLCJjcm9wIiwic2V0dGluZ3MiLCJudW1fc2Vhc29ucyIsIm11bHRpc2Vhc29uIiwiZmlyc3Rfc2Vhc29uIiwiZnJvbVN0cmluZyIsInNlYXNvbiIsInNlYXNvbnMiLCJpIiwicHVzaCIsInZhbHVlT2YiLCJpbmNsdWRlcyIsImRheXNfbGVmdCIsInN0YXJ0X2RheSIsIm51bV9oYXJ2ZXN0cyIsInVzZWZ1bF9kYXlzIiwiZGF5c190b19ncm93IiwicmVncm93dGhfcGVyaW9kIiwiZXh0cmFfaGFydmVzdHMiLCJNYXRoIiwiZmxvb3IiLCJudW1fY3JvcHMiLCJ5aWVsZCIsInBlcmNlbnRfY2hhbmNlX2V4dHJhIiwicHJvZml0Iiwic2VsbF9wcmljZSIsInNlZWRfY29zdCIsImRhaWx5X3Byb2ZpdCIsIm5hbWUiLCJzIiwidG9VcHBlckNhc2UiLCJTUFJJTkciLCJTVU1NRVIiLCJGQUxMIiwiV0lOVEVSIiwiRXJyb3IiLCJDT0xVTU5TIiwiY2VsbFRleHQiLCJjb21wYXJlIiwiYSIsImIiLCJsb2NhbGVDb21wYXJlIiwidG9TdHJpbmciLCJ5aWVsZF9udW0iLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJ0b0ZpeGVkIiwiaXNGaW5pdGUiLCJDcm9wUm93IiwiY29uc3RydWN0b3IiLCJyb3ciLCJkYXRhIiwidGhpcyIsImNvbCIsInZhbHVlIiwiaW5zZXJ0Q2VsbCIsImFwcGVuZENoaWxkIiwiZG9jdW1lbnQiLCJjcmVhdGVUZXh0Tm9kZSIsImZsaXBEaXJlY3Rpb24iLCJ4IiwiQ3JvcFRhYmxlIiwidGFibGUiLCJyb3dzIiwiY3VycmVudF9zb3J0IiwidGhlYWQiLCJjcmVhdGVUSGVhZCIsInRib2R5IiwiY3JlYXRlVEJvZHkiLCJpbnNlcnRSb3ciLCJpZHgiLCJlbnRyaWVzIiwiY2VsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImRpciIsImhlYWRlcnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaGVhZGVyIiwicmVtb3ZlQXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwic29ydFJvd3MiLCJyZXBvcHVsYXRlVGFibGUiLCJyZXBsYWNlQ2hpbGRyZW4iLCJkZWYiLCJzb3J0IiwiaW5pdGlhbGl6ZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRFbGVtZW50QnlJZCIsIkhUTUxUYWJsZUVsZW1lbnQiLCJpbnB1dF9wYW5lbCIsInNlYXNvbl9pbnB1dCIsInF1ZXJ5U2VsZWN0b3IiLCJjdXJyZW50X2RheV9pbnB1dCIsImdldFNldHRpbmdzIiwidmFsdWVBc051bWJlciIsInRhYmxlX2NvbXBvbmVudCIsInJlYWR5U3RhdGUiXSwic291cmNlUm9vdCI6IiJ9