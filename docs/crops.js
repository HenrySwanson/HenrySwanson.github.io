(()=>{"use strict";const e=JSON.parse('[{"name":"Blue Jazz","season":"Spring","seed_cost":30,"sell_price":50,"days_to_grow":7},{"name":"Carrot","season":"Spring","seed_cost":0,"sell_price":35,"days_to_grow":3},{"name":"Cauliflower","season":"Spring","seed_cost":80,"sell_price":175,"days_to_grow":12},{"name":"Coffee Bean","season":"Spring","multiseason":2,"seed_cost":15,"sell_price":15,"days_to_grow":10,"regrowth_period":2,"yield":4,"percent_chance_extra":2},{"name":"Garlic","season":"Spring","seed_cost":40,"sell_price":60,"days_to_grow":4},{"name":"Green Bean","season":"Spring","seed_cost":60,"sell_price":40,"days_to_grow":10,"regrowth_period":3},{"name":"Kale","season":"Spring","seed_cost":70,"sell_price":110,"days_to_grow":6},{"name":"Parsnip","season":"Spring","seed_cost":20,"sell_price":35,"days_to_grow":4},{"name":"Potato","season":"Spring","seed_cost":50,"sell_price":80,"days_to_grow":6,"percent_chance_extra":25},{"name":"Rhubarb","season":"Spring","seed_cost":100,"sell_price":220,"days_to_grow":13},{"name":"Rice","season":"Spring","seed_cost":40,"sell_price":30,"days_to_grow":6},{"name":"Strawberry","season":"Spring","seed_cost":100,"sell_price":120,"days_to_grow":8,"regrowth_period":4,"percent_chance_extra":2},{"name":"Tulip","season":"Spring","seed_cost":20,"sell_price":30,"days_to_grow":6},{"name":"Blueberry","season":"Summer","seed_cost":80,"sell_price":50,"days_to_grow":13,"regrowth_period":4,"yield":3,"percent_chance_extra":2},{"name":"Corn","season":"Summer","multiseason":2,"seed_cost":150,"sell_price":50,"days_to_grow":14,"regrowth_period":4},{"name":"Hops","season":"Summer","seed_cost":60,"sell_price":25,"days_to_grow":11,"regrowth_period":1},{"name":"Hot Pepper","season":"Summer","seed_cost":40,"sell_price":40,"days_to_grow":5,"regrowth_period":3,"percent_chance_extra":3},{"name":"Melon","season":"Summer","seed_cost":80,"sell_price":250,"days_to_grow":12},{"name":"Poppy","season":"Summer","seed_cost":100,"sell_price":140,"days_to_grow":7},{"name":"Radish","season":"Summer","seed_cost":40,"sell_price":90,"days_to_grow":6},{"name":"Red Cabbage","season":"Summer","seed_cost":100,"sell_price":260,"days_to_grow":9},{"name":"Starfruit","season":"Summer","seed_cost":400,"sell_price":750,"days_to_grow":13},{"name":"Summer Spangle","season":"Summer","seed_cost":50,"sell_price":90,"days_to_grow":8},{"name":"Summer Squash","season":"Summer","seed_cost":0,"sell_price":45,"days_to_grow":6},{"name":"Sunflower","season":"Summer","multiseason":2,"seed_cost":200,"sell_price":80,"days_to_grow":8},{"name":"Tomato","season":"Summer","seed_cost":50,"sell_price":60,"days_to_grow":11,"regrowth_period":4,"percent_chance_extra":5},{"name":"Wheat","season":"Summer","multiseason":2,"seed_cost":10,"sell_price":25,"days_to_grow":4},{"name":"Amaranth","season":"Fall","seed_cost":70,"sell_price":150,"days_to_grow":7},{"name":"Artichoke","season":"Fall","seed_cost":30,"sell_price":160,"days_to_grow":8},{"name":"Beet","season":"Fall","seed_cost":20,"sell_price":100,"days_to_grow":6},{"name":"Bok Choy","season":"Fall","seed_cost":50,"sell_price":80,"days_to_grow":4},{"name":"Broccoli","season":"Fall","seed_cost":0,"sell_price":70,"days_to_grow":8},{"name":"Cranberries","season":"Fall","seed_cost":240,"sell_price":75,"days_to_grow":7,"regrowth_period":5,"yield":2,"percent_chance_extra":10},{"name":"Eggplant","season":"Fall","seed_cost":20,"sell_price":60,"days_to_grow":5,"regrowth_period":5,"percent_chance_extra":0.2},{"name":"Fairy Rose","season":"Fall","seed_cost":200,"sell_price":290,"days_to_grow":12},{"name":"Grape","season":"Fall","seed_cost":60,"sell_price":80,"days_to_grow":10,"regrowth_period":3},{"name":"Pumpkin","season":"Fall","seed_cost":100,"sell_price":320,"days_to_grow":13},{"name":"Yam","season":"Fall","seed_cost":60,"sell_price":160,"days_to_grow":10},{"name":"Powdermelon","season":"Winter","seed_cost":0,"sell_price":60,"days_to_grow":7}]');var r;function o(e,o){var s,t,a,n,l,_;let c=null!==(s=e.multiseason)&&void 0!==s?s:1,i=r.fromString(e.season),d=[];for(let e=0;e<c;e++)d.push(i.valueOf()+e);if(!d.includes(o.season))return"out-of-season";let p=28-o.start_day,m=0,u=0;if(p>=e.days_to_grow&&(m+=1,u+=e.days_to_grow,e.regrowth_period)){let r=Math.floor((p-e.days_to_grow)/e.regrowth_period);m+=r,u+=r*e.regrowth_period}let g=m*((null!==(t=e.yield)&&void 0!==t?t:1)+(null!==(a=e.percent_chance_extra)&&void 0!==a?a:0)/100),w=g*e.sell_price-e.seed_cost,h=w/u;return{name:e.name,seed_cost:e.seed_cost,sell_price:e.sell_price,days_to_grow:e.days_to_grow,regrowth_period:null!==(n=e.regrowth_period)&&void 0!==n?n:null,yield:null!==(l=e.yield)&&void 0!==l?l:null,percent_chance_extra:null!==(_=e.percent_chance_extra)&&void 0!==_?_:null,useful_days:u,num_harvests:m,num_crops:g,profit:w,daily_profit:h}}!function(e){e[e.SPRING=0]="SPRING",e[e.SUMMER=1]="SUMMER",e[e.FALL=2]="FALL",e[e.WINTER=3]="WINTER"}(r||(r={})),function(e){e.fromString=function(r){switch(r.toUpperCase()){case"SPRING":return e.SPRING;case"SUMMER":return e.SUMMER;case"FALL":return e.FALL;case"WINTER":return e.WINTER;default:throw new Error(`Unknown season ${r}`)}}}(r||(r={}));const s=[{name:"Name",cellText:e=>e.name,compare:(e,r)=>e.name.localeCompare(r.name)},{name:"Seed Cost",cellText:e=>e.seed_cost.toString(),compare:(e,r)=>e.seed_cost-r.seed_cost},{name:"Sell Price",cellText:e=>e.sell_price.toString(),compare:(e,r)=>e.sell_price-r.sell_price},{name:"Days to Grow",cellText:e=>e.days_to_grow.toString(),compare:(e,r)=>e.days_to_grow-r.days_to_grow},{name:"Regrowth Period",cellText:e=>{var r,o;return null!==(o=null===(r=e.regrowth_period)||void 0===r?void 0:r.toString())&&void 0!==o?o:"-"},compare:(e,r)=>null===r.regrowth_period?-1:null===e.regrowth_period?1:e.regrowth_period-r.regrowth_period},{name:"Yield",cellText:e=>{var r;let o=null!==(r=e.yield)&&void 0!==r?r:1;return e.percent_chance_extra?`${o} + ${e.percent_chance_extra}%`:o.toString()},compare:(e,r)=>{var o,s,t,a;return(null!==(o=e.yield)&&void 0!==o?o:1)+(null!==(s=e.percent_chance_extra)&&void 0!==s?s:0)/100-((null!==(t=r.yield)&&void 0!==t?t:1)+(null!==(a=r.percent_chance_extra)&&void 0!==a?a:0)/100)}},{name:"Useful Days",cellText:e=>e.useful_days.toString(),compare:(e,r)=>e.useful_days-r.useful_days},{name:"Num Harvests",cellText:e=>e.num_harvests.toString(),compare:(e,r)=>e.num_crops-r.num_crops},{name:"Num Crops",cellText:e=>{let r=e.num_crops;return Number.isInteger(r)?r.toString():e.num_crops.toFixed(2)},compare:(e,r)=>e.num_crops-r.num_crops},{name:"Profit",cellText:e=>e.profit.toFixed(2),compare:(e,r)=>e.profit-r.profit},{name:"Daily Profit",cellText:e=>Number.isFinite(e.daily_profit)?e.daily_profit.toFixed(2):"-",compare:(e,r)=>e.daily_profit-r.daily_profit}];class t{constructor(e,r){this.data=r,this.row=e;for(let e of s){let r=e.cellText(this.data);this.row.insertCell().appendChild(document.createTextNode(r))}}}function a(e){switch(e){case"ascending":return"descending";case"descending":return"ascending"}}class n{constructor(e){this.table=e,this.rows=[],this.current_sort=null,this.thead=this.table.createTHead(),this.tbody=this.table.createTBody();let r=this.thead.insertRow();for(let[e,o]of s.entries()){let s=r.insertCell();s.appendChild(document.createTextNode(o.name)),s.addEventListener("click",(r=>{let o;o=null!==this.current_sort&&this.current_sort[0]===e?a(this.current_sort[1]):"ascending",this.current_sort=[e,o];let s=this.thead.querySelectorAll("td");for(let e of s)e.removeAttribute("aria-sort");s[e].setAttribute("aria-sort",o),this.sortRows()}))}}repopulateTable(r){this.tbody.replaceChildren(),this.rows=[];for(let s of e){let e=o(s,r);if("out-of-season"==e)continue;let a=this.tbody.insertRow();this.rows.push(new t(a,e))}this.sortRows()}sortRows(){let e,r;null===this.current_sort?(e=0,r="ascending"):[e,r]=this.current_sort;let o=s[e];this.rows.sort(((e,s)=>{let t=o.compare(e.data,s.data);return"ascending"===r?t:-t}));for(let e of this.rows)this.tbody.appendChild(e.row)}}function l(){console.log("Initializing!");let e=document.getElementById("crop-table");if(!(e instanceof HTMLTableElement))throw new Error("crop-table should be a <table>");let o=document.getElementById("input-panel"),s=document.querySelector("#season"),t=document.querySelector("#day"),a=new n(e);function l(){let e={season:r.fromString(s.value),start_day:t.valueAsNumber};a.repopulateTable(e),document.documentElement.className=s.value.toLowerCase()}l(),o.addEventListener("change",(e=>{l()}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBUVIsRUFBT08sV0FBV3VGLEVBQWF0QyxPQUN2Q3pDLFVBQVdpRixFQUFrQkcsZUFJakNGLEVBQWdCYixnQkFBZ0JqRixHQUNoQ3dELFNBQVN5QyxnQkFBZ0JDLFVBQVlQLEVBQWF0QyxNQUFNOEMsYUFDNUQsQ0FHQUosSUFHQUwsRUFBWWxCLGlCQUFpQixVQUFXQyxJQUNwQ3NCLEdBQXNCLEdBRTlCLENBSzRCLFlBQXhCdkMsU0FBUzRDLFdBRVQ1QyxTQUFTZ0IsaUJBQWlCLG1CQUFvQmEsR0FHOUNBLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY3JvcHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4vLyBzaG91bGQgaSBwdWxsIHRoaXMgZnJvbSBhIEpTT04gbGlrZSBpJ20gZG9pbmcgbm93PyBvciBzaG91bGQgaSBqdXN0XHJcbi8vIGhhcmQtY29kZSBpdCBpbmxpbmUgKG1pZ2h0IGJlIG1vcmUgcmVhZGFibGUpXHJcbmltcG9ydCBDUk9QX0RFRklOSVRJT05TIGZyb20gXCIuL2Nyb3BzLmpzb25cIjtcclxuXHJcbi8qID09PT09PT09IENBTENVTEFUSU9OID09PT09PT09ICovXHJcblxyXG50eXBlIENyb3BEZWZpbml0aW9uID0gdHlwZW9mIENST1BfREVGSU5JVElPTlNbbnVtYmVyXTtcclxuXHJcbmVudW0gU2Vhc29uIHtcclxuICAgIFNQUklORywgU1VNTUVSLCBGQUxMLCBXSU5URVJcclxufVxyXG5cclxubmFtZXNwYWNlIFNlYXNvbiB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gZnJvbVN0cmluZyhzOiBzdHJpbmcpOiBTZWFzb24ge1xyXG4gICAgICAgIHN3aXRjaCAocy50b1VwcGVyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJTUFJJTkdcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uU1BSSU5HO1xyXG4gICAgICAgICAgICBjYXNlIFwiU1VNTUVSXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU2Vhc29uLlNVTU1FUjtcclxuICAgICAgICAgICAgY2FzZSBcIkZBTExcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uRkFMTDtcclxuICAgICAgICAgICAgY2FzZSBcIldJTlRFUlwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5XSU5URVI7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gc2Vhc29uICR7c31gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbnR5cGUgQ3JvcERhdGEgPSB7XHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBzZWVkX2Nvc3Q6IG51bWJlcixcclxuICAgIHNlbGxfcHJpY2U6IG51bWJlcixcclxuICAgIGRheXNfdG9fZ3JvdzogbnVtYmVyLFxyXG4gICAgcmVncm93dGhfcGVyaW9kOiBudW1iZXIgfCBudWxsLFxyXG4gICAgeWllbGQ6IG51bWJlciB8IG51bGwsXHJcbiAgICBwZXJjZW50X2NoYW5jZV9leHRyYTogbnVtYmVyIHwgbnVsbCxcclxuICAgIHVzZWZ1bF9kYXlzOiBudW1iZXIsXHJcbiAgICBudW1faGFydmVzdHM6IG51bWJlcixcclxuICAgIG51bV9jcm9wczogbnVtYmVyLFxyXG4gICAgcHJvZml0OiBudW1iZXIsXHJcbiAgICBkYWlseV9wcm9maXQ6IG51bWJlcixcclxufTtcclxuXHJcbnR5cGUgU2V0dGluZ3MgPSB7XHJcbiAgICBzZWFzb246IFNlYXNvbixcclxuICAgIHN0YXJ0X2RheTogbnVtYmVyLFxyXG59O1xyXG5cclxuZnVuY3Rpb24gY2FsY3VsYXRlKGNyb3A6IENyb3BEZWZpbml0aW9uLCBzZXR0aW5nczogU2V0dGluZ3MpOiBDcm9wRGF0YSB8IFwib3V0LW9mLXNlYXNvblwiIHtcclxuICAgIC8vIElzIHRoaXMgY3JvcCBpbi1zZWFzb24/XHJcbiAgICBsZXQgbnVtX3NlYXNvbnMgPSBjcm9wLm11bHRpc2Vhc29uID8/IDE7XHJcbiAgICBsZXQgZmlyc3Rfc2Vhc29uID0gU2Vhc29uLmZyb21TdHJpbmcoY3JvcC5zZWFzb24pO1xyXG4gICAgbGV0IHNlYXNvbnM6IFNlYXNvbltdID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bV9zZWFzb25zOyBpKyspIHtcclxuICAgICAgICBzZWFzb25zLnB1c2goZmlyc3Rfc2Vhc29uLnZhbHVlT2YoKSArIGkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghc2Vhc29ucy5pbmNsdWRlcyhzZXR0aW5ncy5zZWFzb24pKSB7XHJcbiAgICAgICAgcmV0dXJuIFwib3V0LW9mLXNlYXNvblwiO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHBsYW50aW5nIG9uIGRheSAyOCBpcyB6ZXJvIGRheXMgbGVmdFxyXG4gICAgLy8gVE9ETzogbXVsdGlzZWFzb24hXHJcbiAgICBsZXQgZGF5c19sZWZ0ID0gMjggLSBzZXR0aW5ncy5zdGFydF9kYXk7XHJcblxyXG4gICAgLy8gV2hhdCdzIHRoZSBwcm9maXQ/IERlcGVuZHMgaG93IG1hbnkgaGFydmVzdHMgd2UgY2FuIGdldCB0aGlzIHNlYXNvbi5cclxuICAgIGxldCBudW1faGFydmVzdHMgPSAwO1xyXG4gICAgbGV0IHVzZWZ1bF9kYXlzID0gMDtcclxuICAgIGlmIChkYXlzX2xlZnQgPj0gY3JvcC5kYXlzX3RvX2dyb3cpIHtcclxuICAgICAgICBudW1faGFydmVzdHMgKz0gMTtcclxuICAgICAgICB1c2VmdWxfZGF5cyArPSBjcm9wLmRheXNfdG9fZ3JvdztcclxuICAgICAgICBpZiAoY3JvcC5yZWdyb3d0aF9wZXJpb2QpIHtcclxuICAgICAgICAgICAgbGV0IGV4dHJhX2hhcnZlc3RzID0gTWF0aC5mbG9vcigoZGF5c19sZWZ0IC0gY3JvcC5kYXlzX3RvX2dyb3cpIC8gY3JvcC5yZWdyb3d0aF9wZXJpb2QpO1xyXG4gICAgICAgICAgICBudW1faGFydmVzdHMgKz0gZXh0cmFfaGFydmVzdHM7XHJcbiAgICAgICAgICAgIHVzZWZ1bF9kYXlzICs9IGV4dHJhX2hhcnZlc3RzICogY3JvcC5yZWdyb3d0aF9wZXJpb2Q7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFdlIGNhbiBzb21ldGltZXMgZ2V0IG11bHRpcGxlIGNyb3BzIHBlciBoYXJ2ZXN0XHJcbiAgICBsZXQgbnVtX2Nyb3BzID0gbnVtX2hhcnZlc3RzICogKChjcm9wLnlpZWxkID8/IDEpICsgKGNyb3AucGVyY2VudF9jaGFuY2VfZXh0cmEgPz8gMCkgLyAxMDApO1xyXG5cclxuICAgIGxldCBwcm9maXQgPSBudW1fY3JvcHMgKiBjcm9wLnNlbGxfcHJpY2UgLSBjcm9wLnNlZWRfY29zdDtcclxuICAgIGxldCBkYWlseV9wcm9maXQgPSBwcm9maXQgLyB1c2VmdWxfZGF5cztcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG5hbWU6IGNyb3AubmFtZSxcclxuICAgICAgICBzZWVkX2Nvc3Q6IGNyb3Auc2VlZF9jb3N0LFxyXG4gICAgICAgIHNlbGxfcHJpY2U6IGNyb3Auc2VsbF9wcmljZSxcclxuICAgICAgICBkYXlzX3RvX2dyb3c6IGNyb3AuZGF5c190b19ncm93LFxyXG4gICAgICAgIHJlZ3Jvd3RoX3BlcmlvZDogY3JvcC5yZWdyb3d0aF9wZXJpb2QgPz8gbnVsbCxcclxuICAgICAgICB5aWVsZDogY3JvcC55aWVsZCA/PyBudWxsLFxyXG4gICAgICAgIHBlcmNlbnRfY2hhbmNlX2V4dHJhOiBjcm9wLnBlcmNlbnRfY2hhbmNlX2V4dHJhID8/IG51bGwsXHJcbiAgICAgICAgdXNlZnVsX2RheXMsXHJcbiAgICAgICAgbnVtX2hhcnZlc3RzLFxyXG4gICAgICAgIG51bV9jcm9wcyxcclxuICAgICAgICBwcm9maXQsXHJcbiAgICAgICAgZGFpbHlfcHJvZml0LFxyXG4gICAgfTtcclxufVxyXG5cclxuLyogPT09PT09PT0gR1VJID09PT09PT09ICovXHJcblxyXG4vLyBEZWZpbmVzIHRoZSBzZXQgb2YgY29sdW1ucyBmb3IgdGhlIHdob2xlIHRhYmxlLlxyXG50eXBlIENvbHVtbiA9IHtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IHN0cmluZztcclxuICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IG51bWJlcjtcclxufTtcclxuXHJcbmNvbnN0IENPTFVNTlM6IENvbHVtbltdID0gW1xyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiTmFtZVwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AubmFtZSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlNlZWQgQ29zdFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3Auc2VlZF9jb3N0LnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5zZWVkX2Nvc3QgLSBiLnNlZWRfY29zdCxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJTZWxsIFByaWNlXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5zZWxsX3ByaWNlLnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5zZWxsX3ByaWNlIC0gYi5zZWxsX3ByaWNlLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIkRheXMgdG8gR3Jvd1wiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AuZGF5c190b19ncm93LnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5kYXlzX3RvX2dyb3cgLSBiLmRheXNfdG9fZ3JvdyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJSZWdyb3d0aCBQZXJpb2RcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLnJlZ3Jvd3RoX3BlcmlvZD8udG9TdHJpbmcoKSA/PyBcIi1cIixcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChiLnJlZ3Jvd3RoX3BlcmlvZCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGEucmVncm93dGhfcGVyaW9kID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYS5yZWdyb3d0aF9wZXJpb2QgLSBiLnJlZ3Jvd3RoX3BlcmlvZDtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiWWllbGRcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB5aWVsZF9udW0gPSBjcm9wLnlpZWxkID8/IDE7XHJcbiAgICAgICAgICAgIGlmIChjcm9wLnBlcmNlbnRfY2hhbmNlX2V4dHJhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7eWllbGRfbnVtfSArICR7Y3JvcC5wZXJjZW50X2NoYW5jZV9leHRyYX0lYDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZF9udW0udG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBzbGlnaHQgaGFjayAtLSByZXByZXNlbnQgYXMgYSArIGIvMTAwXHJcbiAgICAgICAgICAgIGxldCBhX251bSA9IChhLnlpZWxkID8/IDEpICsgKGEucGVyY2VudF9jaGFuY2VfZXh0cmEgPz8gMCkgLyAxMDA7XHJcbiAgICAgICAgICAgIGxldCBiX251bSA9IChiLnlpZWxkID8/IDEpICsgKGIucGVyY2VudF9jaGFuY2VfZXh0cmEgPz8gMCkgLyAxMDA7XHJcbiAgICAgICAgICAgIHJldHVybiBhX251bSAtIGJfbnVtO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJVc2VmdWwgRGF5c1wiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AudXNlZnVsX2RheXMudG9TdHJpbmcoKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLnVzZWZ1bF9kYXlzIC0gYi51c2VmdWxfZGF5cyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJOdW0gSGFydmVzdHNcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLm51bV9oYXJ2ZXN0cy50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEubnVtX2Nyb3BzIC0gYi5udW1fY3JvcHMsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiTnVtIENyb3BzXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbnVtX2Nyb3BzID0gY3JvcC5udW1fY3JvcHM7XHJcbiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG51bV9jcm9wcykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1fY3JvcHMudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY3JvcC5udW1fY3JvcHMudG9GaXhlZCgyKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEubnVtX2Nyb3BzIC0gYi5udW1fY3JvcHMsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiUHJvZml0XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5wcm9maXQudG9GaXhlZCgyKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLnByb2ZpdCAtIGIucHJvZml0LFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIkRhaWx5IFByb2ZpdFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShjcm9wLmRhaWx5X3Byb2ZpdCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjcm9wLmRhaWx5X3Byb2ZpdC50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBcIi1cIjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGFpbHlfcHJvZml0IC0gYi5kYWlseV9wcm9maXQsXHJcbiAgICB9XHJcbl07XHJcblxyXG5jbGFzcyBDcm9wUm93IHtcclxuICAgIGRhdGE6IENyb3BEYXRhO1xyXG4gICAgcm93OiBIVE1MVGFibGVSb3dFbGVtZW50O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHJvdzogSFRNTFRhYmxlUm93RWxlbWVudCwgZGF0YTogQ3JvcERhdGEpIHtcclxuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgIHRoaXMucm93ID0gcm93O1xyXG5cclxuICAgICAgICAvLyBub3cgcG9wdWxhdGUgdGhlIHJvd1xyXG4gICAgICAgIGZvciAobGV0IGNvbCBvZiBDT0xVTU5TKSB7XHJcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGNvbC5jZWxsVGV4dCh0aGlzLmRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnJvdy5pbnNlcnRDZWxsKCkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodmFsdWUpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbnR5cGUgU29ydERpcmVjdGlvbiA9IFwiYXNjZW5kaW5nXCIgfCBcImRlc2NlbmRpbmdcIjtcclxuZnVuY3Rpb24gZmxpcERpcmVjdGlvbih4OiBTb3J0RGlyZWN0aW9uKTogU29ydERpcmVjdGlvbiB7XHJcbiAgICBzd2l0Y2ggKHgpIHtcclxuICAgICAgICBjYXNlIFwiYXNjZW5kaW5nXCI6XHJcbiAgICAgICAgICAgIHJldHVybiBcImRlc2NlbmRpbmdcIjtcclxuICAgICAgICBjYXNlIFwiZGVzY2VuZGluZ1wiOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJhc2NlbmRpbmdcIjtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgQ3JvcFRhYmxlIHtcclxuICAgIHRhYmxlOiBIVE1MVGFibGVFbGVtZW50O1xyXG4gICAgdGhlYWQ6IEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50O1xyXG4gICAgdGJvZHk6IEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50O1xyXG4gICAgcm93czogQ3JvcFJvd1tdO1xyXG4gICAgY3VycmVudF9zb3J0OiBbbnVtYmVyLCBTb3J0RGlyZWN0aW9uXSB8IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IodGFibGU6IEhUTUxUYWJsZUVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLnRhYmxlID0gdGFibGU7XHJcbiAgICAgICAgdGhpcy5yb3dzID0gW107XHJcbiAgICAgICAgdGhpcy5jdXJyZW50X3NvcnQgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBDcmVhdGUgdGFibGUgaGVhZGVyIGFuZCBib2R5XHJcbiAgICAgICAgdGhpcy50aGVhZCA9IHRoaXMudGFibGUuY3JlYXRlVEhlYWQoKTtcclxuICAgICAgICB0aGlzLnRib2R5ID0gdGhpcy50YWJsZS5jcmVhdGVUQm9keSgpO1xyXG5cclxuICAgICAgICAvLyBQb3B1bGF0ZSBoZWFkIG9uY2UsIGhlcmVcclxuICAgICAgICBsZXQgcm93ID0gdGhpcy50aGVhZC5pbnNlcnRSb3coKTtcclxuICAgICAgICBmb3IgKGxldCBbaWR4LCBjb2xdIG9mIENPTFVNTlMuZW50cmllcygpKSB7XHJcbiAgICAgICAgICAgIGxldCBjZWxsID0gcm93Lmluc2VydENlbGwoKTtcclxuICAgICAgICAgICAgY2VsbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjb2wubmFtZSkpO1xyXG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIFdoaWNoIHdheSBkbyB3ZSBzb3J0P1xyXG4gICAgICAgICAgICAgICAgbGV0IGRpcjogU29ydERpcmVjdGlvbjtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRfc29ydCAhPT0gbnVsbCAmJiB0aGlzLmN1cnJlbnRfc29ydFswXSA9PT0gaWR4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlyID0gZmxpcERpcmVjdGlvbih0aGlzLmN1cnJlbnRfc29ydFsxXSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpciA9IFwiYXNjZW5kaW5nXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfc29ydCA9IFtpZHgsIGRpcl07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ2xlYXIgYWxsIHRoZSBoZWFkZXIgYnV0dG9ucywgZXhjZXB0IG91cnNlbHZlc1xyXG4gICAgICAgICAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLnRoZWFkLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkJyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBoZWFkZXIgb2YgaGVhZGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlci5yZW1vdmVBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzW2lkeF0uc2V0QXR0cmlidXRlKFwiYXJpYS1zb3J0XCIsIGRpcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTm93IHNvcnQgdGhlIHJvd3NcclxuICAgICAgICAgICAgICAgIHRoaXMuc29ydFJvd3MoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBXZSdsbCBsZWF2ZSB0aGUgYm9keSBlbXB0eSBiZWNhdXNlIGl0J2xsIGJlIHJlY29tcHV0ZWQgZnJvbVxyXG4gICAgICAgIC8vIHJlcG9wdWxhdGVUYWJsZSgpLCBhbmQgd2UgbmVlZCB0aGUgc2V0dGluZ3MgdG8gYmUgYWJsZSB0b1xyXG4gICAgICAgIC8vIGNyZWF0ZSB0aGUgcm93cyBhbnl3YXlzLlxyXG4gICAgfVxyXG5cclxuICAgIC8vIFRPRE86IGRvbid0IHJlY3JlYXRlIHJvd3M7IGNoYW5nZSB0aGUgdGV4dCBpbnN0ZWFkXHJcbiAgICBwdWJsaWMgcmVwb3B1bGF0ZVRhYmxlKHNldHRpbmdzOiBTZXR0aW5ncykge1xyXG4gICAgICAgIC8vIERpc2NhcmQgdGhlIG9sZCByb3dzIGFuZCBjcmVhdGUgbmV3IG9uZXNcclxuICAgICAgICB0aGlzLnRib2R5LnJlcGxhY2VDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMucm93cyA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGRlZiBvZiBDUk9QX0RFRklOSVRJT05TKSB7XHJcbiAgICAgICAgICAgIC8vIEZpbHRlciB0byBjcm9wcyB0aGF0IGFyZSBpbi1zZWFzb25cclxuICAgICAgICAgICAgbGV0IGRhdGEgPSBjYWxjdWxhdGUoZGVmLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgIGlmIChkYXRhID09IFwib3V0LW9mLXNlYXNvblwiKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgcm93ID0gdGhpcy50Ym9keS5pbnNlcnRSb3coKTtcclxuICAgICAgICAgICAgdGhpcy5yb3dzLnB1c2gobmV3IENyb3BSb3cocm93LCBkYXRhKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBXZSBhbHNvIG5lZWQgdG8gcmUtc29ydCB0aGVtLiBcclxuICAgICAgICB0aGlzLnNvcnRSb3dzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzb3J0Um93cygpIHtcclxuICAgICAgICAvLyBJZiBubyBzb3J0IHNlbGVjdGVkLCBkZWZhdWx0IGlzIHRvIHNvcnQgYnkgbmFtZVxyXG4gICAgICAgIGxldCBpZHg6IG51bWJlcjtcclxuICAgICAgICBsZXQgZGlyOiBTb3J0RGlyZWN0aW9uO1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRfc29ydCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZHggPSAwO1xyXG4gICAgICAgICAgICBkaXIgPSBcImFzY2VuZGluZ1wiO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIFtpZHgsIGRpcl0gPSB0aGlzLmN1cnJlbnRfc29ydDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFdlIGZpcnN0IHNvcnQgb3VyIG93biBjb2xsZWN0aW9uLCB0aGVuIHVzZSB0aGF0IHRvIHJlLWluc2VydFxyXG4gICAgICAgIC8vIG91ciByb3cgZWxlbWVudHMuXHJcbiAgICAgICAgbGV0IGNvbCA9IENPTFVNTlNbaWR4XTtcclxuICAgICAgICB0aGlzLnJvd3Muc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgY29tcGFyZSA9IGNvbC5jb21wYXJlKGEuZGF0YSwgYi5kYXRhKTtcclxuICAgICAgICAgICAgcmV0dXJuIGRpciA9PT0gXCJhc2NlbmRpbmdcIiA/IGNvbXBhcmUgOiAtY29tcGFyZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gVGhlbiB1c2UgdGhhdCB0byByZWFycmFuZ2UgdGhlIG5vZGVzIGluIHRoZSBib2R5XHJcbiAgICAgICAgZm9yIChsZXQgcm93IG9mIHRoaXMucm93cykge1xyXG4gICAgICAgICAgICB0aGlzLnRib2R5LmFwcGVuZENoaWxkKHJvdy5yb3cpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiSW5pdGlhbGl6aW5nIVwiKTtcclxuXHJcbiAgICAvLyBGaW5kIGFsbCB0aGUgZWxlbWVudHMgSSBuZWVkXHJcbiAgICBsZXQgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNyb3AtdGFibGVcIik7XHJcbiAgICBpZiAoISh0YWJsZSBpbnN0YW5jZW9mIEhUTUxUYWJsZUVsZW1lbnQpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY3JvcC10YWJsZSBzaG91bGQgYmUgYSA8dGFibGU+XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBpbnB1dF9wYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW5wdXQtcGFuZWxcIikhO1xyXG4gICAgbGV0IHNlYXNvbl9pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTElucHV0RWxlbWVudD4oXCIjc2Vhc29uXCIpITtcclxuICAgIGxldCBjdXJyZW50X2RheV9pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTElucHV0RWxlbWVudD4oXCIjZGF5XCIpITtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGFibGUgY29tcG9uZW50XHJcbiAgICBsZXQgdGFibGVfY29tcG9uZW50ID0gbmV3IENyb3BUYWJsZSh0YWJsZSk7XHJcblxyXG4gICAgLy8gQXBwbGllcyB0aGUgaW5wdXQgc2V0dGluZ3MgdG8gdGhlIGRvY3VtZW50XHJcbiAgICBmdW5jdGlvbiByZWFkQW5kQXBwbHlTZXR0aW5ncygpIHtcclxuICAgICAgICAvLyBHZXQgdGhlIHNldHRpbmdzXHJcbiAgICAgICAgbGV0IHNldHRpbmdzOiBTZXR0aW5ncyA9IHtcclxuICAgICAgICAgICAgc2Vhc29uOiBTZWFzb24uZnJvbVN0cmluZyhzZWFzb25faW5wdXQudmFsdWUpLFxyXG4gICAgICAgICAgICBzdGFydF9kYXk6IGN1cnJlbnRfZGF5X2lucHV0LnZhbHVlQXNOdW1iZXJcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBSZXBvcHVsYXRlIHRhYmxlIGFuZCBjaGFuZ2Ugc3R5bGVcclxuICAgICAgICB0YWJsZV9jb21wb25lbnQucmVwb3B1bGF0ZVRhYmxlKHNldHRpbmdzKTtcclxuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NOYW1lID0gc2Vhc29uX2lucHV0LnZhbHVlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUnVuIGl0IG9uY2UgdG8gYXBwbHkgdGhlIGRlZmF1bHQgc2V0dGluZ3MuXHJcbiAgICByZWFkQW5kQXBwbHlTZXR0aW5ncygpO1xyXG5cclxuICAgIC8vIEF0dGFjaCBldmVudCBsaXN0ZW5lcnNcclxuICAgIGlucHV0X3BhbmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgcmVhZEFuZEFwcGx5U2V0dGluZ3MoKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5cclxuLy8gQWxyaWdodHksIHdlJ3JlIHJlYWR5IHRvIGdvISBXYWl0IGZvciB0aGUgRE9NIHRvIGZpbmlzaCBsb2FkaW5nIChvciBzZWUgaWYgaXRcclxuLy8gYWxyZWFkeSBoYXMuXHJcbmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSBcImxvYWRpbmdcIikge1xyXG4gICAgLy8gTG9hZGluZyBoYXNuJ3QgZmluaXNoZWQgeWV0XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBpbml0aWFsaXplKTtcclxufSBlbHNlIHtcclxuICAgIC8vIGBET01Db250ZW50TG9hZGVkYCBoYXMgYWxyZWFkeSBmaXJlZFxyXG4gICAgaW5pdGlhbGl6ZSgpO1xyXG59Il0sIm5hbWVzIjpbIlNlYXNvbiIsImNhbGN1bGF0ZSIsImNyb3AiLCJzZXR0aW5ncyIsIm51bV9zZWFzb25zIiwibXVsdGlzZWFzb24iLCJmaXJzdF9zZWFzb24iLCJmcm9tU3RyaW5nIiwic2Vhc29uIiwic2Vhc29ucyIsImkiLCJwdXNoIiwidmFsdWVPZiIsImluY2x1ZGVzIiwiZGF5c19sZWZ0Iiwic3RhcnRfZGF5IiwibnVtX2hhcnZlc3RzIiwidXNlZnVsX2RheXMiLCJkYXlzX3RvX2dyb3ciLCJyZWdyb3d0aF9wZXJpb2QiLCJleHRyYV9oYXJ2ZXN0cyIsIk1hdGgiLCJmbG9vciIsIm51bV9jcm9wcyIsInlpZWxkIiwicGVyY2VudF9jaGFuY2VfZXh0cmEiLCJwcm9maXQiLCJzZWxsX3ByaWNlIiwic2VlZF9jb3N0IiwiZGFpbHlfcHJvZml0IiwibmFtZSIsInMiLCJ0b1VwcGVyQ2FzZSIsIlNQUklORyIsIlNVTU1FUiIsIkZBTEwiLCJXSU5URVIiLCJFcnJvciIsIkNPTFVNTlMiLCJjZWxsVGV4dCIsImNvbXBhcmUiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJ0b1N0cmluZyIsInlpZWxkX251bSIsIk51bWJlciIsImlzSW50ZWdlciIsInRvRml4ZWQiLCJpc0Zpbml0ZSIsIkNyb3BSb3ciLCJjb25zdHJ1Y3RvciIsInJvdyIsImRhdGEiLCJ0aGlzIiwiY29sIiwidmFsdWUiLCJpbnNlcnRDZWxsIiwiYXBwZW5kQ2hpbGQiLCJkb2N1bWVudCIsImNyZWF0ZVRleHROb2RlIiwiZmxpcERpcmVjdGlvbiIsIngiLCJDcm9wVGFibGUiLCJ0YWJsZSIsInJvd3MiLCJjdXJyZW50X3NvcnQiLCJ0aGVhZCIsImNyZWF0ZVRIZWFkIiwidGJvZHkiLCJjcmVhdGVUQm9keSIsImluc2VydFJvdyIsImlkeCIsImVudHJpZXMiLCJjZWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZGlyIiwiaGVhZGVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJoZWFkZXIiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJzb3J0Um93cyIsInJlcG9wdWxhdGVUYWJsZSIsInJlcGxhY2VDaGlsZHJlbiIsImRlZiIsInNvcnQiLCJpbml0aWFsaXplIiwiY29uc29sZSIsImxvZyIsImdldEVsZW1lbnRCeUlkIiwiSFRNTFRhYmxlRWxlbWVudCIsImlucHV0X3BhbmVsIiwic2Vhc29uX2lucHV0IiwicXVlcnlTZWxlY3RvciIsImN1cnJlbnRfZGF5X2lucHV0IiwidGFibGVfY29tcG9uZW50IiwicmVhZEFuZEFwcGx5U2V0dGluZ3MiLCJ2YWx1ZUFzTnVtYmVyIiwiZG9jdW1lbnRFbGVtZW50IiwiY2xhc3NOYW1lIiwidG9Mb3dlckNhc2UiLCJyZWFkeVN0YXRlIl0sInNvdXJjZVJvb3QiOiIifQ==