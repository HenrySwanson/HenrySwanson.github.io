(()=>{"use strict";const e=JSON.parse('[{"name":"Blue Jazz","season":"Spring","seed_cost":30,"sell_price":50,"days_to_grow":7},{"name":"Carrot","season":"Spring","seed_cost":0,"sell_price":35,"days_to_grow":3},{"name":"Cauliflower","season":"Spring","seed_cost":80,"sell_price":175,"days_to_grow":12},{"name":"Coffee Bean","season":"Spring","seed_cost":15,"sell_price":15,"days_to_grow":10,"regrowth_period":2,"yield":4,"percent_chance_extra":2},{"name":"Garlic","season":"Spring","seed_cost":40,"sell_price":60,"days_to_grow":4},{"name":"Green Bean","season":"Spring","seed_cost":60,"sell_price":40,"days_to_grow":10,"regrowth_period":3},{"name":"Kale","season":"Spring","seed_cost":70,"sell_price":110,"days_to_grow":6},{"name":"Parsnip","season":"Spring","seed_cost":20,"sell_price":35,"days_to_grow":4},{"name":"Potato","season":"Spring","seed_cost":50,"sell_price":80,"days_to_grow":6,"percent_chance_extra":25},{"name":"Rhubarb","season":"Spring","seed_cost":100,"sell_price":220,"days_to_grow":13},{"name":"Rice","season":"Spring","seed_cost":40,"sell_price":30,"days_to_grow":6},{"name":"Strawberry","season":"Spring","seed_cost":100,"sell_price":120,"days_to_grow":8,"regrowth_period":4,"percent_chance_extra":2},{"name":"Tulip","season":"Spring","seed_cost":20,"sell_price":30,"days_to_grow":6}]');var t;function r(e,r){var o,s,n,a,l;let i=28-r,c=0,d=0;if(i>=e.days_to_grow&&(c+=1,d+=e.days_to_grow,e.regrowth_period)){let t=Math.floor((i-e.days_to_grow)/e.regrowth_period);c+=t,d+=t*e.regrowth_period}let _=c*((null!==(o=e.yield)&&void 0!==o?o:1)+(null!==(s=e.percent_chance_extra)&&void 0!==s?s:0)/100),p=_*e.sell_price-e.seed_cost,u=p/d;return{name:e.name,season:t.fromString(e.season),seed_cost:e.seed_cost,sell_price:e.sell_price,days_to_grow:e.days_to_grow,regrowth_period:null!==(n=e.regrowth_period)&&void 0!==n?n:null,yield:null!==(a=e.yield)&&void 0!==a?a:null,percent_chance_extra:null!==(l=e.percent_chance_extra)&&void 0!==l?l:null,useful_days:d,num_harvests:c,num_crops:_,profit:p,daily_profit:u}}!function(e){e[e.SPRING=0]="SPRING",e[e.SUMMER=1]="SUMMER",e[e.FALL=2]="FALL"}(t||(t={})),function(e){e.fromString=function(t){switch(t.toUpperCase()){case"SPRING":return e.SPRING;case"SUMMER":return e.SUMMER;case"FALL":return e.FALL;default:throw new Error(`Unknown season ${t}`)}}}(t||(t={}));const o=[{name:"Name",cellText:e=>e.name,compare:(e,t)=>e.name.localeCompare(t.name)},{name:"Season",cellText:e=>t[e.season],compare:(e,t)=>e.season.valueOf()-t.season.valueOf()},{name:"Seed Cost",cellText:e=>e.seed_cost.toString(),compare:(e,t)=>e.seed_cost-t.seed_cost},{name:"Sell Price",cellText:e=>e.sell_price.toString(),compare:(e,t)=>e.sell_price-t.sell_price},{name:"Days to Grow",cellText:e=>e.days_to_grow.toString(),compare:(e,t)=>e.days_to_grow-t.days_to_grow},{name:"Regrowth Period",cellText:e=>{var t,r;return null!==(r=null===(t=e.regrowth_period)||void 0===t?void 0:t.toString())&&void 0!==r?r:"-"},compare:(e,t)=>null===t.regrowth_period?-1:null===e.regrowth_period?1:e.regrowth_period-t.regrowth_period},{name:"Yield",cellText:e=>{var t;let r=null!==(t=e.yield)&&void 0!==t?t:1;return e.percent_chance_extra?`${r} + ${e.percent_chance_extra}%`:r.toString()},compare:(e,t)=>{var r,o,s,n;return(null!==(r=e.yield)&&void 0!==r?r:1)+(null!==(o=e.percent_chance_extra)&&void 0!==o?o:0)/100-((null!==(s=t.yield)&&void 0!==s?s:1)+(null!==(n=t.percent_chance_extra)&&void 0!==n?n:0)/100)}},{name:"Useful Days",cellText:e=>e.useful_days.toString(),compare:(e,t)=>e.useful_days-t.useful_days},{name:"Num Harvests",cellText:e=>e.num_harvests.toString(),compare:(e,t)=>e.num_crops-t.num_crops},{name:"Num Crops",cellText:e=>{let t=e.num_crops;return Number.isInteger(t)?t.toString():e.num_crops.toFixed(2)},compare:(e,t)=>e.num_crops-t.num_crops},{name:"Profit",cellText:e=>e.profit.toFixed(2),compare:(e,t)=>e.profit-t.profit},{name:"Daily Profit",cellText:e=>Number.isFinite(e.daily_profit)?e.daily_profit.toFixed(2):"-",compare:(e,t)=>e.daily_profit-t.daily_profit}];class s{constructor(e,t){this.data=t,this.row=e;for(let e of o){let t=e.cellText(this.data);this.row.insertCell().appendChild(document.createTextNode(t))}}}function n(e){switch(e){case"ascending":return"descending";case"descending":return"ascending"}}class a{constructor(e){this.table=e,this.rows=[],this.current_sort=null;let t=this.table.createTHead();this.tbody=this.table.createTBody();let r=t.insertRow();for(let[e,t]of o.entries()){let o=r.insertCell();o.appendChild(document.createTextNode(t.name)),o.addEventListener("click",(t=>{let r;r=null!==this.current_sort&&this.current_sort[0]===e?n(this.current_sort[1]):"ascending",this.current_sort=[e,r];let o=this.table.querySelectorAll("thead td");for(let e of o)e.removeAttribute("aria-sort");o[e].setAttribute("aria-sort",r),this.sortRows()}))}this.recalculateRows(1)}recalculateRows(t){this.tbody.replaceChildren(),this.rows=[];for(let o of e){let e=r(o,t),n=this.tbody.insertRow();this.rows.push(new s(n,e))}this.sortRows()}sortRows(){if(null===this.current_sort)return;let[e,t]=this.current_sort,r=o[e];this.rows.sort(((e,o)=>{let s=r.compare(e.data,o.data);return"ascending"===t?s:-s}));for(let e of this.rows)this.tbody.appendChild(e.row)}}function l(){console.log("Initializing!");let e=document.getElementById("crop-table");if(!(e instanceof HTMLTableElement))throw new Error("crop-table should be a <table>");let t=document.getElementById("input-panel"),r=document.querySelector("#day"),o=new a(e);t.addEventListener("change",(e=>{let t=r.valueAsNumber;o.recalculateRows(t)}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTWlCLGtCQUNYaEMsS0FBS1csS0FBTyxHQUNaLElBQUssSUFBSXNCLEtBQU8sRUFBa0IsQ0FDOUIsSUFBSWxDLEVBQU8zQyxFQUFVNkUsRUFBS0YsR0FDdEJqQyxFQUFNRSxLQUFLZSxNQUFNRSxZQUNyQmpCLEtBQUtXLEtBQUt1QixLQUFLLElBQUl0QyxFQUFRRSxFQUFLQyxHQUNwQyxDQUdBQyxLQUFLNkIsVUFDVCxDQUVRLFFBQUFBLEdBRUosR0FBMEIsT0FBdEI3QixLQUFLWSxhQUNMLE9BRUosSUFBS00sRUFBS0ssR0FBT3ZCLEtBQUtZLGFBSWxCWCxFQUFNbEIsRUFBUW1DLEdBQ2xCbEIsS0FBS1csS0FBS3dCLE1BQUssQ0FBQ2pELEVBQUdDLEtBQ2YsSUFBSUYsRUFBVWdCLEVBQUloQixRQUFRQyxFQUFFYSxLQUFNWixFQUFFWSxNQUNwQyxNQUFlLGNBQVJ3QixFQUFzQnRDLEdBQVdBLENBQU8sSUFJbkQsSUFBSyxJQUFJYSxLQUFPRSxLQUFLVyxLQUNqQlgsS0FBS2UsTUFBTVgsWUFBWU4sRUFBSUEsSUFFbkMsRUFHSixTQUFTc0MsSUFDTEMsUUFBUUMsSUFBSSxpQkFHWixJQUFJNUIsRUFBUUwsU0FBU2tDLGVBQWUsY0FDcEMsS0FBTTdCLGFBQWlCOEIsa0JBQ25CLE1BQU0sSUFBSTFELE1BQU0sa0NBR3BCLElBQUkyRCxFQUFjcEMsU0FBU2tDLGVBQWUsZUFDdENHLEVBQW9CckMsU0FBU3NDLGNBQWdDLFFBRzdEQyxFQUFrQixJQUFJbkMsRUFBVUMsR0FHcEMrQixFQUFZcEIsaUJBQWlCLFVBQVdDLElBQ3BDLElBQUlTLEVBQWNXLEVBQWtCRyxjQUNwQ0QsRUFBZ0JkLGdCQUFnQkMsRUFBWSxHQUVwRCxDQUs0QixZQUF4QjFCLFNBQVN5QyxXQUVUekMsU0FBU2dCLGlCQUFpQixtQkFBb0JlLEdBRzlDQSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2Nyb3BzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG5cclxuLy8gc2hvdWxkIGkgcHVsbCB0aGlzIGZyb20gYSBKU09OIGxpa2UgaSdtIGRvaW5nIG5vdz8gb3Igc2hvdWxkIGkganVzdFxyXG4vLyBoYXJkLWNvZGUgaXQgaW5saW5lIChtaWdodCBiZSBtb3JlIHJlYWRhYmxlKVxyXG5pbXBvcnQgQ1JPUF9ERUZJTklUSU9OUyBmcm9tIFwiLi9jcm9wcy5qc29uXCI7XHJcblxyXG4vKiA9PT09PT09PSBDQUxDVUxBVElPTiA9PT09PT09PSAqL1xyXG5cclxudHlwZSBDcm9wRGVmaW5pdGlvbiA9IHR5cGVvZiBDUk9QX0RFRklOSVRJT05TW251bWJlcl07XHJcblxyXG5lbnVtIFNlYXNvbiB7XHJcbiAgICBTUFJJTkcsIFNVTU1FUiwgRkFMTFxyXG59XHJcblxyXG5uYW1lc3BhY2UgU2Vhc29uIHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBmcm9tU3RyaW5nKHM6IHN0cmluZyk6IFNlYXNvbiB7XHJcbiAgICAgICAgc3dpdGNoIChzLnRvVXBwZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgY2FzZSBcIlNQUklOR1wiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5TUFJJTkc7XHJcbiAgICAgICAgICAgIGNhc2UgXCJTVU1NRVJcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uU1VNTUVSO1xyXG4gICAgICAgICAgICBjYXNlIFwiRkFMTFwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5GQUxMO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHNlYXNvbiAke3N9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG50eXBlIENyb3BEYXRhID0ge1xyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgc2Vhc29uOiBTZWFzb24sXHJcbiAgICBzZWVkX2Nvc3Q6IG51bWJlcixcclxuICAgIHNlbGxfcHJpY2U6IG51bWJlcixcclxuICAgIGRheXNfdG9fZ3JvdzogbnVtYmVyLFxyXG4gICAgcmVncm93dGhfcGVyaW9kOiBudW1iZXIgfCBudWxsLFxyXG4gICAgeWllbGQ6IG51bWJlciB8IG51bGwsXHJcbiAgICBwZXJjZW50X2NoYW5jZV9leHRyYTogbnVtYmVyIHwgbnVsbCxcclxuICAgIHVzZWZ1bF9kYXlzOiBudW1iZXIsXHJcbiAgICBudW1faGFydmVzdHM6IG51bWJlcixcclxuICAgIG51bV9jcm9wczogbnVtYmVyLFxyXG4gICAgcHJvZml0OiBudW1iZXIsXHJcbiAgICBkYWlseV9wcm9maXQ6IG51bWJlcixcclxufTtcclxuXHJcbmZ1bmN0aW9uIGNhbGN1bGF0ZShjcm9wOiBDcm9wRGVmaW5pdGlvbiwgc3RhcnRfZGF5OiBudW1iZXIpOiBDcm9wRGF0YSB7XHJcbiAgICBsZXQgZGF5c19sZWZ0ID0gMjggLSBzdGFydF9kYXk7ICAvLyBwbGFudGluZyBvbiBkYXkgMjggaXMgemVybyBkYXlzIGxlZnRcclxuXHJcbiAgICAvLyBXaGF0J3MgdGhlIHByb2ZpdD8gRGVwZW5kcyBob3cgbWFueSBoYXJ2ZXN0cyB3ZSBjYW4gZ2V0IHRoaXMgc2Vhc29uLlxyXG4gICAgbGV0IG51bV9oYXJ2ZXN0cyA9IDA7XHJcbiAgICBsZXQgdXNlZnVsX2RheXMgPSAwO1xyXG4gICAgaWYgKGRheXNfbGVmdCA+PSBjcm9wLmRheXNfdG9fZ3Jvdykge1xyXG4gICAgICAgIG51bV9oYXJ2ZXN0cyArPSAxO1xyXG4gICAgICAgIHVzZWZ1bF9kYXlzICs9IGNyb3AuZGF5c190b19ncm93O1xyXG4gICAgICAgIGlmIChjcm9wLnJlZ3Jvd3RoX3BlcmlvZCkge1xyXG4gICAgICAgICAgICBsZXQgZXh0cmFfaGFydmVzdHMgPSBNYXRoLmZsb29yKChkYXlzX2xlZnQgLSBjcm9wLmRheXNfdG9fZ3JvdykgLyBjcm9wLnJlZ3Jvd3RoX3BlcmlvZCk7XHJcbiAgICAgICAgICAgIG51bV9oYXJ2ZXN0cyArPSBleHRyYV9oYXJ2ZXN0cztcclxuICAgICAgICAgICAgdXNlZnVsX2RheXMgKz0gZXh0cmFfaGFydmVzdHMgKiBjcm9wLnJlZ3Jvd3RoX3BlcmlvZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gV2UgY2FuIHNvbWV0aW1lcyBnZXQgbXVsdGlwbGUgY3JvcHMgcGVyIGhhcnZlc3RcclxuICAgIGxldCBudW1fY3JvcHMgPSBudW1faGFydmVzdHMgKiAoKGNyb3AueWllbGQgPz8gMSkgKyAoY3JvcC5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyAwKSAvIDEwMCk7XHJcblxyXG4gICAgbGV0IHByb2ZpdCA9IG51bV9jcm9wcyAqIGNyb3Auc2VsbF9wcmljZSAtIGNyb3Auc2VlZF9jb3N0O1xyXG4gICAgbGV0IGRhaWx5X3Byb2ZpdCA9IHByb2ZpdCAvIHVzZWZ1bF9kYXlzO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmFtZTogY3JvcC5uYW1lLFxyXG4gICAgICAgIHNlYXNvbjogU2Vhc29uLmZyb21TdHJpbmcoY3JvcC5zZWFzb24pLFxyXG4gICAgICAgIHNlZWRfY29zdDogY3JvcC5zZWVkX2Nvc3QsXHJcbiAgICAgICAgc2VsbF9wcmljZTogY3JvcC5zZWxsX3ByaWNlLFxyXG4gICAgICAgIGRheXNfdG9fZ3JvdzogY3JvcC5kYXlzX3RvX2dyb3csXHJcbiAgICAgICAgcmVncm93dGhfcGVyaW9kOiBjcm9wLnJlZ3Jvd3RoX3BlcmlvZCA/PyBudWxsLFxyXG4gICAgICAgIHlpZWxkOiBjcm9wLnlpZWxkID8/IG51bGwsXHJcbiAgICAgICAgcGVyY2VudF9jaGFuY2VfZXh0cmE6IGNyb3AucGVyY2VudF9jaGFuY2VfZXh0cmEgPz8gbnVsbCxcclxuICAgICAgICB1c2VmdWxfZGF5cyxcclxuICAgICAgICBudW1faGFydmVzdHMsXHJcbiAgICAgICAgbnVtX2Nyb3BzLFxyXG4gICAgICAgIHByb2ZpdCxcclxuICAgICAgICBkYWlseV9wcm9maXQsXHJcbiAgICB9O1xyXG59XHJcblxyXG4vKiA9PT09PT09PSBHVUkgPT09PT09PT0gKi9cclxuXHJcbi8vIERlZmluZXMgdGhlIHNldCBvZiBjb2x1bW5zIGZvciB0aGUgd2hvbGUgdGFibGUuXHJcbnR5cGUgQ29sdW1uID0ge1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gc3RyaW5nO1xyXG4gICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gbnVtYmVyO1xyXG59O1xyXG5cclxuY29uc3QgQ09MVU1OUzogQ29sdW1uW10gPSBbXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJOYW1lXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5uYW1lLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSksXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiU2Vhc29uXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gU2Vhc29uW2Nyb3Auc2Vhc29uXSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLnNlYXNvbi52YWx1ZU9mKCkgLSBiLnNlYXNvbi52YWx1ZU9mKCksXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiU2VlZCBDb3N0XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5zZWVkX2Nvc3QudG9TdHJpbmcoKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLnNlZWRfY29zdCAtIGIuc2VlZF9jb3N0LFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlNlbGwgUHJpY2VcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLnNlbGxfcHJpY2UudG9TdHJpbmcoKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLnNlbGxfcHJpY2UgLSBiLnNlbGxfcHJpY2UsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiRGF5cyB0byBHcm93XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5kYXlzX3RvX2dyb3cudG9TdHJpbmcoKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLmRheXNfdG9fZ3JvdyAtIGIuZGF5c190b19ncm93LFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlJlZ3Jvd3RoIFBlcmlvZFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AucmVncm93dGhfcGVyaW9kPy50b1N0cmluZygpID8/IFwiLVwiLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKGIucmVncm93dGhfcGVyaW9kID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5yZWdyb3d0aF9wZXJpb2QgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhLnJlZ3Jvd3RoX3BlcmlvZCAtIGIucmVncm93dGhfcGVyaW9kO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJZaWVsZFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IHtcclxuICAgICAgICAgICAgbGV0IHlpZWxkX251bSA9IGNyb3AueWllbGQgPz8gMTtcclxuICAgICAgICAgICAgaWYgKGNyb3AucGVyY2VudF9jaGFuY2VfZXh0cmEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBgJHt5aWVsZF9udW19ICsgJHtjcm9wLnBlcmNlbnRfY2hhbmNlX2V4dHJhfSVgO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkX251bS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIHNsaWdodCBoYWNrIC0tIHJlcHJlc2VudCBhcyBhICsgYi8xMDBcclxuICAgICAgICAgICAgbGV0IGFfbnVtID0gKGEueWllbGQgPz8gMSkgKyAoYS5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyAwKSAvIDEwMDtcclxuICAgICAgICAgICAgbGV0IGJfbnVtID0gKGIueWllbGQgPz8gMSkgKyAoYi5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyAwKSAvIDEwMDtcclxuICAgICAgICAgICAgcmV0dXJuIGFfbnVtIC0gYl9udW07XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlVzZWZ1bCBEYXlzXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC51c2VmdWxfZGF5cy50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEudXNlZnVsX2RheXMgLSBiLnVzZWZ1bF9kYXlzLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIk51bSBIYXJ2ZXN0c1wiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AubnVtX2hhcnZlc3RzLnRvU3RyaW5nKCksXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5udW1fY3JvcHMgLSBiLm51bV9jcm9wcyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJOdW0gQ3JvcHNcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBudW1fY3JvcHMgPSBjcm9wLm51bV9jcm9wcztcclxuICAgICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIobnVtX2Nyb3BzKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bV9jcm9wcy50b1N0cmluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjcm9wLm51bV9jcm9wcy50b0ZpeGVkKDIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5udW1fY3JvcHMgLSBiLm51bV9jcm9wcyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJQcm9maXRcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLnByb2ZpdC50b0ZpeGVkKDIpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEucHJvZml0IC0gYi5wcm9maXQsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiRGFpbHkgUHJvZml0XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKGNyb3AuZGFpbHlfcHJvZml0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNyb3AuZGFpbHlfcHJvZml0LnRvRml4ZWQoMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFwiLVwiO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5kYWlseV9wcm9maXQgLSBiLmRhaWx5X3Byb2ZpdCxcclxuICAgIH1cclxuXTtcclxuXHJcbmNsYXNzIENyb3BSb3cge1xyXG4gICAgZGF0YTogQ3JvcERhdGE7XHJcbiAgICByb3c6IEhUTUxUYWJsZVJvd0VsZW1lbnQ7XHJcblxyXG4gICAgY29uc3RydWN0b3Iocm93OiBIVE1MVGFibGVSb3dFbGVtZW50LCBkYXRhOiBDcm9wRGF0YSkge1xyXG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgdGhpcy5yb3cgPSByb3c7XHJcblxyXG4gICAgICAgIC8vIG5vdyBwb3B1bGF0ZSB0aGUgcm93XHJcbiAgICAgICAgZm9yIChsZXQgY29sIG9mIENPTFVNTlMpIHtcclxuICAgICAgICAgICAgbGV0IHZhbHVlID0gY29sLmNlbGxUZXh0KHRoaXMuZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMucm93Lmluc2VydENlbGwoKS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWx1ZSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxudHlwZSBTb3J0RGlyZWN0aW9uID0gXCJhc2NlbmRpbmdcIiB8IFwiZGVzY2VuZGluZ1wiO1xyXG5mdW5jdGlvbiBmbGlwRGlyZWN0aW9uKHg6IFNvcnREaXJlY3Rpb24pOiBTb3J0RGlyZWN0aW9uIHtcclxuICAgIHN3aXRjaCAoeCkge1xyXG4gICAgICAgIGNhc2UgXCJhc2NlbmRpbmdcIjpcclxuICAgICAgICAgICAgcmV0dXJuIFwiZGVzY2VuZGluZ1wiO1xyXG4gICAgICAgIGNhc2UgXCJkZXNjZW5kaW5nXCI6XHJcbiAgICAgICAgICAgIHJldHVybiBcImFzY2VuZGluZ1wiO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBDcm9wVGFibGUge1xyXG4gICAgdGFibGU6IEhUTUxUYWJsZUVsZW1lbnQ7XHJcbiAgICB0Ym9keTogSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQ7XHJcbiAgICByb3dzOiBDcm9wUm93W107XHJcbiAgICBjdXJyZW50X3NvcnQ6IFtudW1iZXIsIFNvcnREaXJlY3Rpb25dIHwgbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZTogSFRNTFRhYmxlRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcclxuICAgICAgICB0aGlzLnJvd3MgPSBbXTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRfc29ydCA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSB0YWJsZSBoZWFkZXIgYW5kIGJvZHlcclxuICAgICAgICBsZXQgdGhlYWQgPSB0aGlzLnRhYmxlLmNyZWF0ZVRIZWFkKCk7XHJcbiAgICAgICAgdGhpcy50Ym9keSA9IHRoaXMudGFibGUuY3JlYXRlVEJvZHkoKTtcclxuXHJcbiAgICAgICAgLy8gUG9wdWxhdGUgaGVhZCBvbmNlLCBoZXJlXHJcbiAgICAgICAgbGV0IHJvdyA9IHRoZWFkLmluc2VydFJvdygpO1xyXG4gICAgICAgIGZvciAobGV0IFtpZHgsIGNvbF0gb2YgQ09MVU1OUy5lbnRyaWVzKCkpIHtcclxuICAgICAgICAgICAgbGV0IGNlbGwgPSByb3cuaW5zZXJ0Q2VsbCgpO1xyXG4gICAgICAgICAgICBjZWxsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNvbC5uYW1lKSk7XHJcbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gV2hpY2ggd2F5IGRvIHdlIHNvcnQ/XHJcbiAgICAgICAgICAgICAgICBsZXQgZGlyOiBTb3J0RGlyZWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudF9zb3J0ICE9PSBudWxsICYmIHRoaXMuY3VycmVudF9zb3J0WzBdID09PSBpZHgpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXIgPSBmbGlwRGlyZWN0aW9uKHRoaXMuY3VycmVudF9zb3J0WzFdKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlyID0gXCJhc2NlbmRpbmdcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9zb3J0ID0gW2lkeCwgZGlyXTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDbGVhciBhbGwgdGhlIGhlYWRlciBidXR0b25zLCBleGNlcHQgb3Vyc2VsdmVzXHJcbiAgICAgICAgICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMudGFibGUucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgdGQnKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGhlYWRlciBvZiBoZWFkZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnJlbW92ZUF0dHJpYnV0ZShcImFyaWEtc29ydFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGhlYWRlcnNbaWR4XS5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIiwgZGlyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBOb3cgc29ydCB0aGUgcm93c1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0Um93cygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEJvZHkgbmVlZHMgdG8gYmUgcmVjYWxjdWxhdGVkIG9mdGVuLCBzbyBwdXQgdGhhdCBpbiBpdHNcclxuICAgICAgICAvLyBvd24gZnVuY3Rpb24uXHJcbiAgICAgICAgdGhpcy5yZWNhbGN1bGF0ZVJvd3MoMSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVE9ETzogZG9uJ3QgcmVjcmVhdGUgcm93czsgY2hhbmdlIHRoZSB0ZXh0IGluc3RlYWRcclxuICAgIHB1YmxpYyByZWNhbGN1bGF0ZVJvd3MoY3VycmVudF9kYXk6IG51bWJlcikge1xyXG4gICAgICAgIC8vIERpc2NhcmQgdGhlIG9sZCByb3dzIGFuZCBjcmVhdGUgbmV3IG9uZXNcclxuICAgICAgICB0aGlzLnRib2R5LnJlcGxhY2VDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMucm93cyA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGRlZiBvZiBDUk9QX0RFRklOSVRJT05TKSB7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gY2FsY3VsYXRlKGRlZiwgY3VycmVudF9kYXkpO1xyXG4gICAgICAgICAgICBsZXQgcm93ID0gdGhpcy50Ym9keS5pbnNlcnRSb3coKTtcclxuICAgICAgICAgICAgdGhpcy5yb3dzLnB1c2gobmV3IENyb3BSb3cocm93LCBkYXRhKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBXZSBhbHNvIG5lZWQgdG8gcmUtc29ydCB0aGVtLiBcclxuICAgICAgICB0aGlzLnNvcnRSb3dzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzb3J0Um93cygpIHtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudF9zb3J0ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IFtpZHgsIGRpcl0gPSB0aGlzLmN1cnJlbnRfc29ydDtcclxuXHJcbiAgICAgICAgLy8gV2UgZmlyc3Qgc29ydCBvdXIgb3duIGNvbGxlY3Rpb24sIHRoZW4gdXNlIHRoYXQgdG8gcmUtaW5zZXJ0XHJcbiAgICAgICAgLy8gb3VyIHJvdyBlbGVtZW50cy5cclxuICAgICAgICBsZXQgY29sID0gQ09MVU1OU1tpZHhdO1xyXG4gICAgICAgIHRoaXMucm93cy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBjb21wYXJlID0gY29sLmNvbXBhcmUoYS5kYXRhLCBiLmRhdGEpO1xyXG4gICAgICAgICAgICByZXR1cm4gZGlyID09PSBcImFzY2VuZGluZ1wiID8gY29tcGFyZSA6IC1jb21wYXJlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBUaGVuIHVzZSB0aGF0IHRvIHJlYXJyYW5nZSB0aGUgbm9kZXMgaW4gdGhlIGJvZHlcclxuICAgICAgICBmb3IgKGxldCByb3cgb2YgdGhpcy5yb3dzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGJvZHkuYXBwZW5kQ2hpbGQocm93LnJvdyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBpbml0aWFsaXplKCkge1xyXG4gICAgY29uc29sZS5sb2coXCJJbml0aWFsaXppbmchXCIpO1xyXG5cclxuICAgIC8vIEZpbmQgYWxsIHRoZSBlbGVtZW50cyBJIG5lZWRcclxuICAgIGxldCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY3JvcC10YWJsZVwiKTtcclxuICAgIGlmICghKHRhYmxlIGluc3RhbmNlb2YgSFRNTFRhYmxlRWxlbWVudCkpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjcm9wLXRhYmxlIHNob3VsZCBiZSBhIDx0YWJsZT5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGlucHV0X3BhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbnB1dC1wYW5lbFwiKSE7XHJcbiAgICBsZXQgY3VycmVudF9kYXlfaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI2RheVwiKSE7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGNvbXBvbmVudHNcclxuICAgIGxldCB0YWJsZV9jb21wb25lbnQgPSBuZXcgQ3JvcFRhYmxlKHRhYmxlKTtcclxuXHJcbiAgICAvLyBBdHRhY2ggZXZlbnQgbGlzdGVuZXJzXHJcbiAgICBpbnB1dF9wYW5lbC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgIGxldCBjdXJyZW50X2RheSA9IGN1cnJlbnRfZGF5X2lucHV0LnZhbHVlQXNOdW1iZXI7XHJcbiAgICAgICAgdGFibGVfY29tcG9uZW50LnJlY2FsY3VsYXRlUm93cyhjdXJyZW50X2RheSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcbi8vIEFscmlnaHR5LCB3ZSdyZSByZWFkeSB0byBnbyEgV2FpdCBmb3IgdGhlIERPTSB0byBmaW5pc2ggbG9hZGluZyAob3Igc2VlIGlmIGl0XHJcbi8vIGFscmVhZHkgaGFzLlxyXG5pZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gXCJsb2FkaW5nXCIpIHtcclxuICAgIC8vIExvYWRpbmcgaGFzbid0IGZpbmlzaGVkIHlldFxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgaW5pdGlhbGl6ZSk7XHJcbn0gZWxzZSB7XHJcbiAgICAvLyBgRE9NQ29udGVudExvYWRlZGAgaGFzIGFscmVhZHkgZmlyZWRcclxuICAgIGluaXRpYWxpemUoKTtcclxufSJdLCJuYW1lcyI6WyJTZWFzb24iLCJjYWxjdWxhdGUiLCJjcm9wIiwic3RhcnRfZGF5IiwiZGF5c19sZWZ0IiwibnVtX2hhcnZlc3RzIiwidXNlZnVsX2RheXMiLCJkYXlzX3RvX2dyb3ciLCJyZWdyb3d0aF9wZXJpb2QiLCJleHRyYV9oYXJ2ZXN0cyIsIk1hdGgiLCJmbG9vciIsIm51bV9jcm9wcyIsInlpZWxkIiwicGVyY2VudF9jaGFuY2VfZXh0cmEiLCJwcm9maXQiLCJzZWxsX3ByaWNlIiwic2VlZF9jb3N0IiwiZGFpbHlfcHJvZml0IiwibmFtZSIsInNlYXNvbiIsImZyb21TdHJpbmciLCJzIiwidG9VcHBlckNhc2UiLCJTUFJJTkciLCJTVU1NRVIiLCJGQUxMIiwiRXJyb3IiLCJDT0xVTU5TIiwiY2VsbFRleHQiLCJjb21wYXJlIiwiYSIsImIiLCJsb2NhbGVDb21wYXJlIiwidmFsdWVPZiIsInRvU3RyaW5nIiwieWllbGRfbnVtIiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwidG9GaXhlZCIsImlzRmluaXRlIiwiQ3JvcFJvdyIsImNvbnN0cnVjdG9yIiwicm93IiwiZGF0YSIsInRoaXMiLCJjb2wiLCJ2YWx1ZSIsImluc2VydENlbGwiLCJhcHBlbmRDaGlsZCIsImRvY3VtZW50IiwiY3JlYXRlVGV4dE5vZGUiLCJmbGlwRGlyZWN0aW9uIiwieCIsIkNyb3BUYWJsZSIsInRhYmxlIiwicm93cyIsImN1cnJlbnRfc29ydCIsInRoZWFkIiwiY3JlYXRlVEhlYWQiLCJ0Ym9keSIsImNyZWF0ZVRCb2R5IiwiaW5zZXJ0Um93IiwiaWR4IiwiZW50cmllcyIsImNlbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJkaXIiLCJoZWFkZXJzIiwicXVlcnlTZWxlY3RvckFsbCIsImhlYWRlciIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsInNvcnRSb3dzIiwicmVjYWxjdWxhdGVSb3dzIiwiY3VycmVudF9kYXkiLCJyZXBsYWNlQ2hpbGRyZW4iLCJkZWYiLCJwdXNoIiwic29ydCIsImluaXRpYWxpemUiLCJjb25zb2xlIiwibG9nIiwiZ2V0RWxlbWVudEJ5SWQiLCJIVE1MVGFibGVFbGVtZW50IiwiaW5wdXRfcGFuZWwiLCJjdXJyZW50X2RheV9pbnB1dCIsInF1ZXJ5U2VsZWN0b3IiLCJ0YWJsZV9jb21wb25lbnQiLCJ2YWx1ZUFzTnVtYmVyIiwicmVhZHlTdGF0ZSJdLCJzb3VyY2VSb290IjoiIn0=