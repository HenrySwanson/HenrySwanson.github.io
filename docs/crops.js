(()=>{"use strict";const e=JSON.parse('[{"name":"Blue Jazz","season":"Spring","seed_cost":30,"sell_price":50,"days_to_grow":7},{"name":"Carrot","season":"Spring","seed_cost":0,"sell_price":35,"days_to_grow":3},{"name":"Cauliflower","season":"Spring","seed_cost":80,"sell_price":175,"days_to_grow":12},{"name":"Coffee Bean","season":"Spring","multiseason":2,"seed_cost":15,"sell_price":15,"days_to_grow":10,"regrowth_period":2,"yield":4,"percent_chance_extra":2},{"name":"Garlic","season":"Spring","seed_cost":40,"sell_price":60,"days_to_grow":4},{"name":"Green Bean","season":"Spring","seed_cost":60,"sell_price":40,"days_to_grow":10,"regrowth_period":3},{"name":"Kale","season":"Spring","seed_cost":70,"sell_price":110,"days_to_grow":6},{"name":"Parsnip","season":"Spring","seed_cost":20,"sell_price":35,"days_to_grow":4},{"name":"Potato","season":"Spring","seed_cost":50,"sell_price":80,"days_to_grow":6,"percent_chance_extra":25},{"name":"Rhubarb","season":"Spring","seed_cost":100,"sell_price":220,"days_to_grow":13},{"name":"Rice","season":"Spring","seed_cost":40,"sell_price":30,"days_to_grow":6},{"name":"Strawberry","season":"Spring","seed_cost":100,"sell_price":120,"days_to_grow":8,"regrowth_period":4,"percent_chance_extra":2},{"name":"Tulip","season":"Spring","seed_cost":20,"sell_price":30,"days_to_grow":6},{"name":"Blueberry","season":"Summer","seed_cost":80,"sell_price":50,"days_to_grow":13,"regrowth_period":4,"yield":3,"percent_chance_extra":2},{"name":"Corn","season":"Summer","multiseason":2,"seed_cost":150,"sell_price":50,"days_to_grow":14,"regrowth_period":4},{"name":"Hops","season":"Summer","seed_cost":60,"sell_price":25,"days_to_grow":11,"regrowth_period":1},{"name":"Hot Pepper","season":"Summer","seed_cost":40,"sell_price":40,"days_to_grow":5,"regrowth_period":3,"percent_chance_extra":3},{"name":"Melon","season":"Summer","seed_cost":80,"sell_price":250,"days_to_grow":12},{"name":"Poppy","season":"Summer","seed_cost":100,"sell_price":140,"days_to_grow":7},{"name":"Radish","season":"Summer","seed_cost":40,"sell_price":90,"days_to_grow":6},{"name":"Red Cabbage","season":"Summer","seed_cost":100,"sell_price":260,"days_to_grow":9},{"name":"Starfruit","season":"Summer","seed_cost":400,"sell_price":750,"days_to_grow":13},{"name":"Summer Spangle","season":"Summer","seed_cost":50,"sell_price":90,"days_to_grow":8},{"name":"Summer Squash","season":"Summer","seed_cost":0,"sell_price":45,"days_to_grow":6},{"name":"Sunflower","season":"Summer","multiseason":2,"seed_cost":200,"sell_price":80,"days_to_grow":8},{"name":"Tomato","season":"Summer","seed_cost":50,"sell_price":60,"days_to_grow":11,"regrowth_period":4,"percent_chance_extra":5},{"name":"Wheat","season":"Summer","multiseason":2,"seed_cost":10,"sell_price":25,"days_to_grow":4},{"name":"Amaranth","season":"Fall","seed_cost":70,"sell_price":150,"days_to_grow":7},{"name":"Artichoke","season":"Fall","seed_cost":30,"sell_price":160,"days_to_grow":8},{"name":"Beet","season":"Fall","seed_cost":20,"sell_price":100,"days_to_grow":6},{"name":"Bok Choy","season":"Fall","seed_cost":50,"sell_price":80,"days_to_grow":4},{"name":"Broccoli","season":"Fall","seed_cost":0,"sell_price":70,"days_to_grow":8},{"name":"Cranberries","season":"Fall","seed_cost":240,"sell_price":75,"days_to_grow":7,"regrowth_period":5,"yield":2,"percent_chance_extra":10},{"name":"Eggplant","season":"Fall","seed_cost":20,"sell_price":60,"days_to_grow":5,"regrowth_period":5,"percent_chance_extra":0.2},{"name":"Fairy Rose","season":"Fall","seed_cost":200,"sell_price":290,"days_to_grow":12},{"name":"Grape","season":"Fall","seed_cost":60,"sell_price":80,"days_to_grow":10,"regrowth_period":3},{"name":"Pumpkin","season":"Fall","seed_cost":100,"sell_price":320,"days_to_grow":13},{"name":"Yam","season":"Fall","seed_cost":60,"sell_price":160,"days_to_grow":10},{"name":"Powdermelon","season":"Winter","seed_cost":0,"sell_price":60,"days_to_grow":7}]');var o;function t(e,t){var s,r,n;let a=[],i=null!==(s=e.multiseason)&&void 0!==s?s:1;for(let t=0;t<i;t++)a.push(o.fromString(e.season).valueOf()+t);if(!a.includes(t.season))return"out-of-season";let l=28*(t.multiseason_enabled?a.length-a.indexOf(t.season):1)-t.start_day,_=0,d=0;if(l>=e.days_to_grow&&(_+=1,d+=e.days_to_grow,e.regrowth_period)){let o=Math.floor((l-e.days_to_grow)/e.regrowth_period);_+=o,d+=o*e.regrowth_period}let c=_*((null!==(r=e.yield)&&void 0!==r?r:1)+(null!==(n=e.percent_chance_extra)&&void 0!==n?n:0)/100),p=c*e.sell_price-e.seed_cost;return{definition:e,useful_days:d,num_harvests:_,num_crops:c,profit:p,daily_profit:p/d}}!function(e){e[e.SPRING=0]="SPRING",e[e.SUMMER=1]="SUMMER",e[e.FALL=2]="FALL",e[e.WINTER=3]="WINTER"}(o||(o={})),function(e){e.fromString=function(o){switch(o.toUpperCase()){case"SPRING":return e.SPRING;case"SUMMER":return e.SUMMER;case"FALL":return e.FALL;case"WINTER":return e.WINTER;default:throw new Error(`Unknown season ${o}`)}}}(o||(o={}));const s=[{name:"Name",cellText:e=>e.definition.name,compare:(e,o)=>e.definition.name.localeCompare(o.definition.name)},{name:"Seed Cost",cellText:e=>e.definition.seed_cost.toString(),compare:(e,o)=>e.definition.seed_cost-o.definition.seed_cost},{name:"Sell Price",cellText:e=>e.definition.sell_price.toString(),compare:(e,o)=>e.definition.sell_price-o.definition.sell_price},{name:"Days to Grow",cellText:e=>e.definition.days_to_grow.toString(),compare:(e,o)=>e.definition.days_to_grow-o.definition.days_to_grow},{name:"Regrowth Period",cellText:e=>{var o,t;return null!==(t=null===(o=e.definition.regrowth_period)||void 0===o?void 0:o.toString())&&void 0!==t?t:"-"},compare:(e,o)=>void 0===o.definition.regrowth_period?-1:void 0===e.definition.regrowth_period?1:e.definition.regrowth_period-o.definition.regrowth_period},{name:"Yield",cellText:e=>{var o;let t=null!==(o=e.definition.yield)&&void 0!==o?o:1;return e.definition.percent_chance_extra?`${t} + ${e.definition.percent_chance_extra}%`:t.toString()},compare:(e,o)=>{var t,s,r,n;return(null!==(t=e.definition.yield)&&void 0!==t?t:1)+(null!==(s=e.definition.percent_chance_extra)&&void 0!==s?s:0)/100-((null!==(r=o.definition.yield)&&void 0!==r?r:1)+(null!==(n=o.definition.percent_chance_extra)&&void 0!==n?n:0)/100)}},{name:"Useful Days",cellText:e=>e.useful_days.toString(),compare:(e,o)=>e.useful_days-o.useful_days},{name:"Num Harvests",cellText:e=>e.num_harvests.toString(),compare:(e,o)=>e.num_crops-o.num_crops},{name:"Num Crops",cellText:e=>{let o=e.num_crops;return Number.isInteger(o)?o.toString():e.num_crops.toFixed(2)},compare:(e,o)=>e.num_crops-o.num_crops},{name:"Profit",cellText:e=>e.profit.toFixed(2),compare:(e,o)=>e.profit-o.profit},{name:"Daily Profit",cellText:e=>Number.isFinite(e.daily_profit)?e.daily_profit.toFixed(2):"-",compare:(e,o)=>e.daily_profit-o.daily_profit}];class r{constructor(e,o){this.data=o,this.row=e;for(let e of s){let o=e.cellText(this.data);this.row.insertCell().appendChild(document.createTextNode(o))}}}function n(e){switch(e){case"ascending":return"descending";case"descending":return"ascending"}}class a{constructor(e){this.table=e,this.rows=[],this.current_sort=null,this.thead=this.table.createTHead(),this.tbody=this.table.createTBody();let o=this.thead.insertRow();for(let[e,t]of s.entries()){let s=o.insertCell();s.appendChild(document.createTextNode(t.name)),s.addEventListener("click",(o=>{let t;t=null!==this.current_sort&&this.current_sort[0]===e?n(this.current_sort[1]):"ascending",this.current_sort=[e,t];let s=this.thead.querySelectorAll("td");for(let e of s)e.removeAttribute("aria-sort");s[e].setAttribute("aria-sort",t),this.sortRows()}))}}repopulateTable(o){this.tbody.replaceChildren(),this.rows=[];for(let s of e){let e=t(s,o);if("out-of-season"==e)continue;let n=this.tbody.insertRow();this.rows.push(new r(n,e))}this.sortRows()}sortRows(){let e,o;null===this.current_sort?(e=0,o="ascending"):[e,o]=this.current_sort;let t=s[e];this.rows.sort(((e,s)=>{let r=t.compare(e.data,s.data);return"ascending"===o?r:-r}));for(let e of this.rows)this.tbody.appendChild(e.row)}}function i(){console.log("Initializing!");let e=document.getElementById("crop-table");if(!(e instanceof HTMLTableElement))throw new Error("crop-table should be a <table>");let t=document.getElementById("input-panel"),s=document.querySelector("#season"),r=document.querySelector("#day"),n=document.querySelector("#enable-multiseason"),i=new a(e);function l(){let e={season:o.fromString(s.value),start_day:r.valueAsNumber,multiseason_enabled:n.checked};i.repopulateTable(e),document.documentElement.className=s.value.toLowerCase()}l(),t.addEventListener("change",(e=>{l()}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlwRyxFQUFxQixDQUNyQk8sT0FBUVYsRUFBT1MsV0FBV3lGLEVBQWF0QyxPQUN2QzNDLFVBQVdtRixFQUFrQkksY0FDN0IxRixvQkFBcUJ1RixFQUFtQkksU0FJNUNILEVBQWdCZCxnQkFBZ0JyRixHQUNoQzRELFNBQVMyQyxnQkFBZ0JDLFVBQVlULEVBQWF0QyxNQUFNZ0QsYUFDNUQsQ0FHQUwsSUFHQU4sRUFBWWxCLGlCQUFpQixVQUFXQyxJQUNwQ3VCLEdBQXNCLEdBRTlCLENBSzRCLFlBQXhCeEMsU0FBUzhDLFdBRVQ5QyxTQUFTZ0IsaUJBQWlCLG1CQUFvQmEsR0FHOUNBLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY3JvcHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4vLyBzaG91bGQgaSBwdWxsIHRoaXMgZnJvbSBhIEpTT04gbGlrZSBpJ20gZG9pbmcgbm93PyBvciBzaG91bGQgaSBqdXN0XHJcbi8vIGhhcmQtY29kZSBpdCBpbmxpbmUgKG1pZ2h0IGJlIG1vcmUgcmVhZGFibGUpXHJcbmltcG9ydCBDUk9QX0RFRklOSVRJT05TIGZyb20gXCIuL2Nyb3BzLmpzb25cIjtcclxuXHJcbi8qID09PT09PT09IENBTENVTEFUSU9OID09PT09PT09ICovXHJcblxyXG50eXBlIENyb3BEZWZpbml0aW9uID0gdHlwZW9mIENST1BfREVGSU5JVElPTlNbbnVtYmVyXTtcclxuXHJcbmVudW0gU2Vhc29uIHtcclxuICAgIFNQUklORywgU1VNTUVSLCBGQUxMLCBXSU5URVJcclxufVxyXG5cclxubmFtZXNwYWNlIFNlYXNvbiB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gZnJvbVN0cmluZyhzOiBzdHJpbmcpOiBTZWFzb24ge1xyXG4gICAgICAgIHN3aXRjaCAocy50b1VwcGVyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJTUFJJTkdcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uU1BSSU5HO1xyXG4gICAgICAgICAgICBjYXNlIFwiU1VNTUVSXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU2Vhc29uLlNVTU1FUjtcclxuICAgICAgICAgICAgY2FzZSBcIkZBTExcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBTZWFzb24uRkFMTDtcclxuICAgICAgICAgICAgY2FzZSBcIldJTlRFUlwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlYXNvbi5XSU5URVI7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gc2Vhc29uICR7c31gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbnR5cGUgQ3JvcERhdGEgPSB7XHJcbiAgICBkZWZpbml0aW9uOiBDcm9wRGVmaW5pdGlvbixcclxuICAgIHVzZWZ1bF9kYXlzOiBudW1iZXIsXHJcbiAgICBudW1faGFydmVzdHM6IG51bWJlcixcclxuICAgIG51bV9jcm9wczogbnVtYmVyLFxyXG4gICAgcHJvZml0OiBudW1iZXIsXHJcbiAgICBkYWlseV9wcm9maXQ6IG51bWJlcixcclxufTtcclxuXHJcbnR5cGUgU2V0dGluZ3MgPSB7XHJcbiAgICBzZWFzb246IFNlYXNvbixcclxuICAgIHN0YXJ0X2RheTogbnVtYmVyLFxyXG4gICAgbXVsdGlzZWFzb25fZW5hYmxlZDogYm9vbGVhbixcclxufTtcclxuXHJcbmZ1bmN0aW9uIGNhbGN1bGF0ZShjcm9wOiBDcm9wRGVmaW5pdGlvbiwgc2V0dGluZ3M6IFNldHRpbmdzKTogQ3JvcERhdGEgfCBcIm91dC1vZi1zZWFzb25cIiB7XHJcbiAgICAvLyBXaGVuIGlzIHRoaXMgY3JvcCBpbi1zZWFzb24/XHJcbiAgICBsZXQgc2Vhc29uczogU2Vhc29uW10gPSBbXTtcclxuICAgIGxldCBudW1fc2Vhc29ucyA9IGNyb3AubXVsdGlzZWFzb24gPz8gMTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtX3NlYXNvbnM7IGkrKykge1xyXG4gICAgICAgIHNlYXNvbnMucHVzaChTZWFzb24uZnJvbVN0cmluZyhjcm9wLnNlYXNvbikudmFsdWVPZigpICsgaSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQmFpbCBvdXQgaWYgd2UncmUgb3V0IG9mIHNlYXNvblxyXG4gICAgaWYgKCFzZWFzb25zLmluY2x1ZGVzKHNldHRpbmdzLnNlYXNvbikpIHtcclxuICAgICAgICByZXR1cm4gXCJvdXQtb2Ytc2Vhc29uXCI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSG93IG1hbnkgZGF5cyBkbyB3ZSBoYXZlIGxlZnQ/XHJcbiAgICBsZXQgc2Vhc29uc19sZWZ0ID0gc2V0dGluZ3MubXVsdGlzZWFzb25fZW5hYmxlZFxyXG4gICAgICAgID8gc2Vhc29ucy5sZW5ndGggLSBzZWFzb25zLmluZGV4T2Yoc2V0dGluZ3Muc2Vhc29uKVxyXG4gICAgICAgIDogMTtcclxuICAgIGxldCBkYXlzX2xlZnQgPSAyOCAqIHNlYXNvbnNfbGVmdCAtIHNldHRpbmdzLnN0YXJ0X2RheTtcclxuXHJcbiAgICAvLyBXaGF0J3MgdGhlIHByb2ZpdD8gRGVwZW5kcyBob3cgbWFueSBoYXJ2ZXN0cyB3ZSBjYW4gZ2V0IHRoaXMgc2Vhc29uLlxyXG4gICAgbGV0IG51bV9oYXJ2ZXN0cyA9IDA7XHJcbiAgICBsZXQgdXNlZnVsX2RheXMgPSAwO1xyXG4gICAgaWYgKGRheXNfbGVmdCA+PSBjcm9wLmRheXNfdG9fZ3Jvdykge1xyXG4gICAgICAgIG51bV9oYXJ2ZXN0cyArPSAxO1xyXG4gICAgICAgIHVzZWZ1bF9kYXlzICs9IGNyb3AuZGF5c190b19ncm93O1xyXG4gICAgICAgIGlmIChjcm9wLnJlZ3Jvd3RoX3BlcmlvZCkge1xyXG4gICAgICAgICAgICBsZXQgZXh0cmFfaGFydmVzdHMgPSBNYXRoLmZsb29yKChkYXlzX2xlZnQgLSBjcm9wLmRheXNfdG9fZ3JvdykgLyBjcm9wLnJlZ3Jvd3RoX3BlcmlvZCk7XHJcbiAgICAgICAgICAgIG51bV9oYXJ2ZXN0cyArPSBleHRyYV9oYXJ2ZXN0cztcclxuICAgICAgICAgICAgdXNlZnVsX2RheXMgKz0gZXh0cmFfaGFydmVzdHMgKiBjcm9wLnJlZ3Jvd3RoX3BlcmlvZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gV2UgY2FuIHNvbWV0aW1lcyBnZXQgbXVsdGlwbGUgY3JvcHMgcGVyIGhhcnZlc3RcclxuICAgIGxldCBudW1fY3JvcHMgPSBudW1faGFydmVzdHMgKiAoKGNyb3AueWllbGQgPz8gMSkgKyAoY3JvcC5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyAwKSAvIDEwMCk7XHJcblxyXG4gICAgbGV0IHByb2ZpdCA9IG51bV9jcm9wcyAqIGNyb3Auc2VsbF9wcmljZSAtIGNyb3Auc2VlZF9jb3N0O1xyXG4gICAgbGV0IGRhaWx5X3Byb2ZpdCA9IHByb2ZpdCAvIHVzZWZ1bF9kYXlzO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZGVmaW5pdGlvbjogY3JvcCxcclxuICAgICAgICB1c2VmdWxfZGF5cyxcclxuICAgICAgICBudW1faGFydmVzdHMsXHJcbiAgICAgICAgbnVtX2Nyb3BzLFxyXG4gICAgICAgIHByb2ZpdCxcclxuICAgICAgICBkYWlseV9wcm9maXQsXHJcbiAgICB9O1xyXG59XHJcblxyXG4vKiA9PT09PT09PSBHVUkgPT09PT09PT0gKi9cclxuXHJcbi8vIERlZmluZXMgdGhlIHNldCBvZiBjb2x1bW5zIGZvciB0aGUgd2hvbGUgdGFibGUuXHJcbnR5cGUgQ29sdW1uID0ge1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gc3RyaW5nO1xyXG4gICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gbnVtYmVyO1xyXG59O1xyXG5cclxuY29uc3QgQ09MVU1OUzogQ29sdW1uW10gPSBbXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJOYW1lXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5kZWZpbml0aW9uLm5hbWUsXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4gYS5kZWZpbml0aW9uLm5hbWUubG9jYWxlQ29tcGFyZShiLmRlZmluaXRpb24ubmFtZSksXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiU2VlZCBDb3N0XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5kZWZpbml0aW9uLnNlZWRfY29zdC50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGVmaW5pdGlvbi5zZWVkX2Nvc3QgLSBiLmRlZmluaXRpb24uc2VlZF9jb3N0LFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlNlbGwgUHJpY2VcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLmRlZmluaXRpb24uc2VsbF9wcmljZS50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGVmaW5pdGlvbi5zZWxsX3ByaWNlIC0gYi5kZWZpbml0aW9uLnNlbGxfcHJpY2UsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiRGF5cyB0byBHcm93XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5kZWZpbml0aW9uLmRheXNfdG9fZ3Jvdy50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGVmaW5pdGlvbi5kYXlzX3RvX2dyb3cgLSBiLmRlZmluaXRpb24uZGF5c190b19ncm93LFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlJlZ3Jvd3RoIFBlcmlvZFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AuZGVmaW5pdGlvbi5yZWdyb3d0aF9wZXJpb2Q/LnRvU3RyaW5nKCkgPz8gXCItXCIsXHJcbiAgICAgICAgY29tcGFyZTogKGE6IENyb3BEYXRhLCBiOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYi5kZWZpbml0aW9uLnJlZ3Jvd3RoX3BlcmlvZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5kZWZpbml0aW9uLnJlZ3Jvd3RoX3BlcmlvZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYS5kZWZpbml0aW9uLnJlZ3Jvd3RoX3BlcmlvZCAtIGIuZGVmaW5pdGlvbi5yZWdyb3d0aF9wZXJpb2Q7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIllpZWxkXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgeWllbGRfbnVtID0gY3JvcC5kZWZpbml0aW9uLnlpZWxkID8/IDE7XHJcbiAgICAgICAgICAgIGlmIChjcm9wLmRlZmluaXRpb24ucGVyY2VudF9jaGFuY2VfZXh0cmEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBgJHt5aWVsZF9udW19ICsgJHtjcm9wLmRlZmluaXRpb24ucGVyY2VudF9jaGFuY2VfZXh0cmF9JWA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGRfbnVtLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IHtcclxuICAgICAgICAgICAgLy8gc2xpZ2h0IGhhY2sgLS0gcmVwcmVzZW50IGFzIGEgKyBiLzEwMFxyXG4gICAgICAgICAgICBsZXQgYV9udW0gPSAoYS5kZWZpbml0aW9uLnlpZWxkID8/IDEpICsgKGEuZGVmaW5pdGlvbi5wZXJjZW50X2NoYW5jZV9leHRyYSA/PyAwKSAvIDEwMDtcclxuICAgICAgICAgICAgbGV0IGJfbnVtID0gKGIuZGVmaW5pdGlvbi55aWVsZCA/PyAxKSArIChiLmRlZmluaXRpb24ucGVyY2VudF9jaGFuY2VfZXh0cmEgPz8gMCkgLyAxMDA7XHJcbiAgICAgICAgICAgIHJldHVybiBhX251bSAtIGJfbnVtO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJVc2VmdWwgRGF5c1wiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IGNyb3AudXNlZnVsX2RheXMudG9TdHJpbmcoKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLnVzZWZ1bF9kYXlzIC0gYi51c2VmdWxfZGF5cyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJOdW0gSGFydmVzdHNcIixcclxuICAgICAgICBjZWxsVGV4dDogKGNyb3A6IENyb3BEYXRhKSA9PiBjcm9wLm51bV9oYXJ2ZXN0cy50b1N0cmluZygpLFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEubnVtX2Nyb3BzIC0gYi5udW1fY3JvcHMsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiTnVtIENyb3BzXCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbnVtX2Nyb3BzID0gY3JvcC5udW1fY3JvcHM7XHJcbiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG51bV9jcm9wcykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1fY3JvcHMudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY3JvcC5udW1fY3JvcHMudG9GaXhlZCgyKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEubnVtX2Nyb3BzIC0gYi5udW1fY3JvcHMsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiUHJvZml0XCIsXHJcbiAgICAgICAgY2VsbFRleHQ6IChjcm9wOiBDcm9wRGF0YSkgPT4gY3JvcC5wcm9maXQudG9GaXhlZCgyKSxcclxuICAgICAgICBjb21wYXJlOiAoYTogQ3JvcERhdGEsIGI6IENyb3BEYXRhKSA9PiBhLnByb2ZpdCAtIGIucHJvZml0LFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIkRhaWx5IFByb2ZpdFwiLFxyXG4gICAgICAgIGNlbGxUZXh0OiAoY3JvcDogQ3JvcERhdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShjcm9wLmRhaWx5X3Byb2ZpdCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjcm9wLmRhaWx5X3Byb2ZpdC50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBcIi1cIjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbXBhcmU6IChhOiBDcm9wRGF0YSwgYjogQ3JvcERhdGEpID0+IGEuZGFpbHlfcHJvZml0IC0gYi5kYWlseV9wcm9maXQsXHJcbiAgICB9XHJcbl07XHJcblxyXG5jbGFzcyBDcm9wUm93IHtcclxuICAgIGRhdGE6IENyb3BEYXRhO1xyXG4gICAgcm93OiBIVE1MVGFibGVSb3dFbGVtZW50O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHJvdzogSFRNTFRhYmxlUm93RWxlbWVudCwgZGF0YTogQ3JvcERhdGEpIHtcclxuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgIHRoaXMucm93ID0gcm93O1xyXG5cclxuICAgICAgICAvLyBub3cgcG9wdWxhdGUgdGhlIHJvd1xyXG4gICAgICAgIGZvciAobGV0IGNvbCBvZiBDT0xVTU5TKSB7XHJcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGNvbC5jZWxsVGV4dCh0aGlzLmRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnJvdy5pbnNlcnRDZWxsKCkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodmFsdWUpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbnR5cGUgU29ydERpcmVjdGlvbiA9IFwiYXNjZW5kaW5nXCIgfCBcImRlc2NlbmRpbmdcIjtcclxuZnVuY3Rpb24gZmxpcERpcmVjdGlvbih4OiBTb3J0RGlyZWN0aW9uKTogU29ydERpcmVjdGlvbiB7XHJcbiAgICBzd2l0Y2ggKHgpIHtcclxuICAgICAgICBjYXNlIFwiYXNjZW5kaW5nXCI6XHJcbiAgICAgICAgICAgIHJldHVybiBcImRlc2NlbmRpbmdcIjtcclxuICAgICAgICBjYXNlIFwiZGVzY2VuZGluZ1wiOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJhc2NlbmRpbmdcIjtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgQ3JvcFRhYmxlIHtcclxuICAgIHRhYmxlOiBIVE1MVGFibGVFbGVtZW50O1xyXG4gICAgdGhlYWQ6IEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50O1xyXG4gICAgdGJvZHk6IEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50O1xyXG4gICAgcm93czogQ3JvcFJvd1tdO1xyXG4gICAgY3VycmVudF9zb3J0OiBbbnVtYmVyLCBTb3J0RGlyZWN0aW9uXSB8IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IodGFibGU6IEhUTUxUYWJsZUVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLnRhYmxlID0gdGFibGU7XHJcbiAgICAgICAgdGhpcy5yb3dzID0gW107XHJcbiAgICAgICAgdGhpcy5jdXJyZW50X3NvcnQgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBDcmVhdGUgdGFibGUgaGVhZGVyIGFuZCBib2R5XHJcbiAgICAgICAgdGhpcy50aGVhZCA9IHRoaXMudGFibGUuY3JlYXRlVEhlYWQoKTtcclxuICAgICAgICB0aGlzLnRib2R5ID0gdGhpcy50YWJsZS5jcmVhdGVUQm9keSgpO1xyXG5cclxuICAgICAgICAvLyBQb3B1bGF0ZSBoZWFkIG9uY2UsIGhlcmVcclxuICAgICAgICBsZXQgcm93ID0gdGhpcy50aGVhZC5pbnNlcnRSb3coKTtcclxuICAgICAgICBmb3IgKGxldCBbaWR4LCBjb2xdIG9mIENPTFVNTlMuZW50cmllcygpKSB7XHJcbiAgICAgICAgICAgIGxldCBjZWxsID0gcm93Lmluc2VydENlbGwoKTtcclxuICAgICAgICAgICAgY2VsbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjb2wubmFtZSkpO1xyXG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIFdoaWNoIHdheSBkbyB3ZSBzb3J0P1xyXG4gICAgICAgICAgICAgICAgbGV0IGRpcjogU29ydERpcmVjdGlvbjtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRfc29ydCAhPT0gbnVsbCAmJiB0aGlzLmN1cnJlbnRfc29ydFswXSA9PT0gaWR4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlyID0gZmxpcERpcmVjdGlvbih0aGlzLmN1cnJlbnRfc29ydFsxXSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpciA9IFwiYXNjZW5kaW5nXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfc29ydCA9IFtpZHgsIGRpcl07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ2xlYXIgYWxsIHRoZSBoZWFkZXIgYnV0dG9ucywgZXhjZXB0IG91cnNlbHZlc1xyXG4gICAgICAgICAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLnRoZWFkLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkJyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBoZWFkZXIgb2YgaGVhZGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlci5yZW1vdmVBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzW2lkeF0uc2V0QXR0cmlidXRlKFwiYXJpYS1zb3J0XCIsIGRpcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTm93IHNvcnQgdGhlIHJvd3NcclxuICAgICAgICAgICAgICAgIHRoaXMuc29ydFJvd3MoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBXZSdsbCBsZWF2ZSB0aGUgYm9keSBlbXB0eSBiZWNhdXNlIGl0J2xsIGJlIHJlY29tcHV0ZWQgZnJvbVxyXG4gICAgICAgIC8vIHJlcG9wdWxhdGVUYWJsZSgpLCBhbmQgd2UgbmVlZCB0aGUgc2V0dGluZ3MgdG8gYmUgYWJsZSB0b1xyXG4gICAgICAgIC8vIGNyZWF0ZSB0aGUgcm93cyBhbnl3YXlzLlxyXG4gICAgfVxyXG5cclxuICAgIC8vIFRPRE86IGRvbid0IHJlY3JlYXRlIHJvd3M7IGNoYW5nZSB0aGUgdGV4dCBpbnN0ZWFkXHJcbiAgICBwdWJsaWMgcmVwb3B1bGF0ZVRhYmxlKHNldHRpbmdzOiBTZXR0aW5ncykge1xyXG4gICAgICAgIC8vIERpc2NhcmQgdGhlIG9sZCByb3dzIGFuZCBjcmVhdGUgbmV3IG9uZXNcclxuICAgICAgICB0aGlzLnRib2R5LnJlcGxhY2VDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMucm93cyA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGRlZiBvZiBDUk9QX0RFRklOSVRJT05TKSB7XHJcbiAgICAgICAgICAgIC8vIEZpbHRlciB0byBjcm9wcyB0aGF0IGFyZSBpbi1zZWFzb25cclxuICAgICAgICAgICAgbGV0IGRhdGEgPSBjYWxjdWxhdGUoZGVmLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgIGlmIChkYXRhID09IFwib3V0LW9mLXNlYXNvblwiKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgcm93ID0gdGhpcy50Ym9keS5pbnNlcnRSb3coKTtcclxuICAgICAgICAgICAgdGhpcy5yb3dzLnB1c2gobmV3IENyb3BSb3cocm93LCBkYXRhKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBXZSBhbHNvIG5lZWQgdG8gcmUtc29ydCB0aGVtLiBcclxuICAgICAgICB0aGlzLnNvcnRSb3dzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzb3J0Um93cygpIHtcclxuICAgICAgICAvLyBJZiBubyBzb3J0IHNlbGVjdGVkLCBkZWZhdWx0IGlzIHRvIHNvcnQgYnkgbmFtZVxyXG4gICAgICAgIGxldCBpZHg6IG51bWJlcjtcclxuICAgICAgICBsZXQgZGlyOiBTb3J0RGlyZWN0aW9uO1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRfc29ydCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZHggPSAwO1xyXG4gICAgICAgICAgICBkaXIgPSBcImFzY2VuZGluZ1wiO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIFtpZHgsIGRpcl0gPSB0aGlzLmN1cnJlbnRfc29ydDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFdlIGZpcnN0IHNvcnQgb3VyIG93biBjb2xsZWN0aW9uLCB0aGVuIHVzZSB0aGF0IHRvIHJlLWluc2VydFxyXG4gICAgICAgIC8vIG91ciByb3cgZWxlbWVudHMuXHJcbiAgICAgICAgbGV0IGNvbCA9IENPTFVNTlNbaWR4XTtcclxuICAgICAgICB0aGlzLnJvd3Muc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgY29tcGFyZSA9IGNvbC5jb21wYXJlKGEuZGF0YSwgYi5kYXRhKTtcclxuICAgICAgICAgICAgcmV0dXJuIGRpciA9PT0gXCJhc2NlbmRpbmdcIiA/IGNvbXBhcmUgOiAtY29tcGFyZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gVGhlbiB1c2UgdGhhdCB0byByZWFycmFuZ2UgdGhlIG5vZGVzIGluIHRoZSBib2R5XHJcbiAgICAgICAgZm9yIChsZXQgcm93IG9mIHRoaXMucm93cykge1xyXG4gICAgICAgICAgICB0aGlzLnRib2R5LmFwcGVuZENoaWxkKHJvdy5yb3cpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiSW5pdGlhbGl6aW5nIVwiKTtcclxuXHJcbiAgICAvLyBGaW5kIGFsbCB0aGUgZWxlbWVudHMgSSBuZWVkXHJcbiAgICBsZXQgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNyb3AtdGFibGVcIik7XHJcbiAgICBpZiAoISh0YWJsZSBpbnN0YW5jZW9mIEhUTUxUYWJsZUVsZW1lbnQpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY3JvcC10YWJsZSBzaG91bGQgYmUgYSA8dGFibGU+XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBpbnB1dF9wYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW5wdXQtcGFuZWxcIikhO1xyXG4gICAgbGV0IHNlYXNvbl9pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTElucHV0RWxlbWVudD4oXCIjc2Vhc29uXCIpITtcclxuICAgIGxldCBjdXJyZW50X2RheV9pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTElucHV0RWxlbWVudD4oXCIjZGF5XCIpITtcclxuICAgIGxldCBlbmFibGVfbXVsdGlzZWFzb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxJbnB1dEVsZW1lbnQ+KFwiI2VuYWJsZS1tdWx0aXNlYXNvblwiKSE7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRhYmxlIGNvbXBvbmVudFxyXG4gICAgbGV0IHRhYmxlX2NvbXBvbmVudCA9IG5ldyBDcm9wVGFibGUodGFibGUpO1xyXG5cclxuICAgIC8vIEFwcGxpZXMgdGhlIGlucHV0IHNldHRpbmdzIHRvIHRoZSBkb2N1bWVudFxyXG4gICAgZnVuY3Rpb24gcmVhZEFuZEFwcGx5U2V0dGluZ3MoKSB7XHJcbiAgICAgICAgLy8gR2V0IHRoZSBzZXR0aW5nc1xyXG4gICAgICAgIGxldCBzZXR0aW5nczogU2V0dGluZ3MgPSB7XHJcbiAgICAgICAgICAgIHNlYXNvbjogU2Vhc29uLmZyb21TdHJpbmcoc2Vhc29uX2lucHV0LnZhbHVlKSxcclxuICAgICAgICAgICAgc3RhcnRfZGF5OiBjdXJyZW50X2RheV9pbnB1dC52YWx1ZUFzTnVtYmVyLFxyXG4gICAgICAgICAgICBtdWx0aXNlYXNvbl9lbmFibGVkOiBlbmFibGVfbXVsdGlzZWFzb24uY2hlY2tlZFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIFJlcG9wdWxhdGUgdGFibGUgYW5kIGNoYW5nZSBzdHlsZVxyXG4gICAgICAgIHRhYmxlX2NvbXBvbmVudC5yZXBvcHVsYXRlVGFibGUoc2V0dGluZ3MpO1xyXG4gICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUgPSBzZWFzb25faW5wdXQudmFsdWUudG9Mb3dlckNhc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSdW4gaXQgb25jZSB0byBhcHBseSB0aGUgZGVmYXVsdCBzZXR0aW5ncy5cclxuICAgIHJlYWRBbmRBcHBseVNldHRpbmdzKCk7XHJcblxyXG4gICAgLy8gQXR0YWNoIGV2ZW50IGxpc3RlbmVyc1xyXG4gICAgaW5wdXRfcGFuZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICByZWFkQW5kQXBwbHlTZXR0aW5ncygpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcblxyXG4vLyBBbHJpZ2h0eSwgd2UncmUgcmVhZHkgdG8gZ28hIFdhaXQgZm9yIHRoZSBET00gdG8gZmluaXNoIGxvYWRpbmcgKG9yIHNlZSBpZiBpdFxyXG4vLyBhbHJlYWR5IGhhcy5cclxuaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09IFwibG9hZGluZ1wiKSB7XHJcbiAgICAvLyBMb2FkaW5nIGhhc24ndCBmaW5pc2hlZCB5ZXRcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGluaXRpYWxpemUpO1xyXG59IGVsc2Uge1xyXG4gICAgLy8gYERPTUNvbnRlbnRMb2FkZWRgIGhhcyBhbHJlYWR5IGZpcmVkXHJcbiAgICBpbml0aWFsaXplKCk7XHJcbn0iXSwibmFtZXMiOlsiU2Vhc29uIiwiY2FsY3VsYXRlIiwiY3JvcCIsInNldHRpbmdzIiwic2Vhc29ucyIsIm51bV9zZWFzb25zIiwibXVsdGlzZWFzb24iLCJpIiwicHVzaCIsImZyb21TdHJpbmciLCJzZWFzb24iLCJ2YWx1ZU9mIiwiaW5jbHVkZXMiLCJkYXlzX2xlZnQiLCJtdWx0aXNlYXNvbl9lbmFibGVkIiwibGVuZ3RoIiwiaW5kZXhPZiIsInN0YXJ0X2RheSIsIm51bV9oYXJ2ZXN0cyIsInVzZWZ1bF9kYXlzIiwiZGF5c190b19ncm93IiwicmVncm93dGhfcGVyaW9kIiwiZXh0cmFfaGFydmVzdHMiLCJNYXRoIiwiZmxvb3IiLCJudW1fY3JvcHMiLCJ5aWVsZCIsInBlcmNlbnRfY2hhbmNlX2V4dHJhIiwicHJvZml0Iiwic2VsbF9wcmljZSIsInNlZWRfY29zdCIsImRlZmluaXRpb24iLCJkYWlseV9wcm9maXQiLCJzIiwidG9VcHBlckNhc2UiLCJTUFJJTkciLCJTVU1NRVIiLCJGQUxMIiwiV0lOVEVSIiwiRXJyb3IiLCJDT0xVTU5TIiwibmFtZSIsImNlbGxUZXh0IiwiY29tcGFyZSIsImEiLCJiIiwibG9jYWxlQ29tcGFyZSIsInRvU3RyaW5nIiwidW5kZWZpbmVkIiwieWllbGRfbnVtIiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwidG9GaXhlZCIsImlzRmluaXRlIiwiQ3JvcFJvdyIsImNvbnN0cnVjdG9yIiwicm93IiwiZGF0YSIsInRoaXMiLCJjb2wiLCJ2YWx1ZSIsImluc2VydENlbGwiLCJhcHBlbmRDaGlsZCIsImRvY3VtZW50IiwiY3JlYXRlVGV4dE5vZGUiLCJmbGlwRGlyZWN0aW9uIiwieCIsIkNyb3BUYWJsZSIsInRhYmxlIiwicm93cyIsImN1cnJlbnRfc29ydCIsInRoZWFkIiwiY3JlYXRlVEhlYWQiLCJ0Ym9keSIsImNyZWF0ZVRCb2R5IiwiaW5zZXJ0Um93IiwiaWR4IiwiZW50cmllcyIsImNlbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJkaXIiLCJoZWFkZXJzIiwicXVlcnlTZWxlY3RvckFsbCIsImhlYWRlciIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsInNvcnRSb3dzIiwicmVwb3B1bGF0ZVRhYmxlIiwicmVwbGFjZUNoaWxkcmVuIiwiZGVmIiwic29ydCIsImluaXRpYWxpemUiLCJjb25zb2xlIiwibG9nIiwiZ2V0RWxlbWVudEJ5SWQiLCJIVE1MVGFibGVFbGVtZW50IiwiaW5wdXRfcGFuZWwiLCJzZWFzb25faW5wdXQiLCJxdWVyeVNlbGVjdG9yIiwiY3VycmVudF9kYXlfaW5wdXQiLCJlbmFibGVfbXVsdGlzZWFzb24iLCJ0YWJsZV9jb21wb25lbnQiLCJyZWFkQW5kQXBwbHlTZXR0aW5ncyIsInZhbHVlQXNOdW1iZXIiLCJjaGVja2VkIiwiZG9jdW1lbnRFbGVtZW50IiwiY2xhc3NOYW1lIiwidG9Mb3dlckNhc2UiLCJyZWFkeVN0YXRlIl0sInNvdXJjZVJvb3QiOiIifQ==